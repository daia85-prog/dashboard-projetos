<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Infraestrutura v7.6</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); overflow: hidden; }
        
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px 25px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .header-left h1 { font-size: 1.4em; margin-bottom: 5px; }
        .header-left p { opacity: 0.9; font-size: 0.85em; }
        
        .nav-buttons { display: flex; gap: 8px; flex-wrap: wrap; }
        .nav-btn { padding: 9px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85em; transition: all 0.2s; text-decoration: none; display: inline-flex; align-items: center; gap: 5px; color: white; }
        .nav-btn.green { background: #22c55e; }
        .nav-btn.purple { background: #8b5cf6; }
        .nav-btn.blue { background: #3b82f6; }
        
        .content { padding: 20px 25px; }
        
        .toggle { display: flex; justify-content: center; margin-bottom: 18px; }
        .toggle button { padding: 11px 28px; border: 2px solid #667eea; background: white; color: #667eea; font-weight: 600; cursor: pointer; transition: all 0.2s; font-size: 0.95em; }
        .toggle button:first-child { border-radius: 25px 0 0 25px; }
        .toggle button:last-child { border-radius: 0 25px 25px 0; border-left: none; }
        .toggle button.active { background: #667eea; color: white; }
        
        .phases-legend { background: #f1f5f9; padding: 10px 15px; border-radius: 8px; margin-bottom: 15px; font-size: 0.75em; color: #64748b; text-align: center; line-height: 1.8; }
        .phases-legend strong { color: #475569; }
        
        .filters { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 18px; padding: 15px; background: #f8fafc; border-radius: 10px; align-items: end; }
        .filter-group label { display: block; font-size: 0.78em; color: #64748b; margin-bottom: 4px; font-weight: 500; }
        .filter-group input, .filter-group select { width: 100%; padding: 8px 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.9em; }
        
        .checkbox-group { display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #fef2f2; border: 2px solid #fca5a5; border-radius: 8px; cursor: pointer; }
        .checkbox-group input { width: 16px; height: 16px; cursor: pointer; }
        .checkbox-group span { font-size: 0.85em; color: #dc2626; font-weight: 600; }
        
        /* KPI Cards - MACRO: 5 colunas */
        .kpis { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-bottom: 20px; }
        .kpi { text-align: center; padding: 15px 10px; background: white; border-radius: 10px; border: 2px solid #e2e8f0; cursor: pointer; transition: all 0.2s; }
        .kpi:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .kpi.azul { border-color: #3b82f6; }
        .kpi.verde { border-color: #22c55e; }
        .kpi.amarelo { border-color: #f59e0b; }
        .kpi.vermelho { border-color: #ef4444; }
        .kpi.rosa { border-color: #ec4899; }
        .kpi .num { font-size: 1.8em; font-weight: 700; color: #1e293b; }
        .kpi .lbl { font-size: 0.8em; color: #64748b; }
        
        /* KPI Cards - MICRO: 2x2 + 1 centralizado */
        .kpis.micro-layout { grid-template-columns: repeat(2, 1fr); max-width: 500px; margin-left: auto; margin-right: auto; }
        .kpis.micro-layout .kpi:last-child { grid-column: span 2; max-width: 240px; margin: 0 auto; width: 100%; }
        
        /* Fase cards (Macro) */
        .phases { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .phase-card { background: white; border: 1px solid #e2e8f0; border-radius: 10px; padding: 15px; border-left: 5px solid #e2e8f0; }
        .phase-card.verde { border-left-color: #22c55e; }
        .phase-card.amarelo { border-left-color: #f59e0b; }
        .phase-card.vermelho { border-left-color: #ef4444; }
        
        .phase-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px; }
        .phase-title { font-weight: 700; color: #1e293b; font-size: 0.9em; }
        .phase-count { font-size: 0.8em; color: #64748b; display: flex; align-items: center; gap: 5px; }
        .phase-alert { background: #fee2e2; color: #dc2626; padding: 2px 6px; border-radius: 10px; font-size: 0.7em; }
        .phase-percent { font-size: 1.4em; font-weight: 700; }
        .phase-percent.verde { color: #22c55e; }
        .phase-percent.amarelo { color: #f59e0b; }
        .phase-percent.vermelho { color: #ef4444; }
        
        .phase-bar { height: 8px; background: #e2e8f0; border-radius: 4px; margin-bottom: 10px; overflow: hidden; }
        .phase-bar-fill { height: 100%; border-radius: 4px; }
        .phase-bar-fill.verde { background: #22c55e; }
        .phase-bar-fill.amarelo { background: #f59e0b; }
        .phase-bar-fill.vermelho { background: #ef4444; }
        
        .phase-context { font-size: 0.78em; padding: 6px 10px; border-radius: 6px; margin-bottom: 8px; }
        .phase-context.warning { background: #fef3c7; color: #92400e; }
        .phase-context.danger { background: #fee2e2; color: #dc2626; }
        
        .phase-info { font-size: 0.8em; color: #64748b; margin-bottom: 8px; }
        .phase-projects { display: flex; flex-wrap: wrap; gap: 5px; }
        .badge { background: #f1f5f9; color: #475569; padding: 4px 10px; border-radius: 8px; font-size: 0.75em; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .badge:hover { background: #667eea; color: white; }
        .badge.critico { background: #fee2e2; color: #dc2626; }
        .badge.critico:hover { background: #dc2626; color: white; }
        .badge.concluido { background: #dcfce7; color: #166534; }
        .badge.concluido:hover { background: #22c55e; color: white; }
        
        /* Project cards (Micro) */
        .projects { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 15px; }
        .project-card { background: white; border: 1px solid #e2e8f0; border-radius: 10px; padding: 15px; cursor: pointer; transition: all 0.2s; border-left: 5px solid #e2e8f0; }
        .project-card:hover { box-shadow: 0 5px 20px rgba(0,0,0,0.1); transform: translateY(-2px); }
        .project-card.verde { border-left-color: #22c55e; }
        .project-card.amarelo { border-left-color: #f59e0b; }
        .project-card.vermelho { border-left-color: #ef4444; }
        
        .project-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px; }
        .project-name { font-weight: 700; color: #1e293b; font-size: 1.05em; }
        .priority { padding: 3px 8px; border-radius: 4px; font-size: 0.7em; font-weight: 700; }
        .priority.alta { background: #fee2e2; color: #dc2626; }
        .priority.media { background: #fef3c7; color: #d97706; }
        .priority.baixa { background: #dcfce7; color: #16a34a; }
        
        .project-meta { display: flex; flex-wrap: wrap; gap: 12px; font-size: 0.82em; color: #64748b; margin-bottom: 10px; }
        .project-phase { background: #eff6ff; color: #1d4ed8; padding: 5px 10px; border-radius: 6px; font-size: 0.8em; margin-bottom: 10px; display: inline-block; }
        
        .progress { margin-bottom: 10px; }
        .progress-header { display: flex; justify-content: space-between; font-size: 0.85em; margin-bottom: 4px; }
        .progress-bar { height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 3px; }
        .progress-fill.verde { background: #22c55e; }
        .progress-fill.amarelo { background: #f59e0b; }
        .progress-fill.vermelho { background: #ef4444; }
        
        .project-footer { display: flex; justify-content: space-between; align-items: center; }
        .status-badge { padding: 4px 10px; border-radius: 5px; font-size: 0.75em; font-weight: 600; }
        .status-badge.concluido { background: #dcfce7; color: #166534; }
        .status-badge.em-andamento { background: #dbeafe; color: #1e40af; }
        .status-badge.planejamento { background: #f3e8ff; color: #7c3aed; }
        .status-badge.atrasado { background: #fee2e2; color: #991b1b; }
        
        .empty { text-align: center; padding: 40px; color: #64748b; }
        
        /* Modal */
        .modal-bg { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; padding: 20px; }
        .modal-bg.show { display: flex; }
        .modal { background: white; border-radius: 12px; max-width: 650px; width: 100%; max-height: 85vh; overflow: hidden; }
        .modal-head { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .modal-head h2 { font-size: 1.1em; }
        .modal-close { background: rgba(255,255,255,0.2); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 1.2em; }
        .modal-body { padding: 20px; max-height: calc(85vh - 60px); overflow-y: auto; }
        
        .modal-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0; }
        .modal-info-item { font-size: 0.85em; }
        .modal-info-item .label { color: #64748b; display: block; font-size: 0.85em; }
        .modal-info-item .value { color: #1e293b; font-weight: 600; }
        
        /* Hist√≥rico de Tratativas */
        .tratativas-section { background: #f8fafc; padding: 15px; border-radius: 10px; margin-top: 15px; }
        .tratativas-header { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; color: #475569; font-weight: 600; font-size: 0.95em; }
        .tratativas-empty { text-align: center; padding: 20px; background: #fff; border-radius: 8px; border: 2px dashed #e2e8f0; }
        .tratativas-empty .msg { color: #f59e0b; font-weight: 500; margin-bottom: 5px; }
        .tratativas-empty .sub { color: #94a3b8; font-size: 0.85em; }
        .tratativa-item { background: #fff; border-radius: 8px; padding: 12px; margin-bottom: 10px; border-left: 4px solid #667eea; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .tratativa-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px; }
        .tratativa-user { display: flex; align-items: center; gap: 8px; }
        .tratativa-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: #fff; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.8em; }
        .tratativa-user-info .name { font-weight: 600; color: #1e293b; font-size: 0.85em; }
        .tratativa-user-info .role { font-size: 0.7em; color: #64748b; }
        .tratativa-date { font-size: 0.7em; color: #94a3b8; }
        .tratativa-content { color: #475569; font-size: 0.85em; line-height: 1.4; padding: 8px; background: #f8fafc; border-radius: 6px; }
        .tratativa-type { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 0.65em; font-weight: 600; margin-bottom: 6px; }
        .tratativa-type.comentario { background: #dbeafe; color: #1e40af; }
        .tratativa-type.atualizacao { background: #dcfce7; color: #166534; }
        .tratativa-type.alerta { background: #fee2e2; color: #991b1b; }
        .tratativa-type.resolucao { background: #f3e8ff; color: #7c3aed; }
        
        .timestamp { text-align: center; padding: 15px; color: #94a3b8; font-size: 0.8em; border-top: 1px solid #e2e8f0; margin-top: 15px; }
        
        @media (max-width: 768px) {
            .header { flex-direction: column; text-align: center; }
            .filters { grid-template-columns: 1fr 1fr; }
            .phases, .projects { grid-template-columns: 1fr; }
            .kpis { grid-template-columns: repeat(2, 1fr); }
            .kpis .kpi:last-child { grid-column: span 2; max-width: 50%; margin: 0 auto; }
        }
        
        @media print {
            body { background: white !important; padding: 10px !important; }
            .container { box-shadow: none !important; }
            .nav-buttons, .toggle, .filters, .checkbox-group { display: none !important; }
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <header class="header">
            <div class="header-left">
                <h1>üìä Dashboard de Infraestrutura</h1>
                <p>Gest√£o de Projetos | Invent Corp</p>
            </div>
            <nav class="nav-buttons">
                <a href="view-detalhada.html" class="nav-btn green">üìã Vis√£o Detalhada</a>
                <button class="nav-btn purple" onclick="window.print()">üñ®Ô∏è Imprimir</button>
                <button class="nav-btn blue" onclick="window.print()">üìÑ Gerar PDF</button>
            </nav>
        </header>
        
        <main class="content">
            <div class="toggle">
                <button id="btnMacro" class="active" onclick="setView('macro')">üìä Vis√£o Executiva (Macro)</button>
                <button id="btnMicro" onclick="setView('micro')">üìã Vis√£o por Projeto (Micro)</button>
            </div>
            
            <div class="phases-legend">
                <strong>Fases:</strong> 1. Inicia√ß√£o ¬∑ 2. Planejamento ¬∑ 3. Provisionamento ¬∑ 4. Implementa√ß√£o ¬∑ 5. Testes ¬∑ 6. Deploy ¬∑ 7. Estabiliza√ß√£o ¬∑ 8. Encerramento
            </div>
            
            <div class="kpis" id="kpis"></div>
            
            <div class="filters">
                <div class="filter-group">
                    <label>üîç Buscar:</label>
                    <input type="text" id="search" placeholder="Nome do projeto..." oninput="render()">
                </div>
                <div class="filter-group">
                    <label>üìä Status:</label>
                    <select id="filterStatus" onchange="render()">
                        <option value="">Todos</option>
                        <option value="Conclu√≠do">Conclu√≠do</option>
                        <option value="Em andamento">Em andamento</option>
                        <option value="Planejamento">Planejamento</option>
                        <option value="Atrasado">Atrasado</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>‚ö° Prioridade:</label>
                    <select id="filterPrior" onchange="render()">
                        <option value="">Todas</option>
                        <option value="Alta">Alta</option>
                        <option value="M√©dia">M√©dia</option>
                        <option value="Baixa">Baixa</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>üìç Local:</label>
                    <select id="filterLocal" onchange="render()"></select>
                </div>
                <div class="filter-group">
                    <label>üë§ Respons√°vel:</label>
                    <select id="filterResp" onchange="render()"></select>
                </div>
                <label class="checkbox-group">
                    <input type="checkbox" id="filterCritico" onchange="render()">
                    <span>üî∫ Apenas Cr√≠ticos</span>
                </label>
            </div>
            
            <div class="phases" id="macroView"></div>
            <div class="projects" id="microView" style="display:none"></div>
            
            <div class="timestamp" id="ts"></div>
        </main>
    </div>
    
    <!-- Modal Projeto -->
    <div class="modal-bg" id="modalProjeto" onclick="fecharModal()">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-head">
                <h2 id="modalTitle">üìã Projeto</h2>
                <button class="modal-close" onclick="fecharModal()">√ó</button>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

<script>
// 30 PROJETOS
const PROJETOS = [
    { nome: 'BARBECUE B2B', local: 'S√£o Paulo - SP', resp: 'ALEX', prioridade: 'Alta', status: 'Conclu√≠do', fase: '8. Encerramento', progresso: 100 },
    { nome: 'BELEZA', local: 'S√£o Paulo - SP', resp: 'ANDERSON', prioridade: 'M√©dia', status: 'Conclu√≠do', fase: '8. Encerramento', progresso: 100 },
    { nome: 'BETA', local: 'Rio de Janeiro - RJ', resp: 'ANDERSON', prioridade: 'Alta', status: 'Conclu√≠do', fase: '8. Encerramento', progresso: 100 },
    { nome: 'BETA ESTEIO', local: 'Esteio - RS', resp: 'ANDERSON', prioridade: 'M√©dia', status: 'Planejamento', fase: '1. Inicia√ß√£o', progresso: 5 },
    { nome: 'BP', local: 'S√£o Paulo - SP', resp: 'GIOVANNI', prioridade: 'M√©dia', status: 'Em andamento', fase: '2. Planejamento & Documenta√ß√£o', progresso: 15 },
    { nome: 'BR', local: 'Jaboat√£o - PE', resp: 'F√ÅBIO', prioridade: 'Alta', status: 'Planejamento', fase: '1. Inicia√ß√£o', progresso: 5 },
    { nome: 'CANDELABRIA', local: 'Candel√°ria - RS', resp: 'ALEX', prioridade: 'M√©dia', status: 'Conclu√≠do', fase: '8. Encerramento', progresso: 100 },
    { nome: 'CDSK', local: 'S√£o Paulo - SP', resp: 'VINICIUS', prioridade: 'Alta', status: 'Em andamento', fase: '6. Deploy', progresso: 75 },
    { nome: 'COUGAR', local: 'S√£o Paulo - SP', resp: 'LEANDRO', prioridade: 'Alta', status: 'Conclu√≠do', fase: '8. Encerramento', progresso: 100 },
    { nome: 'CRISTAL MG RETROFIT', local: 'Belo Horizonte - MG', resp: 'GIOVANNI', prioridade: 'Alta', status: 'Em andamento', fase: '2. Planejamento & Documenta√ß√£o', progresso: 15 },
    { nome: 'DIA', local: 'S√£o Paulo - SP', resp: 'ANDERSON', prioridade: 'Alta', status: 'Atrasado', fase: '3. Provisionamento', progresso: 30 },
    { nome: 'DIAMANTE', local: 'Curitiba - PR', resp: 'F√ÅBIO', prioridade: 'M√©dia', status: 'Planejamento', fase: '1. Inicia√ß√£o', progresso: 0 },
    { nome: 'ELETRO', local: 'S√£o Paulo - SP', resp: 'GIOVANNI', prioridade: 'M√©dia', status: 'Em andamento', fase: '4. Implementa√ß√£o', progresso: 35 },
    { nome: 'ESPERAN√áA', local: 'Belo Horizonte - MG', resp: 'VINICIUS', prioridade: 'M√©dia', status: 'Conclu√≠do', fase: '8. Encerramento', progresso: 100 },
    { nome: 'FLOWER', local: 'S√£o Paulo - SP', resp: 'ANDERSON', prioridade: 'Baixa', status: 'Em andamento', fase: '2. Planejamento & Documenta√ß√£o', progresso: 10 },
    { nome: 'GAVI√ÉO', local: 'Fortaleza - CE', resp: 'F√ÅBIO', prioridade: 'Alta', status: 'Conclu√≠do', fase: '8. Encerramento', progresso: 100 },
    { nome: 'MKT CHILE', local: 'Santiago - Chile', resp: 'ALEX', prioridade: 'M√©dia', status: 'Planejamento', fase: '1. Inicia√ß√£o', progresso: 0 },
    { nome: 'MKT PERU', local: 'Lima - Peru', resp: 'ALEX', prioridade: 'M√©dia', status: 'Planejamento', fase: '1. Inicia√ß√£o', progresso: 0 },
    { nome: 'MASTER', local: 'S√£o Paulo - SP', resp: 'LEANDRO', prioridade: 'Alta', status: 'Planejamento', fase: '1. Inicia√ß√£o', progresso: 0 },
    { nome: 'NAVEPARK', local: 'Curitiba - PR', resp: 'ANDERSON', prioridade: 'M√©dia', status: 'Em andamento', fase: '3. Provisionamento', progresso: 25 },
    { nome: 'OCTOPUS MS', local: 'Campo Grande - MS', resp: 'ALEX', prioridade: 'M√©dia', status: 'Em andamento', fase: '4. Implementa√ß√£o', progresso: 40 },
    { nome: 'OCTOPUS SC', local: 'Florian√≥polis - SC', resp: 'ALEX', prioridade: 'M√©dia', status: 'Conclu√≠do', fase: '8. Encerramento', progresso: 100 },
    { nome: 'OPTIMUS PRIME', local: 'S√£o Paulo - SP', resp: 'GIOVANNI', prioridade: 'Alta', status: 'Conclu√≠do', fase: '8. Encerramento', progresso: 100 },
    { nome: 'PBL GUATEMALA', local: 'Guatemala City', resp: 'F√ÅBIO', prioridade: 'Alta', status: 'Em andamento', fase: '4. Implementa√ß√£o', progresso: 45 },
    { nome: 'PROMO B2B CD GRU', local: 'Guarulhos - SP', resp: 'LEANDRO', prioridade: 'Alta', status: 'Conclu√≠do', fase: '8. Encerramento', progresso: 100 },
    { nome: 'PTL SP', local: 'S√£o Paulo - SP', resp: 'VINICIUS', prioridade: 'M√©dia', status: 'Conclu√≠do', fase: '8. Encerramento', progresso: 100 },
    { nome: 'REISADO', local: 'Recife - PE', resp: 'F√ÅBIO', prioridade: 'M√©dia', status: 'Conclu√≠do', fase: '8. Encerramento', progresso: 100 },
    { nome: 'REVERSE', local: 'S√£o Paulo - SP', resp: 'ALEX', prioridade: 'Alta', status: 'Em andamento', fase: '5. Testes & Homologa√ß√£o', progresso: 55 },
    { nome: 'SUPER DIVINOPOLIS', local: 'Divin√≥polis - MG', resp: 'GIOVANNI', prioridade: 'M√©dia', status: 'Em andamento', fase: '4. Implementa√ß√£o', progresso: 50 },
    { nome: 'TITANIO', local: 'S√£o Paulo - SP', resp: 'ALEX', prioridade: 'Alta', status: 'Em andamento', fase: '7. Estabiliza√ß√£o', progresso: 80 }
];

const FASES = [
    '1. Inicia√ß√£o',
    '2. Planejamento & Documenta√ß√£o', 
    '3. Provisionamento',
    '4. Implementa√ß√£o',
    '5. Testes & Homologa√ß√£o',
    '6. Deploy',
    '7. Estabiliza√ß√£o',
    '8. Encerramento'
];

// TRATATIVAS PARA TODOS OS 30 PROJETOS
const TRATATIVAS = {
    'BARBECUE B2B': [
        { user: 'ALEX', role: 'PMO', date: '06/02/2026 10:00', type: 'resolucao', content: 'Projeto conclu√≠do com sucesso. Assistido realizado.' },
        { user: 'DOUGLAS', role: 'Diretor', date: '06/02/2026 14:00', type: 'comentario', content: 'Excelente trabalho da equipe. Entrega no prazo!' }
    ],
    'BELEZA': [
        { user: 'ANDERSON', role: 'PMO', date: '30/11/2025 09:00', type: 'resolucao', content: 'Go Live realizado. Todas as fases conclu√≠das.' },
        { user: 'DAIANA', role: 'Gestora', date: '30/11/2025 11:00', type: 'comentario', content: 'Projeto finalizado dentro do escopo previsto.' }
    ],
    'BETA': [
        { user: 'ANDERSON', role: 'PMO', date: '10/03/2026 09:00', type: 'atualizacao', content: 'Go Live realizado com sucesso em 10/03.' },
        { user: 'DOUGLAS', role: 'Diretor', date: '10/03/2026 15:00', type: 'comentario', content: 'Parab√©ns pela entrega!' }
    ],
    'BETA ESTEIO': [
        { user: 'ANDERSON', role: 'PMO', date: '16/01/2026 09:00', type: 'atualizacao', content: 'Kickoff realizado em 16/01. Projeto iniciado.' },
        { user: 'DAIANA', role: 'Gestora', date: '20/01/2026 10:00', type: 'comentario', content: 'Acompanhar evolu√ß√£o do levantamento de requisitos.' }
    ],
    'BP': [
        { user: 'GIOVANNI', role: 'PMO', date: '01/03/2026 10:00', type: 'atualizacao', content: 'Documenta√ß√£o t√©cnica em elabora√ß√£o.' },
        { user: 'GIOVANNI', role: 'PMO', date: '15/01/2026 14:00', type: 'comentario', content: 'Aguardando defini√ß√£o de escopo com cliente.' }
    ],
    'BR': [
        { user: 'F√ÅBIO', role: 'PMO', date: '29/01/2026 09:00', type: 'atualizacao', content: 'Aguardando Kickoff. Data prevista para pr√≥xima semana.' },
        { user: 'DAIANA', role: 'Gestora', date: '30/01/2026 11:00', type: 'comentario', content: 'Prioridade alta. Acompanhar de perto.' }
    ],
    'CANDELABRIA': [
        { user: 'ALEX', role: 'PMO', date: '09/12/2025 10:00', type: 'resolucao', content: 'Go Live 09/12. Projeto encerrado.' },
        { user: 'DOUGLAS', role: 'Diretor', date: '09/12/2025 15:00', type: 'comentario', content: '√ìtima entrega regional.' }
    ],
    'CDSK': [
        { user: 'VINICIUS', role: 'PMO', date: '05/02/2026 08:00', type: 'atualizacao', content: 'Deploy da Fase 1 iniciado. Janela: 08:00-12:00.' },
        { user: 'VINICIUS', role: 'PMO', date: '05/02/2026 11:45', type: 'resolucao', content: 'Deploy conclu√≠do com sucesso! Monitoramento ativo.' },
        { user: 'DAIANA', role: 'Gestora', date: '06/02/2026 09:00', type: 'comentario', content: 'Acompanhar estabiliza√ß√£o p√≥s-deploy.' }
    ],
    'COUGAR': [
        { user: 'LEANDRO', role: 'PMO', date: '09/02/2026 10:00', type: 'resolucao', content: 'Go Live B2B realizado com sucesso!' },
        { user: 'DOUGLAS', role: 'Diretor', date: '09/02/2026 15:00', type: 'comentario', content: 'Excelente trabalho da equipe. Parab√©ns!' }
    ],
    'CRISTAL MG RETROFIT': [
        { user: 'GIOVANNI', role: 'PMO', date: '01/02/2026 09:00', type: 'alerta', content: 'Escopo em revis√£o. Cliente solicitou altera√ß√µes.' },
        { user: 'DAIANA', role: 'Gestora', date: '02/02/2026 11:00', type: 'comentario', content: 'Agendar reuni√£o para alinhar novo escopo.' },
        { user: 'GIOVANNI', role: 'PMO', date: '03/02/2026 14:00', type: 'atualizacao', content: 'Reuni√£o agendada para 05/02.' }
    ],
    'DIA': [
        { user: 'ANDERSON', role: 'PMO', date: '15/01/2026 10:00', type: 'alerta', content: 'ATEN√á√ÉO: Aguardando libera√ß√£o de VPN pelo cliente. Prazo comprometido.' },
        { user: 'DAIANA', role: 'Gestora', date: '15/01/2026 11:30', type: 'comentario', content: 'Escalar para gerente de TI do cliente. VPN urgente.' },
        { user: 'ANDERSON', role: 'PMO', date: '18/01/2026 09:00', type: 'atualizacao', content: 'Reuni√£o agendada com TI do cliente para 20/01.' },
        { user: 'DOUGLAS', role: 'Diretor', date: '20/01/2026 16:00', type: 'comentario', content: 'Acompanhando de perto. Manter atualizado sobre VPN.' }
    ],
    'DIAMANTE': [
        { user: 'F√ÅBIO', role: 'PMO', date: '15/02/2026 09:00', type: 'atualizacao', content: 'Novo projeto. Aguardando kickoff previsto para 15/02.' },
        { user: 'DAIANA', role: 'Gestora', date: '10/02/2026 10:00', type: 'comentario', content: 'Preparar documenta√ß√£o inicial.' }
    ],
    'ELETRO': [
        { user: 'GIOVANNI', role: 'PMO', date: '01/02/2026 10:00', type: 'atualizacao', content: 'Implementa√ß√£o em andamento. 35% conclu√≠do.' },
        { user: 'GIOVANNI', role: 'PMO', date: '25/01/2026 14:00', type: 'comentario', content: 'Equipe t√©cnica alocada. Progredindo conforme planejado.' }
    ],
    'ESPERAN√áA': [
        { user: 'VINICIUS', role: 'PMO', date: '19/01/2026 10:00', type: 'resolucao', content: 'Go Live 19/01. Projeto conclu√≠do com sucesso.' },
        { user: 'DAIANA', role: 'Gestora', date: '19/01/2026 15:00', type: 'comentario', content: '√ìtima entrega. Documenta√ß√£o finalizada.' }
    ],
    'FLOWER': [
        { user: 'ANDERSON', role: 'PMO', date: '22/01/2026 09:00', type: 'atualizacao', content: 'Avalia√ß√£o conceitual em andamento.' },
        { user: 'ANDERSON', role: 'PMO', date: '28/01/2026 11:00', type: 'comentario', content: 'Baixa prioridade. Progresso conforme esperado.' }
    ],
    'GAVI√ÉO': [
        { user: 'F√ÅBIO', role: 'PMO', date: '01/02/2026 10:00', type: 'resolucao', content: 'Go Live realizado. Projeto encerrado.' },
        { user: 'DOUGLAS', role: 'Diretor', date: '01/02/2026 14:00', type: 'comentario', content: 'Entrega regional Nordeste conclu√≠da.' }
    ],
    'MKT CHILE': [
        { user: 'ALEX', role: 'PMO', date: '01/06/2026 09:00', type: 'atualizacao', content: 'Projeto internacional. Aguardando kickoff em Junho.' },
        { user: 'DAIANA', role: 'Gestora', date: '15/01/2026 10:00', type: 'comentario', content: 'Preparar documenta√ß√£o para projeto internacional.' }
    ],
    'MKT PERU': [
        { user: 'ALEX', role: 'PMO', date: '01/06/2026 09:00', type: 'atualizacao', content: 'Aguardando pedido formal. Kickoff previsto para Junho.' },
        { user: 'ALEX', role: 'PMO', date: '20/01/2026 11:00', type: 'comentario', content: 'Alinhamento com equipe internacional em andamento.' }
    ],
    'MASTER': [
        { user: 'LEANDRO', role: 'PMO', date: '01/03/2026 09:00', type: 'atualizacao', content: 'Aguardando requisitos do cliente.' },
        { user: 'DAIANA', role: 'Gestora', date: '25/01/2026 10:00', type: 'comentario', content: 'Prioridade alta. Agendar reuni√£o de kickoff.' }
    ],
    'NAVEPARK': [
        { user: 'ANDERSON', role: 'PMO', date: '20/01/2026 09:00', type: 'comentario', content: 'Aguardando sinal do datacenter.' },
        { user: 'ANDERSON', role: 'PMO', date: '25/01/2026 14:00', type: 'atualizacao', content: 'Sinal recebido. Configura√ß√£o em andamento.' }
    ],
    'OCTOPUS MS': [
        { user: 'ALEX', role: 'PMO', date: '01/01/2026 09:30', type: 'atualizacao', content: 'Kickoff realizado com sucesso. Participantes: equipe t√©cnica, cliente e stakeholders.' },
        { user: 'DAIANA', role: 'Gestora', date: '01/01/2026 14:15', type: 'comentario', content: 'Excelente in√≠cio! Garantir documenta√ß√£o compartilhada com todos.' },
        { user: 'ALEX', role: 'PMO', date: '15/01/2026 10:00', type: 'atualizacao', content: 'Implementa√ß√£o iniciada. M√≥dulos de integra√ß√£o em desenvolvimento.' }
    ],
    'OCTOPUS SC': [
        { user: 'ALEX', role: 'PMO', date: '15/12/2025 10:00', type: 'resolucao', content: 'Projeto finalizado. Go Live em 15/12.' },
        { user: 'DAIANA', role: 'Gestora', date: '15/12/2025 15:00', type: 'comentario', content: '√ìtima entrega regional Sul.' }
    ],
    'OPTIMUS PRIME': [
        { user: 'GIOVANNI', role: 'PMO', date: '27/10/2025 10:00', type: 'resolucao', content: 'Assistido OK. Projeto encerrado com sucesso.' },
        { user: 'DOUGLAS', role: 'Diretor', date: '27/10/2025 14:00', type: 'comentario', content: 'Entrega r√°pida e eficiente.' }
    ],
    'PBL GUATEMALA': [
        { user: 'F√ÅBIO', role: 'PMO', date: '25/01/2026 10:00', type: 'atualizacao', content: 'Implementa√ß√£o em andamento. 60% dos m√≥dulos conclu√≠dos.' },
        { user: 'F√ÅBIO', role: 'PMO', date: '28/01/2026 15:30', type: 'alerta', content: 'Problema de compatibilidade com sistema legado identificado.' },
        { user: 'DAIANA', role: 'Gestora', date: '29/01/2026 09:00', type: 'comentario', content: 'Qual o impacto no cronograma? Avaliar riscos.' },
        { user: 'F√ÅBIO', role: 'PMO', date: '30/01/2026 11:00', type: 'resolucao', content: 'Problema resolvido com workaround. Cronograma mantido.' }
    ],
    'PROMO B2B CD GRU': [
        { user: 'LEANDRO', role: 'PMO', date: '04/02/2026 10:00', type: 'resolucao', content: 'Go Live IA 04/02. Sistema em produ√ß√£o.' },
        { user: 'DOUGLAS', role: 'Diretor', date: '04/02/2026 15:00', type: 'comentario', content: 'Integra√ß√£o com CD Guarulhos bem-sucedida.' }
    ],
    'PTL SP': [
        { user: 'VINICIUS', role: 'PMO', date: '30/10/2025 10:00', type: 'resolucao', content: 'Projeto finalizado. Todas as fases conclu√≠das.' },
        { user: 'DAIANA', role: 'Gestora', date: '30/10/2025 14:00', type: 'comentario', content: 'Documenta√ß√£o de encerramento OK.' }
    ],
    'REISADO': [
        { user: 'F√ÅBIO', role: 'PMO', date: '20/12/2025 10:00', type: 'resolucao', content: 'Go Live realizado. Projeto encerrado.' },
        { user: 'F√ÅBIO', role: 'PMO', date: '20/12/2025 15:00', type: 'comentario', content: 'Entrega regional Nordeste finalizada.' }
    ],
    'REVERSE': [
        { user: 'ALEX', role: 'PMO', date: '28/01/2026 14:00', type: 'atualizacao', content: 'Testes iniciados. Cobertura atual: 45%.' },
        { user: 'ALEX', role: 'PMO', date: '01/02/2026 16:00', type: 'atualizacao', content: 'Cobertura de testes em 78%. Bugs corrigidos.' },
        { user: 'DAIANA', role: 'Gestora', date: '02/02/2026 10:00', type: 'comentario', content: 'Acompanhar homologa√ß√£o com cliente.' }
    ],
    'SUPER DIVINOPOLIS': [
        { user: 'GIOVANNI', role: 'PMO', date: '01/02/2026 10:00', type: 'atualizacao', content: 'Implementa√ß√£o em 50%. Progresso conforme planejado.' },
        { user: 'GIOVANNI', role: 'PMO', date: '25/01/2026 09:00', type: 'comentario', content: 'Equipe local engajada. Sem impedimentos.' }
    ],
    'TITANIO': [
        { user: 'ALEX', role: 'PMO', date: '01/02/2026 14:00', type: 'atualizacao', content: 'Per√≠odo de estabiliza√ß√£o iniciado. Monitoramento 24/7 ativo.' },
        { user: 'ALEX', role: 'PMO', date: '02/02/2026 09:00', type: 'comentario', content: 'Nenhum incidente nas primeiras 24h. Sistema est√°vel.' },
        { user: 'DAIANA', role: 'Gestora', date: '02/02/2026 15:00', type: 'comentario', content: 'Manter monitoramento. Preparar para encerramento.' }
    ]
};

let view = 'macro';
let projetoFiltro = null;

function isCritico(p) {
    return p.status === 'Atrasado' || p.prioridade === 'Alta';
}

function getCor(pct) {
    return pct >= 80 ? 'verde' : pct >= 40 ? 'amarelo' : 'vermelho';
}

function getStatusClass(s) {
    return s.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/ /g, '-');
}

function getTipoLabel(type) {
    const labels = { 'comentario': 'üí¨ Coment√°rio', 'atualizacao': 'üìù Atualiza√ß√£o', 'alerta': '‚ö†Ô∏è Alerta', 'resolucao': '‚úÖ Resolu√ß√£o' };
    return labels[type] || type;
}

function getProjetosFiltrados() {
    const s = document.getElementById('search').value.toLowerCase();
    const st = document.getElementById('filterStatus').value;
    const pr = document.getElementById('filterPrior').value;
    const lo = document.getElementById('filterLocal').value;
    const re = document.getElementById('filterResp').value;
    const cr = document.getElementById('filterCritico').checked;
    
    return PROJETOS.filter(p => {
        if (s && !p.nome.toLowerCase().includes(s)) return false;
        if (st && p.status !== st) return false;
        if (pr && p.prioridade !== pr) return false;
        if (lo && p.local !== lo) return false;
        if (re && p.resp !== re) return false;
        if (cr && !isCritico(p)) return false;
        if (projetoFiltro && p.nome !== projetoFiltro) return false;
        return true;
    });
}

function populateFilters() {
    const l = [...new Set(PROJETOS.map(p => p.local))].sort();
    const r = [...new Set(PROJETOS.map(p => p.resp))].sort();
    document.getElementById('filterLocal').innerHTML = '<option value="">Todos</option>' + l.map(x => `<option value="${x}">${x}</option>`).join('');
    document.getElementById('filterResp').innerHTML = '<option value="">Todos</option>' + r.map(x => `<option value="${x}">${x}</option>`).join('');
}

function renderKPIs() {
    const ps = getProjetosFiltrados();
    const t = ps.length;
    const c = ps.filter(p => p.status === 'Conclu√≠do').length;
    const e = ps.filter(p => p.status === 'Em andamento').length;
    const a = ps.filter(p => p.status === 'Atrasado').length;
    const cr = ps.filter(p => isCritico(p)).length;
    
    const kpisEl = document.getElementById('kpis');
    
    // Layout diferente para MICRO
    if (view === 'micro') {
        kpisEl.classList.add('micro-layout');
    } else {
        kpisEl.classList.remove('micro-layout');
    }
    
    kpisEl.innerHTML = `
        <div class="kpi azul" onclick="limparFiltros()"><div class="num">${t}</div><div class="lbl">Total</div></div>
        <div class="kpi verde" onclick="filtrarStatus('Conclu√≠do')"><div class="num">${c}</div><div class="lbl">Conclu√≠dos</div></div>
        <div class="kpi amarelo" onclick="filtrarStatus('Em andamento')"><div class="num">${e}</div><div class="lbl">Em Andamento</div></div>
        <div class="kpi vermelho" onclick="filtrarStatus('Atrasado')"><div class="num">${a}</div><div class="lbl">Atrasados</div></div>
        <div class="kpi rosa" onclick="filtrarCriticos()"><div class="num">${cr}</div><div class="lbl">Cr√≠ticos</div></div>
    `;
}

function filtrarStatus(s) {
    document.getElementById('filterStatus').value = s;
    document.getElementById('filterCritico').checked = false;
    render();
}

function limparFiltros() {
    document.getElementById('filterStatus').value = '';
    document.getElementById('filterCritico').checked = false;
    projetoFiltro = null;
    render();
}

function filtrarCriticos() {
    document.getElementById('filterCritico').checked = true;
    document.getElementById('filterStatus').value = '';
    render();
}

function irParaProjeto(nome) {
    projetoFiltro = nome;
    setView('micro');
}

function setView(v) {
    view = v;
    document.getElementById('btnMacro').classList.toggle('active', v === 'macro');
    document.getElementById('btnMicro').classList.toggle('active', v === 'micro');
    document.getElementById('macroView').style.display = v === 'macro' ? 'grid' : 'none';
    document.getElementById('microView').style.display = v === 'micro' ? 'grid' : 'none';
    
    // Limpar filtro de projeto ao voltar para macro
    if (v === 'macro') projetoFiltro = null;
    
    render();
}

function render() {
    renderKPIs();
    if (view === 'macro') renderMacro();
    else renderMicro();
    document.getElementById('ts').textContent = 'Atualizado em: ' + new Date().toLocaleString('pt-BR');
}

function renderMacro() {
    const c = document.getElementById('macroView');
    const ps = getProjetosFiltrados();
    
    const porFase = {};
    FASES.forEach(f => porFase[f] = []);
    ps.forEach(p => {
        if (porFase[p.fase]) porFase[p.fase].push(p);
    });
    
    let h = '';
    FASES.forEach(f => {
        const pjs = porFase[f];
        if (!pjs.length) return;
        
        const total = pjs.length;
        const concluidos = pjs.filter(p => p.progresso === 100).length;
        const pct = total ? Math.round((concluidos / total) * 100) : 0;
        const cor = getCor(pct);
        
        const temAtrasado = pjs.some(p => p.status === 'Atrasado');
        const temCritico = pjs.some(p => isCritico(p) && p.status !== 'Conclu√≠do');
        
        let ctx = '';
        if (temAtrasado) {
            ctx = '<div class="phase-context danger">üî∫ Projeto(s) atrasado(s)</div>';
        } else if (temCritico && pct < 50) {
            ctx = '<div class="phase-context warning">‚ö†Ô∏è Aten√ß√£o ao cronograma</div>';
        }
        
        h += `
            <div class="phase-card ${cor}">
                <div class="phase-header">
                    <div>
                        <span class="phase-title">${f}</span>
                        <div class="phase-count">${pjs.length} projeto${pjs.length > 1 ? 's' : ''} ${temCritico ? '<span class="phase-alert">‚ö†Ô∏è</span>' : ''}</div>
                    </div>
                    <span class="phase-percent ${cor}">${pct}%</span>
                </div>
                <div class="phase-bar"><div class="phase-bar-fill ${cor}" style="width:${pct}%"></div></div>
                ${ctx}
                <div class="phase-info">${concluidos}/${total} atividades conclu√≠das</div>
                <div class="phase-projects">
                    ${pjs.map(p => {
                        let cls = '';
                        if (p.status === 'Conclu√≠do') cls = 'concluido';
                        else if (isCritico(p)) cls = 'critico';
                        return `<span class="badge ${cls}" onclick="irParaProjeto('${p.nome}')">${p.nome}</span>`;
                    }).join('')}
                </div>
            </div>
        `;
    });
    
    c.innerHTML = h || '<div class="empty">Nenhum projeto encontrado</div>';
}

function renderMicro() {
    const c = document.getElementById('microView');
    const ps = getProjetosFiltrados();
    
    if (!ps.length) {
        c.innerHTML = '<div class="empty">Nenhum projeto encontrado</div>';
        return;
    }
    
    c.innerHTML = ps.map(p => {
        const cor = getCor(p.progresso);
        return `
            <div class="project-card ${cor}" onclick="abrirModal('${p.nome}')">
                <div class="project-header">
                    <span class="project-name">${p.nome}</span>
                    <span class="priority ${p.prioridade.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '')}">${p.prioridade}</span>
                </div>
                <div class="project-meta">
                    <span>üìç ${p.local}</span>
                    <span>üë§ ${p.resp}</span>
                </div>
                <div class="project-phase">üìò ${p.fase}</div>
                <div class="progress">
                    <div class="progress-header">
                        <span>Progresso</span>
                        <span style="color:${cor === 'verde' ? '#22c55e' : cor === 'amarelo' ? '#f59e0b' : '#ef4444'}">${p.progresso}%</span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill ${cor}" style="width:${p.progresso}%"></div></div>
                </div>
                <div class="project-footer">
                    <span class="status-badge ${getStatusClass(p.status)}">${p.status}</span>
                    ${p.status === 'Atrasado' ? '<span style="color:#dc2626;font-size:0.75em;font-weight:600">üö® Cr√≠tico</span>' : ''}
                </div>
            </div>
        `;
    }).join('');
}

function abrirModal(nome) {
    const p = PROJETOS.find(x => x.nome === nome);
    if (!p) return;
    
    const tratativas = TRATATIVAS[nome] || [];
    
    let tratativasHtml = '';
    if (tratativas.length === 0) {
        tratativasHtml = `
            <div class="tratativas-empty">
                <div class="msg">Nenhuma tratativa registrada ainda.</div>
                <div class="sub">Em vers√µes futuras, aqui aparecer√£o todas as atualiza√ß√µes e coment√°rios deste projeto.</div>
            </div>
        `;
    } else {
        tratativasHtml = tratativas.map(t => `
            <div class="tratativa-item">
                <div class="tratativa-header">
                    <div class="tratativa-user">
                        <div class="tratativa-avatar">${t.user.charAt(0)}</div>
                        <div class="tratativa-user-info">
                            <div class="name">${t.user}</div>
                            <div class="role">${t.role}</div>
                        </div>
                    </div>
                    <div class="tratativa-date">${t.date}</div>
                </div>
                <span class="tratativa-type ${t.type}">${getTipoLabel(t.type)}</span>
                <div class="tratativa-content">${t.content}</div>
            </div>
        `).join('');
    }
    
    document.getElementById('modalTitle').textContent = 'üìã ' + nome;
    document.getElementById('modalBody').innerHTML = `
        <div class="modal-info">
            <div class="modal-info-item"><span class="label">Status</span><span class="value">${p.status}</span></div>
            <div class="modal-info-item"><span class="label">Fase Atual</span><span class="value">${p.fase}</span></div>
            <div class="modal-info-item"><span class="label">Progresso</span><span class="value">${p.progresso}%</span></div>
            <div class="modal-info-item"><span class="label">Prioridade</span><span class="value">${p.prioridade}</span></div>
            <div class="modal-info-item"><span class="label">PMO Respons√°vel</span><span class="value">${p.resp}</span></div>
            <div class="modal-info-item"><span class="label">Local</span><span class="value">${p.local}</span></div>
        </div>
        <div class="tratativas-section">
            <div class="tratativas-header">üìã Hist√≥rico de Tratativas</div>
            ${tratativasHtml}
        </div>
    `;
    document.getElementById('modalProjeto').classList.add('show');
}

function fecharModal() {
    document.getElementById('modalProjeto').classList.remove('show');
}

// Inicializa√ß√£o
populateFilters();
render();

document.addEventListener('keydown', e => {
    if (e.key === 'Escape') fecharModal();
});
</script>
</body>
</html>
