<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard de Infraestrutura v9 - Vis√£o Executiva</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #e5e7eb;
      color: #111827;
    }
    .topbar {
      background: linear-gradient(90deg,#6366f1,#8b5cf6);
      padding: 14px 30px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      color:#fff;
    }
    .topbar-title { font-size:1.1rem; font-weight:600; display:flex; align-items:center; gap:8px; }
    .topbar-sub { font-size:.8rem; opacity:.85; }
    .topbar-buttons { display:flex; gap:8px; flex-wrap:wrap; }
    .btn {
      border-radius:999px; border:none; padding:8px 16px; font-size:.85rem; font-weight:600;
      display:inline-flex; align-items:center; gap:6px; cursor:pointer; text-decoration:none; color:#fff; transition:all 0.2s;
    }
    .btn-alertas   { background:#ec4899; }
    .btn-detalhada { background:#4f46e5; }
    .btn-resumida  { background:#0ea5e9; }
    .btn-print     { background:#22c55e; }
    .btn:hover { opacity:.9; transform:translateY(-1px); }

    .page { max-width:1300px; margin:20px auto 32px; padding:0 16px; }

    .section {
      background:#f9fafb; border-radius:20px; padding:14px 16px 16px;
      box-shadow:0 14px 30px rgba(15,23,42,.18); margin-bottom:16px;
    }
    .section-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
    .section-title { font-size:.95rem; font-weight:600; display:flex; align-items:center; gap:6px; }
    .section-sub { font-size:.78rem; color:#6b7280; }

    .kpi-grid { display:grid; grid-template-columns:repeat(6,1fr); gap:10px; margin-top:4px; }
    .kpi-card {
      border-radius:16px; padding:10px 12px; background:linear-gradient(135deg,#3b82f6,#2563eb);
      color:#fff; display:flex; flex-direction:column; gap:4px; min-height:80px;
      cursor:pointer; transition:all 0.2s; position:relative; overflow:hidden;
    }
    .kpi-card::after { content:''; position:absolute; top:-15px; right:-15px; width:60px; height:60px; background:rgba(255,255,255,0.1); border-radius:50%; }
    .kpi-card:hover { transform:translateY(-3px); box-shadow:0 6px 16px rgba(0,0,0,0.15); }
    .kpi-card.green  { background:linear-gradient(135deg,#22c55e,#16a34a); }
    .kpi-card.orange { background:linear-gradient(135deg,#f97316,#ea580c); }
    .kpi-card.amber  { background:linear-gradient(135deg,#f59e0b,#d97706); }
    .kpi-card.purple { background:linear-gradient(135deg,#a855f7,#7c3aed); }
    .kpi-card.red    { background:linear-gradient(135deg,#ef4444,#b91c1c); }
    .kpi-card.pink   { background:linear-gradient(135deg,#ec4899,#be185d); }
    .kpi-card.active { box-shadow:0 0 0 3px white, 0 0 0 6px #6366f1; transform:translateY(-3px); }
    .kpi-label { font-size:.78rem; opacity:.9; }
    .kpi-value { font-size:1.4rem; font-weight:700; }
    .kpi-desc { font-size:.72rem; opacity:.85; }

    .phases-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:10px; margin-top:6px; }
    .phase-card {
      border-radius:14px; padding:10px 12px; background:#ffffff; border:1px solid #e5e7eb;
      display:flex; flex-direction:column; gap:4px; font-size:.8rem; border-top:3px solid #e5e7eb;
      cursor:pointer; transition:all 0.2s;
    }
    .phase-card:hover { transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,0.1); }
    .phase-card.active { border:2px solid #6366f1; box-shadow:0 0 0 2px rgba(99,102,241,0.3); transform:translateY(-2px); }
    .phase-card.verde { border-top-color:#22c55e; }
    .phase-card.amarelo { border-top-color:#f59e0b; }
    .phase-card.vermelho { border-top-color:#ef4444; }
    .phase-name { font-weight:600; color:#111827; display:flex; align-items:center; gap:6px; font-size:.82rem; }
    .phase-bar { position:relative; background:#e5e7eb; border-radius:999px; height:6px; overflow:hidden; margin-top:2px; }
    .phase-bar-inner { position:absolute; left:0;top:0;bottom:0; border-radius:999px; }
    .phase-bar-inner.verde { background:linear-gradient(90deg,#22c55e,#4ade80); }
    .phase-bar-inner.amarelo { background:linear-gradient(90deg,#f59e0b,#fbbf24); }
    .phase-bar-inner.vermelho { background:linear-gradient(90deg,#ef4444,#f87171); }
    .phase-meta { display:flex; justify-content:space-between; align-items:center; font-size:.75rem; color:#4b5563; }
    .phase-pct { font-weight:700; }
    .phase-pct.verde { color:#16a34a; }
    .phase-pct.amarelo { color:#d97706; }
    .phase-pct.vermelho { color:#dc2626; }

    .bottom-grid { display:grid; grid-template-columns:minmax(0,2fr) minmax(0,1.1fr); gap:16px; }

    .filters { display:grid; grid-template-columns:1.5fr 1fr 1fr 1fr auto; gap:8px; margin-top:4px; margin-bottom:8px; }
    .filter-group { display:flex; flex-direction:column; gap:3px; }
    .filter-label { font-size:.78rem; font-weight:600; color:#6b7280; }
    .filter-input, .filter-select {
      border-radius:999px; border:1px solid #e5e7eb; padding:7px 11px; font-size:.85rem; background:#fff;
    }
    .filter-input:focus, .filter-select:focus { outline:none; border-color:#6366f1; box-shadow:0 0 0 1px rgba(99,102,241,.2); }
    .btn-limpar { background:#ef4444; color:white; border:none; border-radius:999px; padding:7px 14px; font-size:.82rem; font-weight:600; cursor:pointer; transition:all 0.2s; white-space:nowrap; align-self:flex-end; }
    .btn-limpar:hover { background:#dc2626; }

    .projects-list { max-height:360px; overflow-y:auto; margin-top:2px; }
    .project-row {
      border-radius:12px; padding:8px 10px; margin-bottom:6px; background:#ffffff;
      border:1px solid #e5e7eb; display:grid; grid-template-columns:2fr 1fr 1fr 80px;
      gap:8px; align-items:center; font-size:.8rem; cursor:pointer; transition:all .15s;
      border-left:4px solid #e5e7eb;
    }
    .project-row:hover { border-color:#6366f1; box-shadow:0 4px 10px rgba(99,102,241,.18); transform:translateY(-1px); }
    .project-row.verde { border-left-color:#22c55e; }
    .project-row.amarelo { border-left-color:#f59e0b; }
    .project-row.vermelho { border-left-color:#ef4444; }
    .project-row.critico { border-left-color:#ec4899; }
    .project-main { display:flex; flex-direction:column; gap:2px; }
    .project-name { font-weight:600; color:#111827; }
    .project-meta-line { font-size:.75rem; color:#6b7280; display:flex; flex-wrap:wrap; gap:6px; }
    .project-tagline { font-size:.74rem; color:#4b5563; display:flex; flex-direction:column; gap:3px; }

    .badge { display:inline-flex; align-items:center; justify-content:center; padding:2px 8px; border-radius:999px; font-size:.7rem; font-weight:600; white-space:nowrap; }
    .badge-prio-alta  { background:#fee2e2;color:#b91c1c; }
    .badge-prio-media { background:#fef3c7;color:#92400e; }
    .badge-prio-baixa { background:#dbeafe;color:#1d4ed8; }
    .badge-concluido    { background:#dcfce7;color:#166534; }
    .badge-andamento    { background:#e0f2fe;color:#1d4ed8; }
    .badge-atrasado     { background:#fce4ec;color:#c62828; }
    .badge-nao-iniciado { background:#e5e7eb;color:#374151; }
    .badge-risco-alto  { background:#ec4899;color:white;font-size:.65rem; }
    .badge-risco-medio { background:#f97316;color:white;font-size:.65rem; }
    .badge-risco-baixo { background:#22c55e;color:white;font-size:.65rem; }

    .progress-chip { font-size:.78rem; font-weight:600; text-align:right; }
    .progress-chip.verde { color:#16a34a; }
    .progress-chip.amarelo { color:#d97706; }
    .progress-chip.vermelho { color:#dc2626; }

    .status-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-top:4px; }
    .status-card {
      border-radius:14px; padding:10px 12px; background:#ffffff; border:1px solid #e5e7eb;
      font-size:.8rem; display:flex; flex-direction:column; gap:4px;
    }
    .status-label { font-weight:600; display:flex; align-items:center; gap:6px; }
    .status-value { font-size:1.2rem; font-weight:700; color:#111827; }
    .status-sub { font-size:.75rem; color:#6b7280; }
    .no-projects { font-size:.8rem; color:#9ca3af; font-style:italic; padding:6px 2px; }
    .filter-indicator { font-size:.78rem; color:#6366f1; font-weight:600; padding:4px 10px; background:#eff6ff; border-radius:8px; margin-bottom:6px; display:none; align-items:center; gap:6px; }
    .filter-indicator.show { display:flex; }
    .filter-indicator .clear { cursor:pointer; color:#ef4444; margin-left:auto; font-size:.75rem; }

    /* MODAL */
    .modal-overlay { display:none; position:fixed; top:0;left:0;right:0;bottom:0; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center; }
    .modal-overlay.show { display:flex; }
    .print-modal { background:white; border-radius:20px; padding:24px; max-width:500px; width:90%; max-height:85vh; overflow-y:auto; box-shadow:0 20px 60px rgba(0,0,0,0.3); }
    .print-modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; padding-bottom:12px; border-bottom:2px solid #e5e7eb; }
    .print-modal-header h2 { font-size:1.1rem; color:#1e293b; display:flex; align-items:center; gap:8px; }
    .print-modal-close { background:none; border:none; font-size:1.5rem; cursor:pointer; color:#94a3b8; width:32px; height:32px; border-radius:50%; display:flex; align-items:center; justify-content:center; }
    .print-modal-close:hover { background:#f1f5f9; color:#475569; }
    .print-option { display:flex; align-items:center; gap:12px; padding:12px 14px; background:#f8fafc; border-radius:12px; cursor:pointer; border:2px solid transparent; transition:all 0.2s; margin-bottom:8px; }
    .print-option:hover { border-color:#6366f1; background:#f0f4ff; }
    .print-option.selected { border-color:#6366f1; background:#eff6ff; }
    .print-option input[type="radio"] { width:18px; height:18px; cursor:pointer; accent-color:#6366f1; }
    .print-option-text { flex:1; }
    .print-option-title { font-weight:600; color:#1e293b; font-size:.9rem; }
    .print-option-desc { font-size:.78rem; color:#6b7280; margin-top:2px; }
    .print-projects-list { max-height:200px; overflow-y:auto; border:1px solid #e2e8f0; border-radius:12px; padding:10px; margin-top:8px; display:none; }
    .print-projects-list.show { display:block; }
    .print-project-item { display:flex; align-items:center; gap:10px; padding:8px; border-radius:8px; cursor:pointer; font-size:.85rem; }
    .print-project-item:hover { background:#f1f5f9; }
    .print-project-item input { width:16px; height:16px; accent-color:#6366f1; }
    .print-select-btns { display:none; gap:8px; margin-top:8px; }
    .print-select-btns.show { display:flex; }
    .print-select-btns button { flex:1; padding:8px; border:none; border-radius:8px; font-weight:600; cursor:pointer; font-size:.82rem; }
    .btn-marcar { background:#22c55e; color:white; }
    .btn-desmarcar { background:#ef4444; color:white; }
    .print-modal-footer { display:flex; gap:10px; margin-top:16px; padding-top:12px; border-top:1px solid #e5e7eb; }
    .print-modal-footer button { flex:1; padding:12px; border:none; border-radius:12px; font-weight:600; cursor:pointer; font-size:.9rem; transition:all 0.2s; }
    .btn-cancelar { background:#f1f5f9; color:#64748b; }
    .btn-cancelar:hover { background:#e2e8f0; }
    .btn-executar { background:#6366f1; color:white; }
    .btn-executar:hover { background:#4f46e5; }

    @media print {
      * { -webkit-print-color-adjust:exact !important; print-color-adjust:exact !important; color-adjust:exact !important; }
      body { background:white !important; }
      .topbar { padding:10px 20px !important; }
      .topbar-buttons { display:none !important; }
      .page { margin:0 !important; padding:0 10px !important; }
      .section { box-shadow:none !important; break-inside:avoid; }
      .filters { display:none !important; }
      .filter-indicator { display:none !important; }
      .modal-overlay { display:none !important; }
      .projects-list { max-height:none !important; overflow:visible !important; }
      .project-row { break-inside:avoid; }
    }
    @media(max-width:1100px){ .kpi-grid{grid-template-columns:repeat(3,1fr);} .phases-grid{grid-template-columns:repeat(2,1fr);} .bottom-grid{grid-template-columns:1fr;} }
    @media(max-width:800px){ .kpi-grid{grid-template-columns:repeat(2,1fr);} .filters{grid-template-columns:1fr 1fr;} .project-row{grid-template-columns:1fr;} .progress-chip{text-align:left;} .phases-grid{grid-template-columns:repeat(2,1fr);} }
  </style>
</head>
<body>
  <div class="topbar">
    <div>
      <div class="topbar-title">üìä Dashboard de Infraestrutura v9</div>
      <div class="topbar-sub">Gest√£o de Projetos ¬∑ Invent Corp ¬∑ Atualizado: <span id="dataAtual"></span></div>
    </div>
    <div class="topbar-buttons">
      <a href="view-projetos.html" class="btn btn-alertas">üö® Alertas</a>
      <a href="view-detalhada.html" class="btn btn-detalhada">üìã Detalhada</a>
      <a href="view-simples.html" class="btn btn-resumida">üìÑ Resumida</a>
      <button class="btn btn-print" onclick="abrirPrintModal()">üñ®Ô∏è Imprimir / PDF</button>
    </div>
  </div>

  <div class="page">
    <div class="section">
      <div class="section-header">
        <div class="section-title">üìà Vis√£o Executiva (Macro)</div>
        <div class="section-sub" id="subKpi">Resumo geral do portf√≥lio</div>
      </div>
      <div class="kpi-grid" id="kpiGrid"></div>
    </div>

    <div class="section">
      <div class="section-header">
        <div class="section-title">üó∫Ô∏è Progresso por Fase do Ciclo de Vida</div>
        <div class="section-sub">% m√©dio de conclus√£o das atividades em cada fase (todos os projetos)</div>
      </div>
      <div class="phases-grid" id="phasesGrid"></div>
    </div>

    <div class="bottom-grid">
      <div class="section">
        <div class="section-header">
          <div class="section-title">üìã Vis√£o por Projeto (Micro)</div>
          <div class="section-sub">Clique para abrir na Vis√£o Detalhada</div>
        </div>
        <div class="filters">
          <div class="filter-group">
            <label class="filter-label">üîç Buscar</label>
            <input id="filterBusca" class="filter-input" type="text" placeholder="Nome do projeto..." oninput="renderLista()" />
          </div>
          <div class="filter-group">
            <label class="filter-label">üìä Status</label>
            <select id="filterStatus" class="filter-select" onchange="renderLista()">
              <option value="">Todos</option>
              <option value="Conclu√≠do">Conclu√≠do</option>
              <option value="Em andamento">Em andamento</option>
              <option value="Atrasado">Atrasado</option>
              <option value="N√£o Iniciado">N√£o Iniciado</option>
            </select>
          </div>
          <div class="filter-group">
            <label class="filter-label">‚ö° Prioridade</label>
            <select id="filterPrioridade" class="filter-select" onchange="renderLista()">
              <option value="">Todas</option>
              <option value="Alta">Alta</option>
              <option value="M√©dia">M√©dia</option>
              <option value="Baixa">Baixa</option>
            </select>
          </div>
          <div class="filter-group">
            <label class="filter-label">üë§ Respons√°vel</label>
            <select id="filterResp" class="filter-select" onchange="renderLista()"><option value="">Todos</option></select>
          </div>
          <button class="btn-limpar" onclick="limparFiltros()">üóëÔ∏è Limpar</button>
        </div>
        <div class="filter-indicator" id="filterIndicator"></div>
        <div class="projects-list" id="listaProjetos"></div>
      </div>

      <div class="section">
        <div class="section-header">
          <div class="section-title">üìå Resumo de Status & Prioridade</div>
          <div class="section-sub">Distribui√ß√£o atual do portf√≥lio</div>
        </div>
        <div class="status-grid" id="statusGrid"></div>
      </div>
    </div>

    <p style="margin-top:12px;font-size:.75rem;color:#9ca3af;">
      Dashboard de Infraestrutura v9 ¬∑ Invent Corp ¬∑ Desenvolvido para Douglas (Gestor) ¬∑ PMO: Daiana
    </p>
  </div>

  <!-- MODAL -->
  <div class="modal-overlay" id="printModal" onclick="if(event.target===this)fecharPrintModal()">
    <div class="print-modal">
      <div class="print-modal-header">
        <h2>üñ®Ô∏è Imprimir</h2>
        <button class="print-modal-close" onclick="fecharPrintModal()">√ó</button>
      </div>
      <label class="print-option selected" onclick="selecionarOpcao(this,'filtro')">
        <input type="radio" name="printType" value="filtro" checked>
        <div class="print-option-text">
          <div class="print-option-title">üìã Filtro Atual</div>
          <div class="print-option-desc">Projetos vis√≠veis na tela com os filtros aplicados</div>
        </div>
      </label>
      <label class="print-option" onclick="selecionarOpcao(this,'todos')">
        <input type="radio" name="printType" value="todos">
        <div class="print-option-text">
          <div class="print-option-title">üìÇ Todos os Projetos</div>
          <div class="print-option-desc">Incluir todos os 30 projetos independente dos filtros</div>
        </div>
      </label>
      <label class="print-option" onclick="selecionarOpcao(this,'criticos')">
        <input type="radio" name="printType" value="criticos">
        <div class="print-option-text">
          <div class="print-option-title">üö® Apenas Cr√≠ticos</div>
          <div class="print-option-desc">Somente projetos atrasados ou com prioridade alta</div>
        </div>
      </label>
      <label class="print-option" onclick="selecionarOpcao(this,'especificos')">
        <input type="radio" name="printType" value="especificos">
        <div class="print-option-text">
          <div class="print-option-title">‚úÖ Projetos Espec√≠ficos</div>
          <div class="print-option-desc">Selecionar manualmente quais projetos incluir</div>
        </div>
      </label>
      <div class="print-projects-list" id="printProjectsList"></div>
      <div class="print-select-btns" id="printSelectBtns">
        <button class="btn-marcar" onclick="marcarTodos(true)">‚úÖ Marcar todos</button>
        <button class="btn-desmarcar" onclick="marcarTodos(false)">‚úñ Desmarcar todos</button>
      </div>
      <div class="print-modal-footer">
        <button class="btn-cancelar" onclick="fecharPrintModal()">Cancelar</button>
        <button class="btn-executar" onclick="executarPrint()">üñ®Ô∏è Imprimir</button>
      </div>
    </div>
  </div>

  <script>
    const PROJETOS=[
      {nome:'BARBECUE B2B',local:'S√£o Paulo - SP',resp:'ALEX',prioridade:'Alta',inicio:'2025-06-01',fim:'2026-02-06'},
      {nome:'BELEZA',local:'S√£o Paulo - SP',resp:'ANDERSON',prioridade:'M√©dia',inicio:'2025-05-01',fim:'2025-11-30'},
      {nome:'BETA',local:'Rio de Janeiro - RJ',resp:'ANDERSON',prioridade:'Alta',inicio:'2025-07-01',fim:'2026-03-10'},
      {nome:'BETA ESTEIO',local:'Esteio - RS',resp:'ANDERSON',prioridade:'M√©dia',inicio:'2026-01-16',fim:'2026-07-15'},
      {nome:'BP',local:'S√£o Paulo - SP',resp:'GIOVANNI',prioridade:'M√©dia',inicio:'2025-12-01',fim:'2026-06-30'},
      {nome:'BR',local:'Jaboat√£o - PE',resp:'F√ÅBIO',prioridade:'Alta',inicio:'2026-02-01',fim:'2026-08-01'},
      {nome:'CANDELABRIA',local:'Candel√°ria - RS',resp:'ALEX',prioridade:'M√©dia',inicio:'2025-06-01',fim:'2025-12-09'},
      {nome:'CDSK',local:'S√£o Paulo - SP',resp:'VINICIUS',prioridade:'Alta',inicio:'2025-08-01',fim:'2026-02-28'},
      {nome:'COUGAR',local:'S√£o Paulo - SP',resp:'LEANDRO',prioridade:'Alta',inicio:'2025-05-01',fim:'2026-02-09'},
      {nome:'CRISTAL MG RETROFIT',local:'Belo Horizonte - MG',resp:'GIOVANNI',prioridade:'Alta',inicio:'2025-11-01',fim:'2026-05-30'},
      {nome:'DIA',local:'S√£o Paulo - SP',resp:'ANDERSON',prioridade:'Alta',inicio:'2025-09-01',fim:'2026-01-15'},
      {nome:'DIAMANTE',local:'Curitiba - PR',resp:'F√ÅBIO',prioridade:'M√©dia',inicio:'2026-02-15',fim:'2026-08-15'},
      {nome:'ELETRO',local:'S√£o Paulo - SP',resp:'GIOVANNI',prioridade:'M√©dia',inicio:'2025-10-01',fim:'2026-04-30'},
      {nome:'ESPERAN√áA',local:'Belo Horizonte - MG',resp:'VINICIUS',prioridade:'M√©dia',inicio:'2025-04-01',fim:'2026-01-19'},
      {nome:'FLOWER',local:'S√£o Paulo - SP',resp:'ANDERSON',prioridade:'Baixa',inicio:'2025-12-01',fim:'2026-06-30'},
      {nome:'GAVI√ÉO',local:'Fortaleza - CE',resp:'F√ÅBIO',prioridade:'Alta',inicio:'2025-05-01',fim:'2026-02-01'},
      {nome:'MKT CHILE',local:'Santiago - Chile',resp:'ALEX',prioridade:'M√©dia',inicio:'2026-06-01',fim:'2026-12-01'},
      {nome:'MKT PERU',local:'Lima - Peru',resp:'ALEX',prioridade:'M√©dia',inicio:'2026-06-01',fim:'2026-12-01'},
      {nome:'MASTER',local:'S√£o Paulo - SP',resp:'LEANDRO',prioridade:'Alta',inicio:'2026-03-01',fim:'2026-09-01'},
      {nome:'NAVEPARK',local:'Curitiba - PR',resp:'ANDERSON',prioridade:'M√©dia',inicio:'2025-09-01',fim:'2026-04-30'},
      {nome:'OCTOPUS MS',local:'Campo Grande - MS',resp:'ALEX',prioridade:'M√©dia',inicio:'2025-10-01',fim:'2026-04-30'},
      {nome:'OCTOPUS SC',local:'Florian√≥polis - SC',resp:'ALEX',prioridade:'M√©dia',inicio:'2025-06-01',fim:'2025-12-15'},
      {nome:'OPTIMUS PRIME',local:'S√£o Paulo - SP',resp:'GIOVANNI',prioridade:'Alta',inicio:'2025-04-01',fim:'2025-10-27'},
      {nome:'PBL GUATEMALA',local:'Guatemala City',resp:'F√ÅBIO',prioridade:'Alta',inicio:'2025-09-01',fim:'2026-03-31'},
      {nome:'PROMO B2B CD GRU',local:'Guarulhos - SP',resp:'LEANDRO',prioridade:'Alta',inicio:'2025-07-01',fim:'2026-02-04'},
      {nome:'PTL SP',local:'S√£o Paulo - SP',resp:'VINICIUS',prioridade:'M√©dia',inicio:'2025-04-01',fim:'2025-10-30'},
      {nome:'REISADO',local:'Recife - PE',resp:'F√ÅBIO',prioridade:'M√©dia',inicio:'2025-06-01',fim:'2025-12-20'},
      {nome:'REVERSE',local:'S√£o Paulo - SP',resp:'ALEX',prioridade:'Alta',inicio:'2025-09-01',fim:'2026-03-15'},
      {nome:'SUPER DIVINOPOLIS',local:'Divin√≥polis - MG',resp:'GIOVANNI',prioridade:'M√©dia',inicio:'2025-10-01',fim:'2026-04-30'},
      {nome:'TITANIO',local:'S√£o Paulo - SP',resp:'ALEX',prioridade:'Alta',inicio:'2025-07-01',fim:'2026-02-28'}
    ];

    const HOJE=new Date('2026-02-10');
    const CONCLUIDOS=['BARBECUE B2B','BELEZA','CANDELABRIA','CDSK','COUGAR','ESPERAN√áA','GAVI√ÉO','OCTOPUS SC','OPTIMUS PRIME','PROMO B2B CD GRU','PTL SP','REISADO','SUPER DIVINOPOLIS'];
    const NAO_INICIADOS=['DIAMANTE','MASTER','MKT CHILE','MKT PERU'];

    function statusProjeto(p){
      if(CONCLUIDOS.includes(p.nome))return'Conclu√≠do';
      if(NAO_INICIADOS.includes(p.nome))return'N√£o Iniciado';
      if(HOJE>new Date(p.fim))return'Atrasado';
      if(HOJE<new Date(p.inicio))return'N√£o Iniciado';
      return'Em andamento';
    }
    function diasAteGoLive(p){return Math.round((new Date(p.fim)-HOJE)/86400000)}
    function riscoProjeto(p){
      if(CONCLUIDOS.includes(p.nome))return'baixo';
      const d=diasAteGoLive(p),alta=p.prioridade==='Alta';
      if(d<0)return'alto';
      if(d<=30&&alta)return'alto';
      if(d<=60||alta)return'medio';
      return'baixo';
    }
    function isCritico(p){return riscoProjeto(p)==='alto'}
    function progressoEstimado(p){
      const st=statusProjeto(p);
      if(st==='Conclu√≠do')return 100;
      if(st==='N√£o Iniciado')return 0;
      const dt=(new Date(p.fim)-new Date(p.inicio))/86400000;
      const dp=(HOJE-new Date(p.inicio))/86400000;
      if(dt<=0)return 50;
      if(st==='Atrasado')return Math.min(95,Math.round((dp/dt)*85));
      return Math.max(5,Math.min(95,Math.round((dp/dt)*100)));
    }
    function getCor(pct){return pct>=80?'verde':pct>=40?'amarelo':'vermelho'}

    // === KPIs ===
    let kpiFilter='';
    let faseFilter='';
    function renderKPIs(){
      const t=PROJETOS.length;
      const c=PROJETOS.filter(p=>statusProjeto(p)==='Conclu√≠do').length;
      const a=PROJETOS.filter(p=>statusProjeto(p)==='Em andamento').length;
      const at=PROJETOS.filter(p=>statusProjeto(p)==='Atrasado').length;
      const ni=PROJETOS.filter(p=>statusProjeto(p)==='N√£o Iniciado').length;
      const cr=PROJETOS.filter(p=>isCritico(p)).length;
      document.getElementById('subKpi').textContent=`Resumo geral do portf√≥lio de ${t} projetos`;
      const kpis=[
        {l:'Total de Projetos',v:t,d:'Portf√≥lio completo',cls:'',f:'todos'},
        {l:'Conclu√≠dos',v:c,d:'Encerrados com sucesso',cls:'green',f:'Conclu√≠do'},
        {l:'Em Andamento',v:a,d:'Execu√ß√£o ativa',cls:'orange',f:'Em andamento'},
        {l:'Atrasados',v:at,d:'Prazo ultrapassado',cls:'amber',f:'Atrasado'},
        {l:'N√£o Iniciados',v:ni,d:'Aguardando in√≠cio',cls:'purple',f:'N√£o Iniciado'},
        {l:'Cr√≠ticos',v:cr,d:'Risco alto (prazo+prior.)',cls:'pink',f:'critico'}
      ];
      document.getElementById('kpiGrid').innerHTML=kpis.map(k=>`
        <div class="kpi-card ${k.cls} ${kpiFilter===k.f?'active':''}" onclick="filtrarKPI('${k.f}')" title="Clique para filtrar">
          <div class="kpi-label">${k.l}</div>
          <div class="kpi-value">${k.v}</div>
          <div class="kpi-desc">${k.d}</div>
        </div>`).join('');
    }
    function filtrarKPI(f){kpiFilter=kpiFilter===f?'':f;faseFilter='';renderKPIs();renderFases();renderLista()}

    // === FASES ===
    const FASES=['1. Kickoff','2. Levantamento & Design','3. Provisionamento','4. Implanta√ß√£o','5. Homologa√ß√£o','6. Go Live','7. Hypercare','8. Encerramento'];

    function faseAtualProjeto(p){
      const prog=progressoEstimado(p);
      if(prog>=100)return 7; // Encerramento
      if(prog<=0)return -1;  // nenhuma
      return Math.min(7,Math.floor(prog/12.5));
    }

    function renderFases(){
      document.getElementById('phasesGrid').innerHTML=FASES.map((f,idx)=>{
        let total=0,concl=0,nProj=0;
        PROJETOS.forEach(p=>{
          const prog=progressoEstimado(p);
          const fi=idx*12.5,ff=(idx+1)*12.5;
          if(prog>=ff){total+=3;concl+=3}
          else if(prog>fi){total+=3;concl+=Math.round(((prog-fi)/12.5)*3);nProj++}
          else{total+=3}
        });
        const pct=total?Math.round(concl/total*100):0;
        const cor=getCor(pct);
        const isActive=faseFilter===f?'active':'';
        return`<div class="phase-card ${cor} ${isActive}" onclick="filtrarFase('${f}')" title="Clique para filtrar projetos nesta fase">
          <div class="phase-name">${f}</div>
          <div class="phase-bar"><div class="phase-bar-inner ${cor}" style="width:${pct}%"></div></div>
          <div class="phase-meta">
            <span class="phase-pct ${cor}">${pct}%</span>
            <span>${nProj>0?nProj+' proj. nesta fase':''}</span>
          </div>
        </div>`;
      }).join('');
    }

    function filtrarFase(f){faseFilter=faseFilter===f?'':f;kpiFilter='';renderKPIs();renderFases();renderLista()}

    function limparFiltros(){
      kpiFilter='';faseFilter='';
      document.getElementById('filterBusca').value='';
      document.getElementById('filterStatus').value='';
      document.getElementById('filterPrioridade').value='';
      document.getElementById('filterResp').value='';
      renderKPIs();renderFases();renderLista();
    }

    // === LISTA ===
    function getProjetosFiltrados(){
      const t=(document.getElementById('filterBusca').value||'').trim().toLowerCase();
      const sf=document.getElementById('filterStatus').value;
      const pf=document.getElementById('filterPrioridade').value;
      const rf=document.getElementById('filterResp').value;
      return PROJETOS.filter(p=>{
        if(t&&!p.nome.toLowerCase().includes(t))return false;
        if(sf&&statusProjeto(p)!==sf)return false;
        if(pf&&p.prioridade!==pf)return false;
        if(rf&&p.resp!==rf)return false;
        if(kpiFilter==='critico'&&!isCritico(p))return false;
        if(kpiFilter&&kpiFilter!=='todos'&&kpiFilter!=='critico'&&statusProjeto(p)!==kpiFilter)return false;
        if(faseFilter){const fi=FASES.indexOf(faseFilter);if(faseAtualProjeto(p)!==fi)return false}
        return true;
      });
    }
    function renderLista(){
      // Filter indicator
      const ind=document.getElementById('filterIndicator');
      let indTxt='';
      if(kpiFilter&&kpiFilter!=='todos')indTxt=kpiFilter==='critico'?'üö® Filtrando: Cr√≠ticos':`üìä Filtrando: ${kpiFilter}`;
      if(faseFilter)indTxt=`üó∫Ô∏è Filtrando: ${faseFilter}`;
      if(indTxt){ind.innerHTML=`${indTxt} <span class="clear" onclick="limparFiltros()">‚úñ Limpar</span>`;ind.classList.add('show')}
      else{ind.classList.remove('show')}

      const lista=getProjetosFiltrados().map(p=>({...p,_st:statusProjeto(p),_pg:progressoEstimado(p),_ri:riscoProjeto(p)}));
      const el=document.getElementById('listaProjetos');
      if(!lista.length){el.innerHTML='<div class="no-projects">Nenhum projeto encontrado com os filtros atuais.</div>';return}
      const rk={alto:3,medio:2,baixo:1};
      lista.sort((a,b)=>{const r=rk[b._ri]-rk[a._ri];return r!==0?r:a._pg-b._pg});
      el.innerHTML=lista.map(p=>{
        const pc=p.prioridade==='Alta'?'badge-prio-alta':p.prioridade==='M√©dia'?'badge-prio-media':'badge-prio-baixa';
        const sc=p._st==='Conclu√≠do'?'badge-concluido':p._st==='Em andamento'?'badge-andamento':p._st==='Atrasado'?'badge-atrasado':'badge-nao-iniciado';
        const rc=p._ri==='alto'?'badge-risco-alto':p._ri==='medio'?'badge-risco-medio':'badge-risco-baixo';
        const rl=p._ri==='alto'?'üö® Cr√≠tico':p._ri==='medio'?'‚ö†Ô∏è Aten√ß√£o':'‚úÖ Saud√°vel';
        const cor=getCor(p._pg);
        const rowC=p._ri==='alto'?'critico':cor;
        return`<div class="project-row ${rowC}" onclick="window.location.href='view-detalhada.html'">
          <div class="project-main"><div class="project-name">${p.nome}</div><div class="project-meta-line"><span>üìç ${p.local}</span><span>üë§ ${p.resp}</span></div></div>
          <div class="project-tagline"><span class="badge ${pc}">${p.prioridade}</span><span class="badge ${sc}">${p._st}</span></div>
          <div class="project-tagline"><span class="badge ${rc}">${rl}</span></div>
          <div class="progress-chip ${cor}">${p._pg}%</div>
        </div>`;
      }).join('');
    }

    // === RESUMO ===
    function renderResumo(){
      const c=PROJETOS.filter(p=>statusProjeto(p)==='Conclu√≠do').length;
      const a=PROJETOS.filter(p=>statusProjeto(p)==='Em andamento').length;
      const at=PROJETOS.filter(p=>statusProjeto(p)==='Atrasado').length;
      const ni=PROJETOS.filter(p=>statusProjeto(p)==='N√£o Iniciado').length;
      const alta=PROJETOS.filter(p=>p.prioridade==='Alta').length;
      const med=PROJETOS.filter(p=>p.prioridade==='M√©dia').length;
      const bai=PROJETOS.filter(p=>p.prioridade==='Baixa').length;
      const go30=PROJETOS.filter(p=>!CONCLUIDOS.includes(p.nome)&&diasAteGoLive(p)<=30&&diasAteGoLive(p)>=0).length;
      const cr=PROJETOS.filter(p=>isCritico(p)).length;
      document.getElementById('statusGrid').innerHTML=`
        <div class="status-card"><div class="status-label">üìä Status dos Projetos</div><div class="status-value">${c}/${PROJETOS.length}</div><div class="status-sub">${c} conclu√≠dos ¬∑ ${a} em andamento ¬∑ ${at} atrasados ¬∑ ${ni} n√£o iniciados</div></div>
        <div class="status-card"><div class="status-label">‚ö° Prioridade</div><div class="status-value">${alta} / ${med} / ${bai}</div><div class="status-sub">${alta} alta ¬∑ ${med} m√©dia ¬∑ ${bai} baixa</div></div>
        <div class="status-card"><div class="status-label">üéØ Go Lives em at√© 30 dias</div><div class="status-value">${go30}</div><div class="status-sub">Consulte detalhes na tela de Alertas</div></div>
        <div class="status-card"><div class="status-label">üö® Projetos Cr√≠ticos</div><div class="status-value" style="color:#ec4899">${cr}</div><div class="status-sub">Alta prioridade + prazo apertado</div></div>`;
    }

    // === FILTROS ===
    function populateFilters(){
      const resps=[...new Set(PROJETOS.map(p=>p.resp))].sort();
      const sel=document.getElementById('filterResp');
      resps.forEach(r=>{const o=document.createElement('option');o.value=r;o.textContent=r;sel.appendChild(o)});
    }

    // === PRINT MODAL ===
    function abrirPrintModal(){
      document.getElementById('printProjectsList').innerHTML=PROJETOS.map(p=>`<label class="print-project-item"><input type="checkbox" value="${p.nome}" checked> ${p.nome}</label>`).join('');
      document.getElementById('printModal').classList.add('show');
    }
    function fecharPrintModal(){document.getElementById('printModal').classList.remove('show')}
    function selecionarOpcao(el,tipo){
      document.querySelectorAll('.print-option').forEach(o=>o.classList.remove('selected'));
      el.classList.add('selected');el.querySelector('input').checked=true;
      const show=tipo==='especificos';
      document.getElementById('printProjectsList').classList.toggle('show',show);
      document.getElementById('printSelectBtns').classList.toggle('show',show);
    }
    function marcarTodos(m){document.querySelectorAll('#printProjectsList input[type="checkbox"]').forEach(cb=>cb.checked=m)}
    function executarPrint(){
      const tipo=document.querySelector('input[name="printType"]:checked').value;
      let proj=[];
      if(tipo==='filtro')proj=getProjetosFiltrados();
      else if(tipo==='todos')proj=PROJETOS;
      else if(tipo==='criticos')proj=PROJETOS.filter(p=>isCritico(p));
      else if(tipo==='especificos'){const cks=document.querySelectorAll('#printProjectsList input:checked');proj=PROJETOS.filter(p=>[...cks].some(c=>c.value===p.nome))}
      if(!proj.length){alert('Nenhum projeto selecionado!');return}
      fecharPrintModal();imprimirLista(proj);
    }
    function imprimirLista(projetos){
      const w=window.open('','_blank');
      const kpis=`<div style="display:grid;grid-template-columns:repeat(6,1fr);gap:8px;margin:15px 0">${[
        {l:'Total',v:projetos.length,c:'#3b82f6'},{l:'Conclu√≠dos',v:projetos.filter(p=>statusProjeto(p)==='Conclu√≠do').length,c:'#22c55e'},
        {l:'Em Andamento',v:projetos.filter(p=>statusProjeto(p)==='Em andamento').length,c:'#f97316'},{l:'Atrasados',v:projetos.filter(p=>statusProjeto(p)==='Atrasado').length,c:'#f59e0b'},
        {l:'N√£o Iniciados',v:projetos.filter(p=>statusProjeto(p)==='N√£o Iniciado').length,c:'#a855f7'},{l:'Cr√≠ticos',v:projetos.filter(p=>isCritico(p)).length,c:'#ec4899'}
      ].map(k=>`<div style="text-align:center;padding:12px 8px;background:#f8fafc;border-radius:10px;border-top:4px solid ${k.c}"><div style="font-size:1.6em;font-weight:700">${k.v}</div><div style="font-size:.8em;color:#64748b">${k.l}</div></div>`).join('')}</div>`;
      const rows=projetos.map(p=>{
        const st=statusProjeto(p),prog=progressoEstimado(p),cor=prog>=80?'#22c55e':prog>=40?'#f59e0b':'#ef4444',ri=riscoProjeto(p);
        const rt=ri==='alto'?'üö® Cr√≠tico':ri==='medio'?'‚ö†Ô∏è Aten√ß√£o':'‚úÖ Saud√°vel';
        return`<div style="border:1px solid #e2e8f0;border-radius:10px;padding:12px;margin:8px 0;page-break-inside:avoid;border-left:4px solid ${ri==='alto'?'#ec4899':cor}">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><span style="font-weight:700">${p.nome}</span><span style="font-size:.75em;font-weight:600;padding:3px 10px;border-radius:20px;background:${p.prioridade==='Alta'?'#fee2e2':p.prioridade==='M√©dia'?'#fef3c7':'#dbeafe'};color:${p.prioridade==='Alta'?'#dc2626':p.prioridade==='M√©dia'?'#d97706':'#1d4ed8'}">${p.prioridade}</span></div>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px;font-size:.82em;color:#64748b"><span>üìç ${p.local}</span><span>üë§ ${p.resp}</span><span>üìä ${st}</span><span>üìÖ ${p.inicio}</span><span>üéØ ${p.fim}</span><span>${rt}</span></div>
          <div style="height:6px;background:#e2e8f0;border-radius:3px;margin:8px 0;overflow:hidden"><div style="height:100%;width:${prog}%;background:${cor};border-radius:3px"></div></div>
          <div style="text-align:right;font-weight:700;font-size:.9em;color:${cor}">${prog}%</div></div>`;
      }).join('');
      w.document.write(`<!DOCTYPE html><html><head><title>Dashboard Infraestrutura</title><style>body{font-family:system-ui,sans-serif;padding:25px;max-width:950px;margin:0 auto}h1{color:#6366f1;text-align:center;border-bottom:3px solid #6366f1;padding-bottom:12px;font-size:1.3em}@media print{body{padding:10px}*{-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important}}</style></head><body><h1>üìä Dashboard de Infraestrutura v9</h1>${kpis}${rows}<p style="color:#94a3b8;text-align:center;margin-top:20px;font-size:.8em">Gerado em ${new Date().toLocaleString('pt-BR')} ¬∑ Invent Corp</p></body></html>`);
      w.document.close();setTimeout(()=>w.print(),400);
    }

    // === INIT ===
    document.getElementById('dataAtual').textContent=HOJE.toLocaleDateString('pt-BR');
    document.addEventListener('keydown',e=>{if(e.key==='Escape')fecharPrintModal()});
    populateFilters();renderKPIs();renderFases();renderLista();renderResumo();
  </script>
</body>
</html>
