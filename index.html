<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status dos Projetos - Infraestrutura v5.3.2</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .container { max-width: 950px; width: 100%; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: white; font-size: 32px; margin-bottom: 10px; text-shadow: 0 4px 20px rgba(0,0,0,0.3); }
        .header p { color: rgba(255,255,255,0.7); font-size: 14px; }
        .version-badge { display: inline-block; background: rgba(102,126,234,0.3); color: #a5b4fc; padding: 4px 12px; border-radius: 20px; font-size: 11px; margin-top: 10px; }
        .info-bar { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 16px; padding: 20px 30px; margin-bottom: 25px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .info-item { text-align: center; }
        .info-item .number { font-size: 26px; font-weight: 700; color: white; }
        .info-item .label { font-size: 10px; color: rgba(255,255,255,0.6); text-transform: uppercase; letter-spacing: 1px; }
        .info-item.total .number { color: #a78bfa; }
        .info-item.concluido .number { color: #34d399; }
        .info-item.andamento .number { color: #60a5fa; }
        .info-item.critico .number { color: #f87171; }
        .info-item.parados .number { color: #fbbf24; }
        .update-info { text-align: right; }
        .update-info .date { color: white; font-size: 13px; font-weight: 600; }
        .update-info .time-ago { color: rgba(255,255,255,0.5); font-size: 11px; }
        .alert-box { background: linear-gradient(135deg, #fef2f2, #fee2e2); border: 2px solid #fca5a5; border-radius: 16px; padding: 18px 25px; margin-bottom: 25px; display: flex; align-items: center; gap: 20px; }
        .alert-box.success { background: linear-gradient(135deg, #ecfdf5, #d1fae5); border-color: #6ee7b7; }
        .alert-icon { font-size: 36px; }
        .alert-content h3 { color: #991b1b; font-size: 15px; margin-bottom: 4px; }
        .alert-box.success .alert-content h3 { color: #065f46; }
        .alert-content p { color: #7f1d1d; font-size: 12px; }
        .alert-box.success .alert-content p { color: #047857; }
        .alert-badges { display: flex; gap: 10px; margin-left: auto; flex-wrap: wrap; }
        .alert-badge { padding: 6px 14px; border-radius: 20px; font-size: 11px; font-weight: 600; display: flex; align-items: center; gap: 5px; }
        .alert-badge.atrasado { background: #fee2e2; color: #991b1b; }
        .alert-badge.parados { background: #fef3c7; color: #92400e; }
        .cards-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; }
        .card { background: rgba(255,255,255,0.95); border-radius: 24px; padding: 35px 28px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3); transition: all 0.4s ease; cursor: pointer; position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 5px; }
        .card.simples::before { background: linear-gradient(90deg, #667eea, #764ba2); }
        .card.detalhada::before { background: linear-gradient(90deg, #10b981, #059669); }
        .card:hover { transform: translateY(-8px); box-shadow: 0 30px 80px rgba(0,0,0,0.4); }
        .card-icon { width: 70px; height: 70px; border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 32px; margin: 0 auto 20px; }
        .card.simples .card-icon { background: linear-gradient(135deg, #667eea, #764ba2); }
        .card.detalhada .card-icon { background: linear-gradient(135deg, #10b981, #059669); }
        .card h2 { color: #1a1a2e; font-size: 22px; margin-bottom: 12px; }
        .card p { color: #64748b; font-size: 13px; line-height: 1.6; margin-bottom: 20px; }
        .card ul { text-align: left; list-style: none; margin-bottom: 25px; }
        .card ul li { padding: 7px 0; color: #475569; font-size: 12px; display: flex; align-items: center; gap: 10px; }
        .card ul li::before { content: '‚úì'; display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; border-radius: 50%; font-size: 10px; font-weight: bold; }
        .card.simples ul li::before { background: #ede9fe; color: #7c3aed; }
        .card.detalhada ul li::before { background: #d1fae5; color: #059669; }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 28px; border-radius: 12px; font-size: 14px; font-weight: 600; text-decoration: none; color: white; transition: all 0.3s ease; width: 100%; }
        .card.simples .btn { background: linear-gradient(135deg, #667eea, #764ba2); }
        .card.detalhada .btn { background: linear-gradient(135deg, #10b981, #059669); }
        .badge { position: absolute; top: 18px; right: 18px; padding: 5px 12px; border-radius: 20px; font-size: 10px; font-weight: 600; text-transform: uppercase; }
        .card.simples .badge { background: #ede9fe; color: #7c3aed; }
        .card.detalhada .badge { background: #d1fae5; color: #059669; }
        .footer { text-align: center; margin-top: 35px; color: rgba(255,255,255,0.5); font-size: 12px; }
        .footer a { color: rgba(255,255,255,0.7); text-decoration: none; }
        .footer a:hover { color: white; }
        .hidden { display: none; }
        @media (max-width: 768px) { .header h1 { font-size: 26px; } .cards-container { grid-template-columns: 1fr; } .info-bar { flex-direction: column; text-align: center; } .alert-box { flex-direction: column; text-align: center; } .alert-badges { margin-left: 0; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Status dos Projetos - Infraestrutura</h1>
            <p>Selecione o tipo de visualiza√ß√£o desejada</p>
            <span class="version-badge">v5.3.2 - KPIs Simplificados + Filtro Go-Live</span>
        </div>
        <div id="infoBar" class="info-bar">
            <div class="info-item total"><div class="number" id="totalCount">-</div><div class="label">Projetos</div></div>
            <div class="info-item concluido"><div class="number" id="concluidoCount">-</div><div class="label">Conclu√≠dos</div></div>
            <div class="info-item andamento"><div class="number" id="andamentoCount">-</div><div class="label">Em Andamento</div></div>
            <div class="info-item critico"><div class="number" id="criticoCount">-</div><div class="label">Cr√≠ticos</div></div>
            <div class="info-item parados"><div class="number" id="paradosCount">-</div><div class="label">Parados 15+</div></div>
            <div class="update-info"><div class="date" id="updateDate">Carregando...</div><div class="time-ago" id="timeAgo"></div></div>
        </div>
        <div id="alertBox" class="alert-box hidden">
            <div class="alert-icon" id="alertIcon">‚ö†Ô∏è</div>
            <div class="alert-content"><h3 id="alertTitle">Projetos requerem aten√ß√£o!</h3><p id="alertText">Existem projetos atrasados ou parados.</p></div>
            <div class="alert-badges" id="alertBadges">
                <span class="alert-badge atrasado" id="badgeAtrasados">üî¥ <span id="atrasadosNum">0</span> atrasados</span>
                <span class="alert-badge parados" id="badgeParados">üü° <span id="paradosNum">0</span> parados</span>
            </div>
        </div>
        <div class="cards-container">
            <div class="card simples" onclick="window.location.href='view-simples.html'">
                <span class="badge">Resumida</span>
                <div class="card-icon">üìã</div>
                <h2>Vis√£o Resumida</h2>
                <p>Dashboard consolidado com vis√£o geral.</p>
                <ul>
                    <li>KPIs simplificados (No Prazo, Atraso M√©dio)</li>
                    <li>Filtro por Go-Live (Este m√™s, 30/60/90 dias)</li>
                    <li>Impress√£o por projetos espec√≠ficos</li>
                    <li>Gr√°ficos de distribui√ß√£o e bloqueadores</li>
                </ul>
                <a href="view-simples.html" class="btn">Acessar ‚Üí</a>
            </div>
            <div class="card detalhada" onclick="window.location.href='view-detalhada.html'">
                <span class="badge">Completa</span>
                <div class="card-icon">üìà</div>
                <h2>Vis√£o Detalhada</h2>
                <p>Dashboard segmentado por status.</p>
                <ul>
                    <li>Se√ß√µes organizadas por status</li>
                    <li>Timeline de pr√≥ximos Go Lives</li>
                    <li>Filtro por Go-Live (Atrasados, pr√≥ximos)</li>
                    <li>Decis√µes necess√°rias da semana</li>
                </ul>
                <a href="view-detalhada.html" class="btn">Acessar ‚Üí</a>
            </div>
        </div>
        <div class="footer"><p>Infraestrutura TI ‚Ä¢ <a href="admin.html">√Årea Administrativa</a></p></div>
    </div>
    <script>
        function normalizeStatus(status) {
            if (!status) return 'N√£o Definido';
            const s = status.toLowerCase().trim();
            if (s.includes('conclu')) return 'Conclu√≠do';
            if (s.includes('andamento')) return 'Em Andamento';
            if (s.includes('atras')) return 'Atrasado';
            if (s.includes('aguard')) return 'Aguardando Cliente';
            if (s.includes('n√£o') || s.includes('nao')) return 'N√£o Iniciado';
            return status;
        }
        async function loadData() {
            try {
                const response = await fetch('dados.json?t=' + Date.now());
                if (!response.ok) throw new Error('N√£o encontrado');
                const data = await response.json();
                if (data.projects && data.projects.length > 0) {
                    const p = data.projects;
                    document.getElementById('totalCount').textContent = p.length;
                    document.getElementById('concluidoCount').textContent = p.filter(x => normalizeStatus(x.status) === 'Conclu√≠do').length;
                    document.getElementById('andamentoCount').textContent = p.filter(x => normalizeStatus(x.status) === 'Em Andamento').length;
                    const atrasados = p.filter(x => normalizeStatus(x.status) === 'Atrasado').length;
                    const parados = p.filter(x => (x.diasSemAtual || 0) > 15 && normalizeStatus(x.status) !== 'Conclu√≠do').length;
                    const criticos = p.filter(x => normalizeStatus(x.status) === 'Atrasado' || (x.situacao || x.rag || '').toLowerCase() === 'vermelho').length;
                    document.getElementById('criticoCount').textContent = criticos;
                    document.getElementById('paradosCount').textContent = parados;
                    if (data.lastUpdate) {
                        const d = new Date(data.lastUpdate);
                        document.getElementById('updateDate').textContent = d.toLocaleDateString('pt-BR', {day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'});
                        // Comparar apenas datas (sem horas)
                        const hoje = new Date();
                        hoje.setHours(0, 0, 0, 0);
                        const dataUpdate = new Date(d);
                        dataUpdate.setHours(0, 0, 0, 0);
                        const diff = Math.floor((hoje - dataUpdate) / (1000*60*60*24));
                        if (diff === 0) document.getElementById('timeAgo').textContent = 'hoje';
                        else if (diff === 1) document.getElementById('timeAgo').textContent = 'ontem';
                        else document.getElementById('timeAgo').textContent = `h√° ${diff} dias`;
                    }
                    const alertBox = document.getElementById('alertBox');
                    alertBox.classList.remove('hidden');
                    if (criticos > 0 || parados > 0) {
                        document.getElementById('atrasadosNum').textContent = atrasados;
                        document.getElementById('paradosNum').textContent = parados;
                        if (atrasados === 0) document.getElementById('badgeAtrasados').style.display = 'none';
                        if (parados === 0) document.getElementById('badgeParados').style.display = 'none';
                    } else {
                        alertBox.classList.add('success');
                        document.getElementById('alertIcon').textContent = '‚úÖ';
                        document.getElementById('alertTitle').textContent = 'Tudo em ordem!';
                        document.getElementById('alertText').textContent = 'Nenhum projeto cr√≠tico ou parado.';
                        document.getElementById('alertBadges').style.display = 'none';
                    }
                }
            } catch(e) { document.getElementById('updateDate').textContent = 'Dados n√£o dispon√≠veis'; }
        }
        window.addEventListener('load', loadData);
    </script>
</body>
</html>
