<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Infraestrutura v7.6</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); overflow: hidden; }
        
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px 25px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .header-left h1 { font-size: 1.4em; margin-bottom: 5px; }
        .header-left p { opacity: 0.9; font-size: 0.85em; }
        
        .nav-buttons { display: flex; gap: 8px; flex-wrap: wrap; }
        .nav-btn { padding: 9px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85em; transition: all 0.2s; text-decoration: none; display: inline-flex; align-items: center; gap: 5px; color: white; }
        .nav-btn.green { background: #22c55e; }
        .nav-btn.green:hover { background: #16a34a; }
        .nav-btn.purple { background: #8b5cf6; }
        .nav-btn.purple:hover { background: #7c3aed; }
        .nav-btn.blue { background: #3b82f6; }
        .nav-btn.blue:hover { background: #2563eb; }
        
        .content { padding: 20px 25px; }
        
        .toggle { display: flex; justify-content: center; margin-bottom: 18px; }
        .toggle button { padding: 11px 28px; border: 2px solid #667eea; background: white; color: #667eea; font-weight: 600; cursor: pointer; transition: all 0.2s; font-size: 0.95em; }
        .toggle button:first-child { border-radius: 25px 0 0 25px; }
        .toggle button:last-child { border-radius: 0 25px 25px 0; border-left: none; }
        .toggle button.active { background: #667eea; color: white; }
        
        .phases-legend { background: #f1f5f9; padding: 10px 15px; border-radius: 8px; margin-bottom: 15px; font-size: 0.75em; color: #64748b; text-align: center; line-height: 1.8; }
        .phases-legend strong { color: #475569; }
        
        .filters { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 18px; padding: 15px; background: #f8fafc; border-radius: 10px; align-items: end; }
        .filter-group label { display: block; font-size: 0.78em; color: #64748b; margin-bottom: 4px; font-weight: 500; }
        .filter-group input, .filter-group select { width: 100%; padding: 8px 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.9em; }
        
        .checkbox-group { display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: #fef2f2; border: 2px solid #fca5a5; border-radius: 8px; cursor: pointer; }
        .checkbox-group input { width: 16px; height: 16px; cursor: pointer; }
        .checkbox-group span { font-size: 0.85em; color: #dc2626; font-weight: 600; }
        
        /* KPI Cards */
        .kpis { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 12px; margin-bottom: 20px; }
        .kpi { text-align: center; padding: 15px 10px; background: white; border-radius: 10px; border: 2px solid #e2e8f0; cursor: pointer; transition: all 0.2s; }
        .kpi:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .kpi.verde { border-color: #22c55e; }
        .kpi.amarelo { border-color: #f59e0b; }
        .kpi.vermelho { border-color: #ef4444; }
        .kpi.azul { border-color: #3b82f6; }
        .kpi.rosa { border-color: #ec4899; }
        .kpi .num { font-size: 1.8em; font-weight: 700; color: #1e293b; }
        .kpi .lbl { font-size: 0.8em; color: #64748b; }
        
        /* Fase cards (Macro) - GRID LADO A LADO */
        .phases { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .phase-card { background: white; border: 1px solid #e2e8f0; border-radius: 10px; padding: 15px; border-top: 4px solid #e2e8f0; }
        .phase-card.verde { border-top-color: #22c55e; }
        .phase-card.amarelo { border-top-color: #f59e0b; }
        .phase-card.vermelho { border-top-color: #ef4444; }
        
        .phase-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px; }
        .phase-title-group { flex: 1; }
        .phase-title { font-weight: 700; color: #1e293b; font-size: 0.9em; display: block; margin-bottom: 3px; }
        .phase-count { font-size: 0.8em; color: #64748b; }
        .phase-alert { background: #fee2e2; color: #dc2626; padding: 3px 8px; border-radius: 10px; font-size: 0.7em; font-weight: 700; margin-left: 5px; }
        .phase-percent { font-size: 1.4em; font-weight: 700; }
        .phase-percent.verde { color: #22c55e; }
        .phase-percent.amarelo { color: #f59e0b; }
        .phase-percent.vermelho { color: #ef4444; }
        
        .phase-bar { height: 8px; background: #e2e8f0; border-radius: 4px; margin-bottom: 10px; overflow: hidden; }
        .phase-bar-fill { height: 100%; border-radius: 4px; }
        .phase-bar-fill.verde { background: #22c55e; }
        .phase-bar-fill.amarelo { background: #f59e0b; }
        .phase-bar-fill.vermelho { background: #ef4444; }
        
        .phase-context { font-size: 0.78em; padding: 6px 10px; border-radius: 6px; margin-bottom: 8px; }
        .phase-context.gray { background: #f1f5f9; color: #64748b; }
        .phase-context.warning { background: #fef3c7; color: #92400e; }
        .phase-context.danger { background: #fee2e2; color: #dc2626; }
        
        .phase-info { font-size: 0.8em; color: #64748b; margin-bottom: 8px; }
        .phase-projects { display: flex; flex-wrap: wrap; gap: 5px; }
        .badge { background: #e0e7ff; color: #4338ca; padding: 4px 10px; border-radius: 12px; font-size: 0.75em; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .badge:hover { background: #4338ca; color: white; }
        .badge.critico { background: #fee2e2; color: #dc2626; }
        .badge.critico:hover { background: #dc2626; color: white; }
        
        /* Project cards (Micro) - GRID */
        .projects { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 15px; }
        .project-card { background: white; border: 1px solid #e2e8f0; border-radius: 10px; padding: 15px; cursor: pointer; transition: all 0.2s; border-left: 4px solid #e2e8f0; }
        .project-card:hover { box-shadow: 0 5px 20px rgba(0,0,0,0.1); transform: translateY(-2px); }
        .project-card.verde { border-left-color: #22c55e; }
        .project-card.amarelo { border-left-color: #f59e0b; }
        .project-card.vermelho { border-left-color: #ef4444; }
        
        .project-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px; }
        .project-name { font-weight: 700; color: #1e293b; font-size: 1.1em; }
        .priority { padding: 3px 8px; border-radius: 4px; font-size: 0.7em; font-weight: 700; text-transform: uppercase; }
        .priority.alta { background: #fee2e2; color: #dc2626; }
        .priority.media { background: #fef3c7; color: #d97706; }
        .priority.baixa { background: #dcfce7; color: #16a34a; }
        
        .project-meta { display: flex; flex-wrap: wrap; gap: 12px; font-size: 0.82em; color: #64748b; margin-bottom: 10px; }
        
        .project-phase { background: #eff6ff; color: #1d4ed8; padding: 6px 10px; border-radius: 6px; font-size: 0.8em; margin-bottom: 6px; display: inline-block; }
        .project-next-phase { font-size: 0.75em; color: #64748b; margin-bottom: 10px; }
        .project-next-phase strong { color: #475569; }
        
        .project-dates { display: flex; gap: 12px; font-size: 0.8em; margin-bottom: 10px; color: #64748b; flex-wrap: wrap; }
        .project-dates .atrasado { color: #dc2626; font-weight: 600; }
        
        .progress { margin-bottom: 10px; }
        .progress-header { display: flex; justify-content: space-between; font-size: 0.85em; margin-bottom: 4px; }
        .progress-bar { height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 3px; }
        .progress-fill.verde { background: #22c55e; }
        .progress-fill.amarelo { background: #f59e0b; }
        .progress-fill.vermelho { background: #ef4444; }
        
        .project-footer { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px; }
        .status-badge { display: inline-block; padding: 4px 10px; border-radius: 5px; font-size: 0.75em; font-weight: 600; }
        .status-badge.concluido { background: #dcfce7; color: #166534; }
        .status-badge.em-andamento { background: #dbeafe; color: #1e40af; }
        .status-badge.aguardando { background: #fef3c7; color: #92400e; }
        .status-badge.nao-iniciado { background: #f3f4f6; color: #4b5563; }
        .status-badge.atrasado { background: #fee2e2; color: #991b1b; }
        
        .delay-badge { font-size: 0.75em; color: #dc2626; font-weight: 600; }
        
        .empty { text-align: center; padding: 40px; color: #64748b; }
        
        /* Modal */
        .modal-bg { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; padding: 20px; }
        .modal-bg.show { display: flex; }
        .modal { background: white; border-radius: 12px; max-width: 750px; width: 100%; max-height: 85vh; overflow: hidden; }
        .modal-head { background: #667eea; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .modal-head h2 { font-size: 1.1em; }
        .modal-head-btns { display: flex; gap: 8px; }
        .modal-close { background: rgba(255,255,255,0.2); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 1.2em; }
        .modal-print-btn { background: #22c55e; border: none; color: white; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em; font-weight: 600; }
        .modal-print-btn:hover { background: #16a34a; }
        .modal-body { padding: 20px; max-height: calc(85vh - 60px); overflow-y: auto; }
        
        .modal-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0; }
        .modal-info-item { font-size: 0.85em; }
        .modal-info-item .label { color: #64748b; display: block; font-size: 0.85em; }
        .modal-info-item .value { color: #1e293b; font-weight: 600; }
        .modal-info-item .value.danger { color: #dc2626; }
        
        .modal-entrega { background: #eff6ff; border: 1px solid #bfdbfe; padding: 12px 15px; border-radius: 8px; margin-bottom: 15px; }
        .modal-entrega-title { font-size: 0.8em; color: #1d4ed8; font-weight: 600; margin-bottom: 5px; }
        .modal-entrega-content { font-size: 0.9em; color: #1e293b; }
        
        .summary { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 15px; }
        .summary-item { text-align: center; padding: 12px 8px; background: #f8fafc; border-radius: 8px; }
        .summary-item .num { font-size: 1.4em; font-weight: 700; }
        .summary-item .lbl { font-size: 0.75em; color: #64748b; }
        
        .activity-list { border: 1px solid #e2e8f0; border-radius: 8px; }
        .activity { display: grid; grid-template-columns: 1fr auto auto; gap: 10px; align-items: center; padding: 10px 12px; border-bottom: 1px solid #e2e8f0; cursor: pointer; transition: background 0.2s; }
        .activity:hover { background: #eff6ff; }
        .activity:last-child { border-bottom: none; }
        .activity:nth-child(even) { background: #f8fafc; }
        .activity:nth-child(even):hover { background: #eff6ff; }
        .activity-info { min-width: 0; }
        .activity-name { font-size: 0.9em; color: #1e293b; font-weight: 500; }
        .activity-fase { font-size: 0.75em; color: #64748b; }
        .activity-dates { font-size: 0.75em; color: #94a3b8; }
        .activity-resp { font-size: 0.75em; color: #64748b; text-align: right; min-width: 80px; }
        
        .timestamp { text-align: center; padding: 15px; color: #94a3b8; font-size: 0.8em; border-top: 1px solid #e2e8f0; margin-top: 20px; }
        
        /* Modal de Impress√£o/PDF */
        .print-modal { max-width: 500px; }
        .print-options { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
        .print-option { display: flex; align-items: center; gap: 10px; padding: 12px 15px; background: #f8fafc; border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s; }
        .print-option:hover { border-color: #667eea; background: #f0f4ff; }
        .print-option.selected { border-color: #667eea; background: #eff6ff; }
        .print-option input[type="radio"] { width: 18px; height: 18px; cursor: pointer; }
        .print-option-text { flex: 1; }
        .print-option-title { font-weight: 600; color: #1e293b; font-size: 0.95em; }
        .print-option-desc { font-size: 0.8em; color: #64748b; margin-top: 2px; }
        
        .print-projects-list { max-height: 200px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px; padding: 10px; margin-top: 10px; display: none; }
        .print-projects-list.show { display: block; }
        .print-project-item { display: flex; align-items: center; gap: 10px; padding: 8px; border-radius: 6px; cursor: pointer; }
        .print-project-item:hover { background: #f1f5f9; }
        .print-project-item input { width: 16px; height: 16px; }
        
        .print-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .print-buttons button { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; font-size: 0.95em; }
        .btn-execute { background: #667eea; color: white; }
        .btn-execute:hover { background: #5a67d8; }
        .btn-cancel { background: #e2e8f0; color: #475569; }
        .btn-cancel:hover { background: #cbd5e1; }
        
        /* Modal Atividade */
        .activity-modal { max-width: 500px; }
        .activity-detail { padding: 15px; background: #f8fafc; border-radius: 8px; margin-bottom: 15px; }
        .activity-detail-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e2e8f0; }
        .activity-detail-row:last-child { border-bottom: none; }
        .activity-detail-label { color: #64748b; font-size: 0.9em; }
        .activity-detail-value { color: #1e293b; font-weight: 600; font-size: 0.9em; }
        .activity-history { margin-top: 15px; }
        .activity-history h4 { font-size: 0.95em; color: #1e293b; margin-bottom: 10px; }
        .activity-history-empty { text-align: center; padding: 20px; color: #94a3b8; font-size: 0.9em; background: #f8fafc; border-radius: 8px; }
        
        /* Tratativas no Modal de Atividade */
        .tratativa-item { background: #f8fafc; border-radius: 8px; padding: 12px; margin-bottom: 10px; border-left: 4px solid #667eea; }
        .tratativa-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .tratativa-user { display: flex; align-items: center; gap: 8px; }
        .tratativa-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.8em; }
        .tratativa-info { display: flex; flex-direction: column; }
        .tratativa-name { font-weight: 600; color: #1e293b; font-size: 0.85em; }
        .tratativa-role { font-size: 0.7em; color: #64748b; }
        .tratativa-date { font-size: 0.7em; color: #94a3b8; }
        .tratativa-type { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.7em; font-weight: 600; margin-bottom: 6px; }
        .tratativa-type.comentario { background: #dbeafe; color: #1e40af; }
        .tratativa-type.atualizacao { background: #dcfce7; color: #166534; }
        .tratativa-type.alerta { background: #fee2e2; color: #991b1b; }
        .tratativa-type.resolucao { background: #f3e8ff; color: #7c3aed; }
        .tratativa-content { color: #475569; font-size: 0.85em; line-height: 1.4; padding: 8px; background: white; border-radius: 6px; }
        
        @media (max-width: 768px) {
            .header { flex-direction: column; text-align: center; }
            .filters { grid-template-columns: 1fr 1fr; }
            .phases { grid-template-columns: 1fr; }
            .projects { grid-template-columns: 1fr; }
            .summary { grid-template-columns: repeat(2, 1fr); }
            .kpis { grid-template-columns: repeat(2, 1fr); }
        }

        @media print {
            body { background: white !important; padding: 10px !important; }
            .container { box-shadow: none !important; max-width: 100% !important; }
            .nav-buttons, .toggle, .filters, .checkbox-group { display: none !important; }
            .header { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; padding: 15px !important; }
            .content { padding: 15px !important; }
            .kpi, .phase-card, .project-card { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; border: 1px solid #e2e8f0 !important; break-inside: avoid !important; }
            .phase-bar-fill, .progress-fill { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
        }
    </style>
</head>
<body>
    <div class="container" id="mainContainer">
        <header class="header">
            <div class="header-left">
                <h1>üìä Dashboard de Infraestrutura</h1>
                <p>Gest√£o de Projetos | Invent Corp</p>
            </div>
            <nav class="nav-buttons">
                <a href="view-detalhada.html" class="nav-btn green">üìã Vis√£o Detalhada</a>
                <button class="nav-btn purple" onclick="abrirPrintModal('print')">üñ®Ô∏è Imprimir</button>
                <button class="nav-btn blue" onclick="abrirPrintModal('pdf')">üìÑ Gerar PDF</button>
            </nav>
        </header>
        
        <main class="content">
            <div class="toggle">
                <button id="btnMacro" class="active" onclick="setView('macro')">üìä Vis√£o Executiva (Macro)</button>
                <button id="btnMicro" onclick="setView('micro')">üìã Vis√£o por Projeto (Micro)</button>
            </div>
            
            <div class="kpis" id="kpis"></div>
            
            <div class="phases-legend">
                <strong>Fases:</strong> 1. Kickoff ¬∑ 2. Levantamento & Design ¬∑ 3. Provisionamento ¬∑ 4. Implanta√ß√£o ¬∑ 5. Homologa√ß√£o ¬∑ 6. Go Live ¬∑ 7. Hypercare ¬∑ 8. Encerramento
            </div>
            
            <div class="filters">
                <div class="filter-group">
                    <label>üîç Buscar:</label>
                    <input type="text" id="search" placeholder="Nome do projeto..." oninput="render()">
                </div>
                <div class="filter-group">
                    <label>üìä Status:</label>
                    <select id="filterStatus" onchange="render()">
                        <option value="">Todos</option>
                        <option value="Conclu√≠do">Conclu√≠do</option>
                        <option value="Em andamento">Em andamento</option>
                        <option value="Aguardando">Aguardando</option>
                        <option value="N√£o Iniciado">N√£o Iniciado</option>
                        <option value="Atrasado">Atrasado</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>‚ö° Prioridade:</label>
                    <select id="filterPrior" onchange="render()">
                        <option value="">Todas</option>
                        <option value="Alta">Alta</option>
                        <option value="M√©dia">M√©dia</option>
                        <option value="Baixa">Baixa</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>üìç Local:</label>
                    <select id="filterLocal" onchange="render()"></select>
                </div>
                <div class="filter-group">
                    <label>üë§ Respons√°vel:</label>
                    <select id="filterResp" onchange="render()"></select>
                </div>
                <label class="checkbox-group">
                    <input type="checkbox" id="filterCritico" onchange="render()">
                    <span>üö® Apenas Cr√≠ticos</span>
                </label>
            </div>
            
            <div id="macroView" class="phases"></div>
            <div id="microView" class="projects" style="display:none;"></div>
            
            <div class="timestamp" id="ts"></div>
        </main>
    </div>
    
    <!-- Modal Projeto -->
    <div class="modal-bg" id="modal" onclick="fecharModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-head">
                <h2 id="modalTitle">Projeto</h2>
                <div class="modal-head-btns">
                    <button class="modal-print-btn" onclick="imprimirProjeto()">üñ®Ô∏è Imprimir</button>
                    <button class="modal-close" onclick="fecharModal()">√ó</button>
                </div>
            </div>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>
    
    <!-- Modal Impress√£o/PDF -->
    <div class="modal-bg" id="printModal" onclick="fecharPrintModal(event)">
        <div class="modal print-modal" onclick="event.stopPropagation()">
            <div class="modal-head">
                <h2 id="printModalTitle">üñ®Ô∏è Imprimir</h2>
                <button class="modal-close" onclick="fecharPrintModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="print-options">
                    <label class="print-option selected" onclick="selecionarOpcao(this, 'atual')">
                        <input type="radio" name="printType" value="atual" checked>
                        <div class="print-option-text">
                            <div class="print-option-title">üìã Filtro Atual</div>
                            <div class="print-option-desc">Projetos vis√≠veis na tela com os filtros aplicados</div>
                        </div>
                    </label>
                    <label class="print-option" onclick="selecionarOpcao(this, 'todos')">
                        <input type="radio" name="printType" value="todos">
                        <div class="print-option-text">
                            <div class="print-option-title">üìÅ Todos os Projetos</div>
                            <div class="print-option-desc">Incluir todos os projetos independente dos filtros</div>
                        </div>
                    </label>
                    <label class="print-option" onclick="selecionarOpcao(this, 'criticos')">
                        <input type="radio" name="printType" value="criticos">
                        <div class="print-option-text">
                            <div class="print-option-title">üö® Apenas Cr√≠ticos</div>
                            <div class="print-option-desc">Somente projetos atrasados ou com prioridade alta</div>
                        </div>
                    </label>
                    <label class="print-option" onclick="selecionarOpcao(this, 'especificos')">
                        <input type="radio" name="printType" value="especificos">
                        <div class="print-option-text">
                            <div class="print-option-title">‚úÖ Projetos Espec√≠ficos</div>
                            <div class="print-option-desc">Selecionar manualmente quais projetos incluir</div>
                        </div>
                    </label>
                </div>
                <div class="print-projects-list" id="printProjectsList"></div>
                <div class="print-select-buttons" id="printSelectButtons" style="display:none;margin-top:10px;gap:10px;">
                    <button type="button" onclick="marcarTodos(true)" style="flex:1;padding:8px 12px;background:#22c55e;color:white;border:none;border-radius:6px;font-weight:600;cursor:pointer;">‚úÖ Marcar todos</button>
                    <button type="button" onclick="marcarTodos(false)" style="flex:1;padding:8px 12px;background:#ef4444;color:white;border:none;border-radius:6px;font-weight:600;cursor:pointer;">‚ùå Desmarcar todos</button>
                </div>
                <div class="print-buttons">
                    <button class="btn-cancel" onclick="fecharPrintModal()">Cancelar</button>
                    <button class="btn-execute" id="btnExecutePrint" onclick="executarPrint()">üñ®Ô∏è Imprimir</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Atividade -->
    <div class="modal-bg" id="activityModal" onclick="fecharActivityModal(event)">
        <div class="modal activity-modal" onclick="event.stopPropagation()">
            <div class="modal-head">
                <h2 id="activityModalTitle">Detalhes da Atividade</h2>
                <button class="modal-close" onclick="fecharActivityModal()">√ó</button>
            </div>
            <div class="modal-body" id="activityModalBody"></div>
        </div>
    </div>

<script>
const PROJETOS = [
    { nome: 'BARBECUE B2B', local: 'S√£o Paulo - SP', resp: 'ALEX', prioridade: 'Alta', dataInicio: '2025-06-01', dataPrevista: '2026-02-06' },
    { nome: 'BELEZA', local: 'S√£o Paulo - SP', resp: 'ANDERSON', prioridade: 'M√©dia', dataInicio: '2025-05-01', dataPrevista: '2025-11-30' },
    { nome: 'BETA', local: 'Rio de Janeiro - RJ', resp: 'ANDERSON', prioridade: 'Alta', dataInicio: '2025-07-01', dataPrevista: '2026-03-10' },
    { nome: 'BETA ESTEIO', local: 'Esteio - RS', resp: 'ANDERSON', prioridade: 'M√©dia', dataInicio: '2026-01-16', dataPrevista: '2026-07-15' },
    { nome: 'BP', local: 'S√£o Paulo - SP', resp: 'GIOVANNI', prioridade: 'M√©dia', dataInicio: '2025-12-01', dataPrevista: '2026-06-30' },
    { nome: 'BR', local: 'Jaboat√£o - PE', resp: 'F√ÅBIO', prioridade: 'Alta', dataInicio: '2026-02-01', dataPrevista: '2026-08-01' },
    { nome: 'CANDELABRIA', local: 'Candel√°ria - RS', resp: 'ALEX', prioridade: 'M√©dia', dataInicio: '2025-06-01', dataPrevista: '2025-12-09' },
    { nome: 'CDSK', local: 'S√£o Paulo - SP', resp: 'VINICIUS', prioridade: 'Alta', dataInicio: '2025-08-01', dataPrevista: '2026-02-28' },
    { nome: 'COUGAR', local: 'S√£o Paulo - SP', resp: 'LEANDRO', prioridade: 'Alta', dataInicio: '2025-05-01', dataPrevista: '2026-02-09' },
    { nome: 'CRISTAL MG RETROFIT', local: 'Belo Horizonte - MG', resp: 'GIOVANNI', prioridade: 'Alta', dataInicio: '2025-11-01', dataPrevista: '2026-05-30' },
    { nome: 'DIA', local: 'S√£o Paulo - SP', resp: 'ANDERSON', prioridade: 'Alta', dataInicio: '2025-09-01', dataPrevista: '2026-01-15' },
    { nome: 'DIAMANTE', local: 'Curitiba - PR', resp: 'F√ÅBIO', prioridade: 'M√©dia', dataInicio: '2026-02-15', dataPrevista: '2026-08-15' },
    { nome: 'ELETRO', local: 'S√£o Paulo - SP', resp: 'GIOVANNI', prioridade: 'M√©dia', dataInicio: '2025-10-01', dataPrevista: '2026-04-30' },
    { nome: 'ESPERAN√áA', local: 'Belo Horizonte - MG', resp: 'VINICIUS', prioridade: 'M√©dia', dataInicio: '2025-04-01', dataPrevista: '2026-01-19' },
    { nome: 'FLOWER', local: 'S√£o Paulo - SP', resp: 'ANDERSON', prioridade: 'Baixa', dataInicio: '2025-12-01', dataPrevista: '2026-06-30' },
    { nome: 'GAVI√ÉO', local: 'Fortaleza - CE', resp: 'F√ÅBIO', prioridade: 'Alta', dataInicio: '2025-05-01', dataPrevista: '2026-02-01' },
    { nome: 'MKT CHILE', local: 'Santiago - Chile', resp: 'ALEX', prioridade: 'M√©dia', dataInicio: '2026-06-01', dataPrevista: '2026-12-01' },
    { nome: 'MKT PERU', local: 'Lima - Peru', resp: 'ALEX', prioridade: 'M√©dia', dataInicio: '2026-06-01', dataPrevista: '2026-12-01' },
    { nome: 'MASTER', local: 'S√£o Paulo - SP', resp: 'LEANDRO', prioridade: 'Alta', dataInicio: '2026-03-01', dataPrevista: '2026-09-01' },
    { nome: 'NAVEPARK', local: 'Curitiba - PR', resp: 'ANDERSON', prioridade: 'M√©dia', dataInicio: '2025-09-01', dataPrevista: '2026-04-30' },
    { nome: 'OCTOPUS MS', local: 'Campo Grande - MS', resp: 'ALEX', prioridade: 'M√©dia', dataInicio: '2025-10-01', dataPrevista: '2026-04-30' },
    { nome: 'OCTOPUS SC', local: 'Florian√≥polis - SC', resp: 'ALEX', prioridade: 'M√©dia', dataInicio: '2025-06-01', dataPrevista: '2025-12-15' },
    { nome: 'OPTIMUS PRIME', local: 'S√£o Paulo - SP', resp: 'GIOVANNI', prioridade: 'Alta', dataInicio: '2025-04-01', dataPrevista: '2025-10-27' },
    { nome: 'PBL GUATEMALA', local: 'Guatemala City', resp: 'F√ÅBIO', prioridade: 'Alta', dataInicio: '2025-09-01', dataPrevista: '2026-03-31' },
    { nome: 'PROMO B2B CD GRU', local: 'Guarulhos - SP', resp: 'LEANDRO', prioridade: 'Alta', dataInicio: '2025-07-01', dataPrevista: '2026-02-04' },
    { nome: 'PTL SP', local: 'S√£o Paulo - SP', resp: 'VINICIUS', prioridade: 'M√©dia', dataInicio: '2025-04-01', dataPrevista: '2025-10-30' },
    { nome: 'REISADO', local: 'Recife - PE', resp: 'F√ÅBIO', prioridade: 'M√©dia', dataInicio: '2025-06-01', dataPrevista: '2025-12-20' },
    { nome: 'REVERSE', local: 'S√£o Paulo - SP', resp: 'ALEX', prioridade: 'Alta', dataInicio: '2025-09-01', dataPrevista: '2026-03-15' },
    { nome: 'SUPER DIVINOPOLIS', local: 'Divin√≥polis - MG', resp: 'GIOVANNI', prioridade: 'M√©dia', dataInicio: '2025-10-01', dataPrevista: '2026-04-30' },
    { nome: 'TITANIO', local: 'S√£o Paulo - SP', resp: 'ALEX', prioridade: 'Alta', dataInicio: '2025-07-01', dataPrevista: '2026-02-28' }
];

const FASES = [
    '1. Kickoff',
    '2. Levantamento & Design',
    '3. Provisionamento',
    '4. Implanta√ß√£o',
    '5. Homologa√ß√£o',
    '6. Go Live',
    '7. Hypercare',
    '8. Encerramento'
];

// Atividades por fase (2-3 cada)
const ATIVIDADES_POR_FASE = {
    '1. Kickoff': ['Reuni√£o de Kickoff', 'Defini√ß√£o de Escopo'],
    '2. Levantamento & Design': ['Levantamento T√©cnico', 'Documenta√ß√£o de Arquitetura', 'Elabora√ß√£o do Cronograma'],
    '3. Provisionamento': ['Solicita√ß√£o de Acessos (VPN/IPs)', 'Aquisi√ß√£o de Equipamentos', 'Prepara√ß√£o de Ambiente'],
    '4. Implanta√ß√£o': ['Instala√ß√£o F√≠sica', 'Configura√ß√£o de Rede', 'Integra√ß√£o de Sistemas'],
    '5. Homologa√ß√£o': ['Testes Funcionais', 'Testes de Performance', 'Valida√ß√£o com Cliente'],
    '6. Go Live': ['Janela de Mudan√ßa (GMUD)', 'Migra√ß√£o para Produ√ß√£o', 'Valida√ß√£o P√≥s-Migra√ß√£o'],
    '7. Hypercare': ['Monitoramento Intensivo', 'Corre√ß√£o de Incidentes', 'Ajustes e Otimiza√ß√£o'],
    '8. Encerramento': ['Documenta√ß√£o Final', 'Treinamento/Repasse', 'Aceite Formal']
};

// Total de atividades por projeto
const TOTAL_ATIVIDADES = Object.values(ATIVIDADES_POR_FASE).flat().length; // 22 atividades

// Status de cada projeto (n√∫mero de atividades conclu√≠das: 0-22)
const PROJETO_STATUS = {
    'BARBECUE B2B': 22, 'BELEZA': 22, 'BETA': 22, 'BETA ESTEIO': 1, 'BP': 3,
    'BR': 1, 'CANDELABRIA': 22, 'CDSK': 17, 'COUGAR': 22, 'CRISTAL MG RETROFIT': 4,
    'DIA': 7, 'DIAMANTE': 0, 'ELETRO': 10, 'ESPERAN√áA': 22, 'FLOWER': 4,
    'GAVI√ÉO': 22, 'MKT CHILE': 0, 'MKT PERU': 0, 'MASTER': 0, 'NAVEPARK': 8,
    'OCTOPUS MS': 11, 'OCTOPUS SC': 22, 'OPTIMUS PRIME': 22, 'PBL GUATEMALA': 12,
    'PROMO B2B CD GRU': 22, 'PTL SP': 22, 'REISADO': 22, 'REVERSE': 14,
    'SUPER DIVINOPOLIS': 11, 'TITANIO': 19
};

// Gerar atividades automaticamente para cada projeto
function gerarAtividades() {
    const atividades = [];
    
    PROJETOS.forEach(p => {
        const atividadesConcluidas = PROJETO_STATUS[p.nome] || 0;
        const inicio = new Date(p.dataInicio);
        const fim = new Date(p.dataPrevista);
        const duracaoTotal = fim - inicio;
        
        let indiceAtividade = 0;
        let tempoAcumulado = 0;
        
        FASES.forEach((fase, faseIndex) => {
            const atividadesDaFase = ATIVIDADES_POR_FASE[fase];
            const duracaoFase = duracaoTotal / 8; // 8 fases
            const duracaoPorAtividade = duracaoFase / atividadesDaFase.length;
            
            atividadesDaFase.forEach((nomeAtividade, atvIndex) => {
                const dataInicio = new Date(inicio.getTime() + tempoAcumulado);
                tempoAcumulado += duracaoPorAtividade;
                const dataFim = new Date(inicio.getTime() + tempoAcumulado);
                
                let status = 'N√£o Iniciado';
                if (indiceAtividade < atividadesConcluidas) {
                    status = 'Conclu√≠do';
                } else if (indiceAtividade === atividadesConcluidas) {
                    const hoje = new Date();
                    if (dataInicio <= hoje) status = 'Em andamento';
                    else status = 'Aguardando';
                }
                
                atividades.push({
                    proj: p.nome,
                    nome: nomeAtividade,
                    fase: fase,
                    status: status,
                    dataInicio: dataInicio.toISOString().split('T')[0],
                    dataFim: dataFim.toISOString().split('T')[0],
                    resp: p.resp,
                    descricao: `${nomeAtividade} do projeto ${p.nome}`
                });
                
                indiceAtividade++;
            });
        });
    });
    return atividades;
}

const ATIVIDADES = gerarAtividades();

let view='macro', projetoFiltro='', projetoAtual='', printMode='print';
const hoje=new Date();hoje.setHours(0,0,0,0);

function parseDate(s){if(!s)return null;const[y,m,d]=s.split('-').map(Number);return new Date(y,m-1,d)}
function formatDate(s){if(!s)return'-';const[y,m,d]=s.split('-');return`${d}/${m}/${y}`}
function diasAtraso(dp){const p=parseDate(dp);if(!p)return 0;const d=Math.floor((hoje-p)/(1000*60*60*24));return d>0?d:0}
function getAtividades(p){return ATIVIDADES.filter(a=>a.proj===p)}
function calcProgresso(p){const a=getAtividades(p);if(!a.length)return 0;return Math.round(a.filter(x=>x.status==='Conclu√≠do').length/a.length*100)}
function calcStatus(p){const pr=PROJETOS.find(x=>x.nome===p),pg=calcProgresso(p);if(pg===100)return'Conclu√≠do';if(pr&&diasAtraso(pr.dataPrevista)>0&&pg<100)return'Atrasado';if(pg===0){const a=getAtividades(p);if(a.some(x=>x.status==='Aguardando'))return'Aguardando';return'N√£o Iniciado'}const a=getAtividades(p);if(a.some(x=>x.status==='Em andamento'))return'Em andamento';if(a.some(x=>x.status==='Aguardando'))return'Aguardando';return'Em andamento'}
function calcFaseAtual(p){const a=getAtividades(p);if(!a.length)return FASES[0];if(a.every(x=>x.status==='Conclu√≠do'))return FASES[7];for(const f of FASES){const af=a.filter(x=>x.fase===f);if(af.some(x=>x.status==='Em andamento'))return f}for(const f of FASES){const af=a.filter(x=>x.fase===f);if(af.some(x=>x.status==='Aguardando'))return f}for(const f of FASES){const af=a.filter(x=>x.fase===f);if(af.length&&!af.every(x=>x.status==='Conclu√≠do'))return f}return FASES[0]}
function calcProximaFase(p){const f=calcFaseAtual(p),i=FASES.indexOf(f);return i<FASES.length-1?FASES[i+1]:null}
function calcProximaEntrega(p){const a=getAtividades(p).filter(x=>x.status!=='Conclu√≠do').sort((a,b)=>parseDate(a.dataInicio)-parseDate(b.dataInicio));return a.length?a[0]:null}
function isCritico(p){const pr=PROJETOS.find(x=>x.nome===p),s=calcStatus(p);return s==='Atrasado'||pr?.prioridade==='Alta'||s==='Aguardando'}
function getCor(pct){return pct>=80?'verde':pct>=40?'amarelo':'vermelho'}
function getStatusClass(s){return s.toLowerCase().replace(/ /g,'-').replace('√£','a')}

function getContextoFase(f,ps){if(ps.some(p=>calcStatus(p.nome)==='Atrasado'))return{tipo:'danger',texto:'üö® Projeto(s) atrasado(s)'};let todasFut=true,algPassou=false;ps.forEach(p=>{const af=getAtividades(p.nome).filter(a=>a.fase===f);af.forEach(a=>{const d=parseDate(a.dataInicio);if(d&&d<=hoje){todasFut=false;if(a.status==='N√£o Iniciado')algPassou=true}})});if(todasFut)return{tipo:'gray',texto:'‚è≥ Aguardando in√≠cio'};if(algPassou)return{tipo:'warning',texto:'‚ö†Ô∏è Aten√ß√£o ao cronograma'};return null}
function faseTemAlerta(f,ps){return ps.some(p=>isCritico(p.nome)||calcStatus(p.nome)==='Atrasado')}

function getProjetosFiltrados(){const s=document.getElementById('search').value.toLowerCase(),st=document.getElementById('filterStatus').value,pr=document.getElementById('filterPrior').value,lo=document.getElementById('filterLocal').value,re=document.getElementById('filterResp').value,cr=document.getElementById('filterCritico').checked;return PROJETOS.filter(p=>{const ps=calcStatus(p.nome);return(!s||p.nome.toLowerCase().includes(s))&&(!st||ps===st)&&(!pr||p.prioridade===pr)&&(!lo||p.local===lo)&&(!re||p.resp===re)&&(!cr||isCritico(p.nome))&&(!projetoFiltro||p.nome===projetoFiltro)})}
function populateFilters(){const l=[...new Set(PROJETOS.map(p=>p.local))].sort(),r=[...new Set(PROJETOS.map(p=>p.resp))].sort();document.getElementById('filterLocal').innerHTML='<option value="">Todos</option>'+l.map(x=>`<option value="${x}">${x}</option>`).join('');document.getElementById('filterResp').innerHTML='<option value="">Todos</option>'+r.map(x=>`<option value="${x}">${x}</option>`).join('')}

function renderKPIs(){const ps=getProjetosFiltrados(),t=ps.length,c=ps.filter(p=>calcStatus(p.nome)==='Conclu√≠do').length,e=ps.filter(p=>calcStatus(p.nome)==='Em andamento').length,a=ps.filter(p=>calcStatus(p.nome)==='Atrasado').length,cr=ps.filter(p=>isCritico(p.nome)).length;document.getElementById('kpis').innerHTML=`<div class="kpi azul"><div class="num">${t}</div><div class="lbl">Total</div></div><div class="kpi verde"><div class="num">${c}</div><div class="lbl">Conclu√≠dos</div></div><div class="kpi amarelo"><div class="num">${e}</div><div class="lbl">Em Andamento</div></div><div class="kpi vermelho"><div class="num">${a}</div><div class="lbl">Atrasados</div></div><div class="kpi rosa"><div class="num">${cr}</div><div class="lbl">Cr√≠ticos</div></div>`}

function setView(v){view=v;document.getElementById('btnMacro').classList.toggle('active',v==='macro');document.getElementById('btnMicro').classList.toggle('active',v==='micro');document.getElementById('macroView').style.display=v==='macro'?'grid':'none';document.getElementById('microView').style.display=v==='micro'?'grid':'none';render()}
function render(){renderKPIs();if(view==='macro')renderMacro();else renderMicro();document.getElementById('ts').textContent='Atualizado em: '+new Date().toLocaleString('pt-BR')}

function renderMacro(){const c=document.getElementById('macroView'),ps=getProjetosFiltrados(),pf={};FASES.forEach(f=>pf[f]=[]);ps.forEach(p=>{const f=calcFaseAtual(p.nome);pf[f].push(p)});let h='';FASES.forEach(f=>{const pjs=pf[f];if(!pjs.length)return;let ta=0,co=0;pjs.forEach(p=>{const af=getAtividades(p.nome).filter(a=>a.fase===f);ta+=af.length;co+=af.filter(a=>a.status==='Conclu√≠do').length});const pct=ta?Math.round(co/ta*100):0,cor=getCor(pct),al=faseTemAlerta(f,pjs),ctx=getContextoFase(f,pjs);h+=`<div class="phase-card ${cor}"><div class="phase-header"><div class="phase-title-group"><span class="phase-title">${f}</span><span class="phase-count">${pjs.length} projeto${pjs.length>1?'s':''}</span>${al?'<span class="phase-alert">‚ö†Ô∏è</span>':''}</div><span class="phase-percent ${cor}">${pct}%</span></div><div class="phase-bar"><div class="phase-bar-fill ${cor}" style="width:${pct}%"></div></div>${ctx?`<div class="phase-context ${ctx.tipo}">${ctx.texto}</div>`:''}<div class="phase-info">${co}/${ta} atividades conclu√≠das</div><div class="phase-projects">${pjs.map(p=>`<span class="badge ${isCritico(p.nome)?'critico':''}" onclick="filtrarProjeto('${p.nome}')">${p.nome}</span>`).join('')}</div></div>`});c.innerHTML=h||'<div class="empty">Nenhum projeto encontrado</div>'}

function renderMicro(){const c=document.getElementById('microView'),ps=getProjetosFiltrados();if(!ps.length){c.innerHTML='<div class="empty">Nenhum projeto encontrado</div>';return}c.innerHTML=ps.map(p=>{const pg=calcProgresso(p.nome),st=calcStatus(p.nome),fa=calcFaseAtual(p.nome),pf=calcProximaFase(p.nome),cor=getCor(pg),at=diasAtraso(p.dataPrevista);return`<div class="project-card ${cor}" onclick="abrirModal('${p.nome}')"><div class="project-header"><span class="project-name">${p.nome}</span><span class="priority ${p.prioridade.toLowerCase()}">${p.prioridade}</span></div><div class="project-meta"><span>üìç ${p.local}</span><span>üë§ ${p.resp}</span></div><div class="project-phase">üìò Fase: ${fa}</div>${pf?`<div class="project-next-phase"><strong>Pr√≥xima:</strong> ${pf}</div>`:''}<div class="project-dates"><span>üìÖ In√≠cio: ${formatDate(p.dataInicio)}</span><span>üéØ T√©rmino previsto: ${formatDate(p.dataPrevista)}</span>${at>0&&pg<100?`<span class="atrasado">‚ö†Ô∏è ${at} dias atraso</span>`:''}</div><div class="progress"><div class="progress-header"><span>Progresso</span><span style="color:${cor==='verde'?'#22c55e':cor==='amarelo'?'#f59e0b':'#ef4444'}">${pg}%</span></div><div class="progress-bar"><div class="progress-fill ${cor}" style="width:${pg}%"></div></div></div><div class="project-footer"><span class="status-badge ${getStatusClass(st)}">${st}</span>${at>0&&pg<100?'<span class="delay-badge">üö® Cr√≠tico</span>':''}</div></div>`}).join('')}

function abrirModal(proj){
    projetoAtual=proj;
    const p=PROJETOS.find(x=>x.nome===proj),a=getAtividades(proj),pg=calcProgresso(proj),fa=calcFaseAtual(proj),pf=calcProximaFase(proj),pe=calcProximaEntrega(proj),st=calcStatus(proj),at=diasAtraso(p?.dataPrevista),dn=a.filter(x=>x.status==='Conclu√≠do').length,dg=a.filter(x=>x.status==='Em andamento').length,wa=a.filter(x=>x.status==='Aguardando').length,ns=a.filter(x=>x.status==='N√£o Iniciado').length;
    document.getElementById('modalTitle').textContent=`üìã ${proj}`;
    let mh='';if(pe)mh=`<div class="modal-entrega"><div class="modal-entrega-title">üéØ Pr√≥xima Entrega</div><div class="modal-entrega-content">${pe.nome} ‚Äì ${formatDate(pe.dataInicio)}</div></div>`;
    document.getElementById('modalBody').innerHTML=`
    <div class="modal-info">
        <div class="modal-info-item"><span class="label">Local</span><span class="value">${p?.local||'-'}</span></div>
        <div class="modal-info-item"><span class="label">Respons√°vel</span><span class="value">${p?.resp||'-'}</span></div>
        <div class="modal-info-item"><span class="label">Prioridade</span><span class="value">${p?.prioridade||'-'}</span></div>
        <div class="modal-info-item"><span class="label">In√≠cio</span><span class="value">${formatDate(p?.dataInicio)}</span></div>
        <div class="modal-info-item"><span class="label">T√©rmino Previsto</span><span class="value">${formatDate(p?.dataPrevista)}</span></div>
        ${at>0&&pg<100?`<div class="modal-info-item"><span class="label">Atraso</span><span class="value danger">‚ö†Ô∏è ${at} dias</span></div>`:''}
    </div>
    ${mh}
    <div class="summary">
        <div class="summary-item"><div class="num" style="color:#22c55e">${dn}</div><div class="lbl">Conclu√≠das</div></div>
        <div class="summary-item"><div class="num" style="color:#3b82f6">${dg}</div><div class="lbl">Em andamento</div></div>
        <div class="summary-item"><div class="num" style="color:#f59e0b">${wa}</div><div class="lbl">Aguardando</div></div>
        <div class="summary-item"><div class="num" style="color:#6b7280">${ns}</div><div class="lbl">N√£o iniciadas</div></div>
    </div>
    <p style="margin-bottom:12px;color:#64748b;font-size:0.9em"><strong>Fase atual:</strong> ${fa} | <strong>Progresso:</strong> ${pg}%${pf?` | <strong>Pr√≥xima:</strong> ${pf}`:''}</p>
    <p style="margin-bottom:8px;color:#94a3b8;font-size:0.8em">üí° Clique em uma atividade para ver detalhes</p>
    <div class="activity-list">${a.map(x=>`<div class="activity" onclick="abrirAtividade('${proj}','${x.nome}')"><div class="activity-info"><div class="activity-name">${x.nome}</div><div class="activity-fase">${x.fase}</div><div class="activity-dates">üìÖ ${formatDate(x.dataInicio)} ‚Üí ${formatDate(x.dataFim)}</div></div><div class="activity-resp">üë§ ${x.resp}</div><span class="status-badge ${getStatusClass(x.status)}">${x.status}</span></div>`).join('')}</div>`;
    document.getElementById('modal').classList.add('show');
}

function fecharModal(e){if(!e||e.target.id==='modal')document.getElementById('modal').classList.remove('show')}
function filtrarProjeto(n){projetoFiltro=n;document.getElementById('search').value=n;setView('micro')}

// TRATATIVAS POR ATIVIDADE - Preencha aqui ou importe do Excel
const TRATATIVAS = {
    // BARBECUE B2B (Conclu√≠do)
    'BARBECUE B2B_Reuni√£o de Kickoff': [
        { user: 'ALEX', role: 'PMO', date: '01/06/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado com sucesso. Equipe completa presente.' },
        { user: 'DAIANA', role: 'Gestora', date: '01/06/2025 14:00', type: 'comentario', content: 'Projeto priorit√°rio para B2B. Acompanhar de perto.' }
    ],
    'BARBECUE B2B_Aceite Formal': [
        { user: 'ALEX', role: 'PMO', date: '06/02/2026 10:00', type: 'resolucao', content: 'Projeto conclu√≠do com sucesso. Aceite assinado pelo cliente.' },
        { user: 'DOUGLAS', role: 'Diretor', date: '06/02/2026 14:00', type: 'comentario', content: 'Parab√©ns √† equipe pela entrega no prazo!' }
    ],
    // BELEZA (Conclu√≠do)
    'BELEZA_Reuni√£o de Kickoff': [
        { user: 'ANDERSON', role: 'PMO', date: '01/05/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado. Escopo alinhado com stakeholders.' }
    ],
    'BELEZA_Aceite Formal': [
        { user: 'ANDERSON', role: 'PMO', date: '30/11/2025 10:00', type: 'resolucao', content: 'Projeto BELEZA conclu√≠do. Cliente satisfeito com a entrega.' }
    ],
    // BETA (Conclu√≠do)
    'BETA_Reuni√£o de Kickoff': [
        { user: 'ANDERSON', role: 'PMO', date: '01/07/2025 10:00', type: 'atualizacao', content: 'Kickoff do projeto BETA realizado no Rio de Janeiro.' },
        { user: 'DAIANA', role: 'Gestora', date: '01/07/2025 15:00', type: 'comentario', content: 'Prioridade alta. Acompanhar cronograma semanalmente.' }
    ],
    'BETA_Aceite Formal': [
        { user: 'ANDERSON', role: 'PMO', date: '10/03/2026 09:00', type: 'resolucao', content: 'Go Live realizado com sucesso!' },
        { user: 'DOUGLAS', role: 'Diretor', date: '10/03/2026 15:00', type: 'comentario', content: 'Excelente trabalho da equipe!' }
    ],
    // BETA ESTEIO (Kickoff)
    'BETA ESTEIO_Reuni√£o de Kickoff': [
        { user: 'ANDERSON', role: 'PMO', date: '16/01/2026 09:00', type: 'atualizacao', content: 'Kickoff realizado em Esteio-RS. Equipe local mobilizada.' },
        { user: 'DAIANA', role: 'Gestora', date: '16/01/2026 14:00', type: 'comentario', content: 'Projeto novo. Definir cronograma detalhado esta semana.' }
    ],
    // BP (Levantamento)
    'BP_Reuni√£o de Kickoff': [
        { user: 'GIOVANNI', role: 'PMO', date: '01/12/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado. Cliente BP presente.' }
    ],
    'BP_Levantamento T√©cnico': [
        { user: 'GIOVANNI', role: 'PMO', date: '20/01/2026 10:00', type: 'atualizacao', content: 'Levantamento t√©cnico em andamento. Mapeando infraestrutura atual.' },
        { user: 'GIOVANNI', role: 'PMO', date: '28/01/2026 14:00', type: 'comentario', content: 'Identificadas 3 integra√ß√µes cr√≠ticas com sistemas legados.' }
    ],
    // BR (Kickoff)
    'BR_Reuni√£o de Kickoff': [
        { user: 'F√ÅBIO', role: 'PMO', date: '01/02/2026 09:00', type: 'atualizacao', content: 'Kickoff realizado em Jaboat√£o-PE. Equipe regional presente.' },
        { user: 'DAIANA', role: 'Gestora', date: '01/02/2026 15:00', type: 'comentario', content: 'Aten√ß√£o especial √† log√≠stica de equipamentos para o Nordeste.' }
    ],
    // CANDELABRIA (Conclu√≠do)
    'CANDELABRIA_Reuni√£o de Kickoff': [
        { user: 'ALEX', role: 'PMO', date: '01/06/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado em Candel√°ria-RS.' }
    ],
    'CANDELABRIA_Aceite Formal': [
        { user: 'ALEX', role: 'PMO', date: '09/12/2025 10:00', type: 'resolucao', content: 'Projeto conclu√≠do dentro do prazo. Aceite assinado.' }
    ],
    // CDSK (Go Live)
    'CDSK_Reuni√£o de Kickoff': [
        { user: 'VINICIUS', role: 'PMO', date: '01/08/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado. Escopo CDSK definido.' }
    ],
    'CDSK_Migra√ß√£o para Produ√ß√£o': [
        { user: 'VINICIUS', role: 'PMO', date: '05/02/2026 08:00', type: 'atualizacao', content: 'Migra√ß√£o iniciada. Janela de mudan√ßa: 08:00-12:00.' },
        { user: 'VINICIUS', role: 'PMO', date: '05/02/2026 11:45', type: 'resolucao', content: 'Migra√ß√£o conclu√≠da com sucesso! Sistema operacional.' },
        { user: 'DAIANA', role: 'Gestora', date: '06/02/2026 09:00', type: 'comentario', content: 'Iniciar per√≠odo de Hypercare. Monitorar 24/7.' }
    ],
    // COUGAR (Conclu√≠do)
    'COUGAR_Reuni√£o de Kickoff': [
        { user: 'LEANDRO', role: 'PMO', date: '01/05/2025 09:30', type: 'atualizacao', content: 'Kickoff realizado. Stakeholders alinhados.' },
        { user: 'DAIANA', role: 'Gestora', date: '01/05/2025 14:00', type: 'comentario', content: 'Projeto estrat√©gico. Documentar todas as decis√µes.' }
    ],
    'COUGAR_Aceite Formal': [
        { user: 'LEANDRO', role: 'PMO', date: '09/02/2026 10:00', type: 'resolucao', content: 'Go Live realizado com sucesso!' },
        { user: 'DOUGLAS', role: 'Diretor', date: '09/02/2026 15:00', type: 'comentario', content: 'Parab√©ns pela entrega!' }
    ],
    // CRISTAL MG RETROFIT (Levantamento)
    'CRISTAL MG RETROFIT_Reuni√£o de Kickoff': [
        { user: 'GIOVANNI', role: 'PMO', date: '01/11/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado em Belo Horizonte.' }
    ],
    'CRISTAL MG RETROFIT_Documenta√ß√£o de Arquitetura': [
        { user: 'GIOVANNI', role: 'PMO', date: '01/02/2026 09:00', type: 'alerta', content: 'Escopo em revis√£o. Cliente solicitou altera√ß√µes no retrofit.' },
        { user: 'DAIANA', role: 'Gestora', date: '02/02/2026 11:00', type: 'comentario', content: 'Agendar reuni√£o para alinhar novo escopo.' }
    ],
    // DIA (Provisionamento)
    'DIA_Reuni√£o de Kickoff': [
        { user: 'ANDERSON', role: 'PMO', date: '01/09/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado. Projeto DIA iniciado.' }
    ],
    'DIA_Solicita√ß√£o de Acessos (VPN/IPs)': [
        { user: 'ANDERSON', role: 'PMO', date: '15/01/2026 10:00', type: 'alerta', content: 'ATEN√á√ÉO: Aguardando libera√ß√£o de VPN pelo cliente.' },
        { user: 'DAIANA', role: 'Gestora', date: '15/01/2026 11:30', type: 'comentario', content: 'Escalar para gerente de TI do cliente.' },
        { user: 'ANDERSON', role: 'PMO', date: '18/01/2026 09:00', type: 'atualizacao', content: 'Reuni√£o agendada com TI do cliente para 20/01.' },
        { user: 'DOUGLAS', role: 'Diretor', date: '20/01/2026 16:00', type: 'comentario', content: 'Acompanhando de perto. VPN √© cr√≠tico.' }
    ],
    // DIAMANTE (N√£o Iniciado)
    'DIAMANTE_Reuni√£o de Kickoff': [
        { user: 'F√ÅBIO', role: 'PMO', date: '15/02/2026 09:00', type: 'atualizacao', content: 'Projeto agendado para iniciar em 15/02/2026.' },
        { user: 'DAIANA', role: 'Gestora', date: '01/02/2026 10:00', type: 'comentario', content: 'Preparar documenta√ß√£o inicial. Equipe ser√° alocada em fevereiro.' }
    ],
    // ELETRO (Implanta√ß√£o)
    'ELETRO_Reuni√£o de Kickoff': [
        { user: 'GIOVANNI', role: 'PMO', date: '01/10/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado. Projeto ELETRO iniciado.' }
    ],
    'ELETRO_Instala√ß√£o F√≠sica': [
        { user: 'GIOVANNI', role: 'PMO', date: '01/02/2026 10:00', type: 'atualizacao', content: 'Implanta√ß√£o em andamento. 35% dos equipamentos instalados.' },
        { user: 'GIOVANNI', role: 'PMO', date: '03/02/2026 14:00', type: 'comentario', content: 'Pr√≥xima entrega de equipamentos prevista para 10/02.' }
    ],
    // ESPERAN√áA (Conclu√≠do)
    'ESPERAN√áA_Reuni√£o de Kickoff': [
        { user: 'VINICIUS', role: 'PMO', date: '01/04/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado em Belo Horizonte.' }
    ],
    'ESPERAN√áA_Aceite Formal': [
        { user: 'VINICIUS', role: 'PMO', date: '19/01/2026 10:00', type: 'resolucao', content: 'Projeto ESPERAN√áA conclu√≠do com sucesso!' },
        { user: 'DOUGLAS', role: 'Diretor', date: '19/01/2026 15:00', type: 'comentario', content: 'Excelente entrega. Cliente muito satisfeito.' }
    ],
    // FLOWER (Levantamento)
    'FLOWER_Reuni√£o de Kickoff': [
        { user: 'ANDERSON', role: 'PMO', date: '01/12/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado. Projeto FLOWER iniciado.' }
    ],
    'FLOWER_Levantamento T√©cnico': [
        { user: 'ANDERSON', role: 'PMO', date: '15/01/2026 10:00', type: 'atualizacao', content: 'Levantamento t√©cnico em andamento.' },
        { user: 'ANDERSON', role: 'PMO', date: '25/01/2026 14:00', type: 'comentario', content: 'Mapeamento de requisitos 60% conclu√≠do.' }
    ],
    // GAVI√ÉO (Conclu√≠do)
    'GAVI√ÉO_Reuni√£o de Kickoff': [
        { user: 'F√ÅBIO', role: 'PMO', date: '01/05/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado em Fortaleza-CE.' }
    ],
    'GAVI√ÉO_Aceite Formal': [
        { user: 'F√ÅBIO', role: 'PMO', date: '01/02/2026 10:00', type: 'resolucao', content: 'Projeto GAVI√ÉO conclu√≠do. Aceite formal assinado.' }
    ],
    // MKT CHILE (N√£o Iniciado)
    'MKT CHILE_Reuni√£o de Kickoff': [
        { user: 'ALEX', role: 'PMO', date: '01/02/2026 10:00', type: 'atualizacao', content: 'Projeto internacional agendado para junho/2026.' },
        { user: 'DAIANA', role: 'Gestora', date: '01/02/2026 14:00', type: 'comentario', content: 'Iniciar alinhamento com equipe do Chile. Aten√ß√£o ao fuso hor√°rio.' }
    ],
    // MKT PERU (N√£o Iniciado)
    'MKT PERU_Reuni√£o de Kickoff': [
        { user: 'ALEX', role: 'PMO', date: '01/02/2026 10:30', type: 'atualizacao', content: 'Projeto internacional agendado para junho/2026.' },
        { user: 'DAIANA', role: 'Gestora', date: '01/02/2026 14:30', type: 'comentario', content: 'Projeto conjunto com MKT CHILE. Compartilhar recursos.' }
    ],
    // MASTER (N√£o Iniciado)
    'MASTER_Reuni√£o de Kickoff': [
        { user: 'LEANDRO', role: 'PMO', date: '01/02/2026 09:00', type: 'atualizacao', content: 'Projeto MASTER agendado para mar√ßo/2026.' },
        { user: 'DOUGLAS', role: 'Diretor', date: '01/02/2026 11:00', type: 'comentario', content: 'Projeto estrat√©gico. Garantir recursos dedicados.' }
    ],
    // NAVEPARK (Provisionamento)
    'NAVEPARK_Reuni√£o de Kickoff': [
        { user: 'ANDERSON', role: 'PMO', date: '01/09/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado em Curitiba. Equipe mobilizada.' }
    ],
    'NAVEPARK_Solicita√ß√£o de Acessos (VPN/IPs)': [
        { user: 'ANDERSON', role: 'PMO', date: '20/01/2026 09:00', type: 'comentario', content: 'Aguardando sinal do datacenter local.' },
        { user: 'ANDERSON', role: 'PMO', date: '25/01/2026 14:00', type: 'atualizacao', content: 'Sinal recebido. Configura√ß√£o de acessos em andamento.' }
    ],
    // OCTOPUS MS (Implanta√ß√£o)
    'OCTOPUS MS_Reuni√£o de Kickoff': [
        { user: 'ALEX', role: 'PMO', date: '01/10/2025 09:30', type: 'atualizacao', content: 'Kickoff realizado em Campo Grande-MS.' },
        { user: 'DAIANA', role: 'Gestora', date: '01/10/2025 14:15', type: 'comentario', content: 'Projeto regional. Aten√ß√£o √† log√≠stica.' }
    ],
    'OCTOPUS MS_Instala√ß√£o F√≠sica': [
        { user: 'ALEX', role: 'PMO', date: '15/01/2026 10:00', type: 'atualizacao', content: 'Implanta√ß√£o iniciada. Equipamentos em instala√ß√£o.' }
    ],
    // OCTOPUS SC (Conclu√≠do)
    'OCTOPUS SC_Reuni√£o de Kickoff': [
        { user: 'ALEX', role: 'PMO', date: '01/06/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado em Florian√≥polis-SC.' }
    ],
    'OCTOPUS SC_Aceite Formal': [
        { user: 'ALEX', role: 'PMO', date: '15/12/2025 10:00', type: 'resolucao', content: 'Projeto OCTOPUS SC conclu√≠do com sucesso!' }
    ],
    // OPTIMUS PRIME (Conclu√≠do)
    'OPTIMUS PRIME_Reuni√£o de Kickoff': [
        { user: 'GIOVANNI', role: 'PMO', date: '01/04/2025 09:00', type: 'atualizacao', content: 'Kickoff do projeto OPTIMUS PRIME realizado.' }
    ],
    'OPTIMUS PRIME_Aceite Formal': [
        { user: 'GIOVANNI', role: 'PMO', date: '27/10/2025 10:00', type: 'resolucao', content: 'Projeto conclu√≠do antes do prazo!' },
        { user: 'DOUGLAS', role: 'Diretor', date: '27/10/2025 14:00', type: 'comentario', content: 'Excelente performance da equipe!' }
    ],
    // PBL GUATEMALA (Homologa√ß√£o)
    'PBL GUATEMALA_Reuni√£o de Kickoff': [
        { user: 'F√ÅBIO', role: 'PMO', date: '01/09/2025 09:00', type: 'atualizacao', content: 'Kickoff internacional via videoconfer√™ncia.' },
        { user: 'DAIANA', role: 'Gestora', date: '01/09/2025 14:00', type: 'comentario', content: 'Aten√ß√£o ao fuso hor√°rio. Reuni√µes √†s 10h (hor√°rio local).' }
    ],
    'PBL GUATEMALA_Testes Funcionais': [
        { user: 'F√ÅBIO', role: 'PMO', date: '25/01/2026 10:00', type: 'atualizacao', content: 'Testes funcionais iniciados. 40% dos cen√°rios executados.' },
        { user: 'F√ÅBIO', role: 'PMO', date: '28/01/2026 15:30', type: 'alerta', content: 'Bug cr√≠tico identificado na integra√ß√£o com ERP local.' },
        { user: 'DAIANA', role: 'Gestora', date: '29/01/2026 09:00', type: 'comentario', content: 'Priorizar corre√ß√£o. Qual impacto no cronograma?' },
        { user: 'F√ÅBIO', role: 'PMO', date: '30/01/2026 11:00', type: 'resolucao', content: 'Bug corrigido. Cronograma mantido.' }
    ],
    // PROMO B2B CD GRU (Conclu√≠do)
    'PROMO B2B CD GRU_Reuni√£o de Kickoff': [
        { user: 'LEANDRO', role: 'PMO', date: '01/07/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado em Guarulhos.' }
    ],
    'PROMO B2B CD GRU_Aceite Formal': [
        { user: 'LEANDRO', role: 'PMO', date: '04/02/2026 10:00', type: 'resolucao', content: 'Projeto CD GRU conclu√≠do. Centro de distribui√ß√£o operacional.' }
    ],
    // PTL SP (Conclu√≠do)
    'PTL SP_Reuni√£o de Kickoff': [
        { user: 'VINICIUS', role: 'PMO', date: '01/04/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado. Projeto PTL SP iniciado.' }
    ],
    'PTL SP_Aceite Formal': [
        { user: 'VINICIUS', role: 'PMO', date: '30/10/2025 10:00', type: 'resolucao', content: 'Projeto conclu√≠do com sucesso.' }
    ],
    // REISADO (Conclu√≠do)
    'REISADO_Reuni√£o de Kickoff': [
        { user: 'F√ÅBIO', role: 'PMO', date: '01/06/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado em Recife-PE.' }
    ],
    'REISADO_Aceite Formal': [
        { user: 'F√ÅBIO', role: 'PMO', date: '20/12/2025 10:00', type: 'resolucao', content: 'Projeto REISADO conclu√≠do. Entrega antes do Natal!' }
    ],
    // REVERSE (Homologa√ß√£o)
    'REVERSE_Reuni√£o de Kickoff': [
        { user: 'ALEX', role: 'PMO', date: '01/09/2025 09:00', type: 'atualizacao', content: 'Kickoff do projeto REVERSE realizado.' }
    ],
    'REVERSE_Testes Funcionais': [
        { user: 'ALEX', role: 'PMO', date: '28/01/2026 14:00', type: 'atualizacao', content: 'Testes funcionais iniciados. Cobertura: 45%.' },
        { user: 'ALEX', role: 'PMO', date: '01/02/2026 16:00', type: 'atualizacao', content: 'Cobertura de testes em 78%. Bugs menores corrigidos.' },
        { user: 'DAIANA', role: 'Gestora', date: '02/02/2026 10:00', type: 'comentario', content: 'Agendar homologa√ß√£o com cliente para pr√≥xima semana.' }
    ],
    // SUPER DIVINOPOLIS (Implanta√ß√£o)
    'SUPER DIVINOPOLIS_Reuni√£o de Kickoff': [
        { user: 'GIOVANNI', role: 'PMO', date: '01/10/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado em Divin√≥polis-MG.' }
    ],
    'SUPER DIVINOPOLIS_Configura√ß√£o de Rede': [
        { user: 'GIOVANNI', role: 'PMO', date: '01/02/2026 10:00', type: 'atualizacao', content: 'Implanta√ß√£o em 50%. Progresso conforme planejado.' },
        { user: 'GIOVANNI', role: 'PMO', date: '03/02/2026 14:00', type: 'comentario', content: 'Equipe local bem treinada. Sem impedimentos.' }
    ],
    // TITANIO (Hypercare)
    'TITANIO_Reuni√£o de Kickoff': [
        { user: 'ALEX', role: 'PMO', date: '01/07/2025 09:00', type: 'atualizacao', content: 'Kickoff do projeto TITANIO realizado.' }
    ],
    'TITANIO_Monitoramento Intensivo': [
        { user: 'ALEX', role: 'PMO', date: '01/02/2026 14:00', type: 'atualizacao', content: 'Hypercare iniciado. Monitoramento 24/7 ativo.' },
        { user: 'ALEX', role: 'PMO', date: '02/02/2026 09:00', type: 'comentario', content: 'Nenhum incidente nas primeiras 24h. Sistema est√°vel.' },
        { user: 'DAIANA', role: 'Gestora', date: '02/02/2026 15:00', type: 'comentario', content: 'Manter monitoramento. Preparar documenta√ß√£o de encerramento.' }
    ]
};

function getTipoLabel(type) {
    const labels = { 'comentario': 'üí¨ Coment√°rio', 'atualizacao': 'üìù Atualiza√ß√£o', 'alerta': '‚ö†Ô∏è Alerta', 'resolucao': '‚úÖ Resolu√ß√£o' };
    return labels[type] || type;
}

// Modal Atividade
function abrirAtividade(proj,nomeAtiv){
    const a=ATIVIDADES.find(x=>x.proj===proj&&x.nome===nomeAtiv);
    if(!a)return;
    
    // Buscar tratativas desta atividade
    const key = proj + '_' + nomeAtiv;
    const tratativas = TRATATIVAS[key] || [];
    
    let tratativasHtml = '';
    if (tratativas.length === 0) {
        tratativasHtml = '<div class="activity-history-empty">Nenhuma tratativa registrada ainda.<br><small>Em vers√µes futuras, aqui aparecer√£o todas as atualiza√ß√µes e coment√°rios desta atividade.</small></div>';
    } else {
        tratativasHtml = tratativas.map(t => `
            <div class="tratativa-item">
                <div class="tratativa-header">
                    <div class="tratativa-user">
                        <div class="tratativa-avatar">${t.user.charAt(0)}</div>
                        <div class="tratativa-info">
                            <span class="tratativa-name">${t.user}</span>
                            <span class="tratativa-role">${t.role}</span>
                        </div>
                    </div>
                    <span class="tratativa-date">${t.date}</span>
                </div>
                <span class="tratativa-type ${t.type}">${getTipoLabel(t.type)}</span>
                <div class="tratativa-content">${t.content}</div>
            </div>
        `).join('');
    }
    
    document.getElementById('activityModalTitle').textContent=`üìå ${a.nome}`;
    document.getElementById('activityModalBody').innerHTML=`
        <div class="activity-detail">
            <div class="activity-detail-row"><span class="activity-detail-label">Projeto</span><span class="activity-detail-value">${a.proj}</span></div>
            <div class="activity-detail-row"><span class="activity-detail-label">Fase</span><span class="activity-detail-value">${a.fase}</span></div>
            <div class="activity-detail-row"><span class="activity-detail-label">Respons√°vel</span><span class="activity-detail-value">${a.resp}</span></div>
            <div class="activity-detail-row"><span class="activity-detail-label">Data In√≠cio</span><span class="activity-detail-value">${formatDate(a.dataInicio)}</span></div>
            <div class="activity-detail-row"><span class="activity-detail-label">Data T√©rmino</span><span class="activity-detail-value">${formatDate(a.dataFim)}</span></div>
            <div class="activity-detail-row"><span class="activity-detail-label">Status</span><span class="activity-detail-value"><span class="status-badge ${getStatusClass(a.status)}">${a.status}</span></span></div>
            <div class="activity-detail-row"><span class="activity-detail-label">Descri√ß√£o</span><span class="activity-detail-value">${a.descricao||'-'}</span></div>
        </div>
        <div class="activity-history">
            <h4>üìù Hist√≥rico de Tratativas</h4>
            ${tratativasHtml}
        </div>
    `;
    document.getElementById('activityModal').classList.add('show');
}
function fecharActivityModal(e){if(!e||e.target.id==='activityModal')document.getElementById('activityModal').classList.remove('show')}

// Imprimir Projeto Individual
function imprimirProjeto(){
    const p=PROJETOS.find(x=>x.nome===projetoAtual);
    if(!p)return;
    const a=getAtividades(projetoAtual),pg=calcProgresso(projetoAtual),fa=calcFaseAtual(projetoAtual),st=calcStatus(projetoAtual),at=diasAtraso(p.dataPrevista);
    const w=window.open('','_blank');
    w.document.write(`<!DOCTYPE html><html><head><title>${projetoAtual}</title><style>body{font-family:Segoe UI,sans-serif;padding:30px;max-width:800px;margin:0 auto}h1{color:#667eea;border-bottom:3px solid #667eea;padding-bottom:10px}table{width:100%;border-collapse:collapse;margin:15px 0}th,td{border:1px solid #e2e8f0;padding:10px;text-align:left}th{background:#f8fafc}.info{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:15px 0}.info-item{padding:10px;background:#f8fafc;border-radius:6px}.info-label{color:#64748b;font-size:0.85em}.info-value{font-weight:600;color:#1e293b}.status{display:inline-block;padding:4px 12px;border-radius:4px;font-size:0.85em;font-weight:600}.concluido{background:#dcfce7;color:#166534}.em-andamento{background:#dbeafe;color:#1e40af}.aguardando{background:#fef3c7;color:#92400e}.nao-iniciado{background:#f3f4f6;color:#4b5563}@media print{body{padding:15px}}</style></head><body>
    <h1>üìã ${projetoAtual}</h1>
    <div class="info">
        <div class="info-item"><div class="info-label">Local</div><div class="info-value">${p.local}</div></div>
        <div class="info-item"><div class="info-label">Respons√°vel</div><div class="info-value">${p.resp}</div></div>
        <div class="info-item"><div class="info-label">Prioridade</div><div class="info-value">${p.prioridade}</div></div>
        <div class="info-item"><div class="info-label">Fase Atual</div><div class="info-value">${fa}</div></div>
        <div class="info-item"><div class="info-label">In√≠cio</div><div class="info-value">${formatDate(p.dataInicio)}</div></div>
        <div class="info-item"><div class="info-label">T√©rmino Previsto</div><div class="info-value">${formatDate(p.dataPrevista)}</div></div>
        <div class="info-item"><div class="info-label">Progresso</div><div class="info-value">${pg}%</div></div>
        <div class="info-item"><div class="info-label">Status</div><div class="info-value"><span class="status ${getStatusClass(st)}">${st}</span></div></div>
        ${at>0&&pg<100?`<div class="info-item"><div class="info-label">Atraso</div><div class="info-value" style="color:#dc2626">‚ö†Ô∏è ${at} dias</div></div>`:''}
    </div>
    <h2>Atividades</h2>
    <table><thead><tr><th>Atividade</th><th>Fase</th><th>Respons√°vel</th><th>In√≠cio</th><th>T√©rmino</th><th>Status</th></tr></thead><tbody>
    ${a.map(x=>`<tr><td>${x.nome}</td><td>${x.fase}</td><td>${x.resp}</td><td>${formatDate(x.dataInicio)}</td><td>${formatDate(x.dataFim)}</td><td><span class="status ${getStatusClass(x.status)}">${x.status}</span></td></tr>`).join('')}
    </tbody></table>
    <p style="color:#94a3b8;text-align:center;margin-top:20px;font-size:0.85em">Gerado em ${new Date().toLocaleString('pt-BR')}</p>
    </body></html>`);
    w.document.close();
    setTimeout(()=>w.print(),300);
}

// Modal Impress√£o/PDF
function abrirPrintModal(mode){
    printMode=mode;
    document.getElementById('printModalTitle').textContent=mode==='pdf'?'üìÑ Gerar PDF':'üñ®Ô∏è Imprimir';
    document.getElementById('btnExecutePrint').textContent=mode==='pdf'?'üìÑ Gerar PDF':'üñ®Ô∏è Imprimir';
    document.getElementById('printProjectsList').innerHTML=PROJETOS.map(p=>`<label class="print-project-item"><input type="checkbox" value="${p.nome}" checked> ${p.nome}</label>`).join('');
    document.getElementById('printModal').classList.add('show');
}
function fecharPrintModal(e){if(!e||e.target.id==='printModal')document.getElementById('printModal').classList.remove('show')}

function selecionarOpcao(el,tipo){
    document.querySelectorAll('.print-option').forEach(o=>o.classList.remove('selected'));
    el.classList.add('selected');
    el.querySelector('input').checked=true;
    document.getElementById('printProjectsList').classList.toggle('show',tipo==='especificos');
    document.getElementById('printSelectButtons').style.display=tipo==='especificos'?'flex':'none';
}

function executarPrint(){
    const tipo=document.querySelector('input[name="printType"]:checked').value;
    let projetos=[];
    if(tipo==='atual'){projetos=getProjetosFiltrados()}
    else if(tipo==='todos'){projetos=PROJETOS}
    else if(tipo==='criticos'){projetos=PROJETOS.filter(p=>isCritico(p.nome))}
    else if(tipo==='especificos'){const checks=document.querySelectorAll('#printProjectsList input:checked');projetos=PROJETOS.filter(p=>[...checks].some(c=>c.value===p.nome))}
    
    if(!projetos.length){alert('Nenhum projeto selecionado!');return}
    fecharPrintModal();
    
    if(printMode==='pdf'){gerarPDF(projetos)}
    else{imprimirLista(projetos)}
}

function marcarTodos(marcar){
    document.querySelectorAll('#printProjectsList input[type="checkbox"]').forEach(cb=>cb.checked=marcar);
}

// Corrigir filtro ao digitar
document.addEventListener('DOMContentLoaded',function(){
    document.getElementById('search').addEventListener('input',function(){
        if(this.value.trim()===''){projetoFiltro=''}
        render();
    });
});

function imprimirLista(projetos){
    const w=window.open('','_blank');
    w.document.write(`<!DOCTYPE html><html><head><title>Projetos Infraestrutura</title><style>body{font-family:Segoe UI,sans-serif;padding:30px;max-width:1000px;margin:0 auto}h1{color:#667eea;text-align:center;border-bottom:3px solid #667eea;padding-bottom:15px}.kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin:20px 0}.kpi{text-align:center;padding:15px;background:#f8fafc;border-radius:8px;border-top:4px solid #e2e8f0}.kpi.verde{border-top-color:#22c55e}.kpi.amarelo{border-top-color:#f59e0b}.kpi.vermelho{border-top-color:#ef4444}.kpi.azul{border-top-color:#3b82f6}.kpi-num{font-size:1.8em;font-weight:700}.kpi-lbl{font-size:0.85em;color:#64748b}.project{border:1px solid #e2e8f0;border-radius:8px;padding:15px;margin:15px 0;page-break-inside:avoid}.project-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.project-name{font-size:1.1em;font-weight:700}.priority{padding:3px 8px;border-radius:4px;font-size:0.75em;font-weight:600}.alta{background:#fee2e2;color:#dc2626}.media{background:#fef3c7;color:#d97706}.baixa{background:#dcfce7;color:#16a34a}.project-info{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;font-size:0.9em;color:#64748b}.progress-bar{height:8px;background:#e2e8f0;border-radius:4px;margin:10px 0;overflow:hidden}.progress-fill{height:100%;border-radius:4px}.verde{background:#22c55e}.amarelo{background:#f59e0b}.vermelho{background:#ef4444}@media print{body{padding:15px}.kpis{grid-template-columns:repeat(5,1fr)}}</style></head><body>
    <h1>üìä Dashboard de Infraestrutura</h1>
    <div class="kpis">
        <div class="kpi azul"><div class="kpi-num">${projetos.length}</div><div class="kpi-lbl">Total</div></div>
        <div class="kpi verde"><div class="kpi-num">${projetos.filter(p=>calcStatus(p.nome)==='Conclu√≠do').length}</div><div class="kpi-lbl">Conclu√≠dos</div></div>
        <div class="kpi amarelo"><div class="kpi-num">${projetos.filter(p=>calcStatus(p.nome)==='Em andamento').length}</div><div class="kpi-lbl">Em Andamento</div></div>
        <div class="kpi vermelho"><div class="kpi-num">${projetos.filter(p=>calcStatus(p.nome)==='Atrasado').length}</div><div class="kpi-lbl">Atrasados</div></div>
        <div class="kpi vermelho"><div class="kpi-num">${projetos.filter(p=>isCritico(p.nome)).length}</div><div class="kpi-lbl">Cr√≠ticos</div></div>
    </div>
    ${projetos.map(p=>{const pg=calcProgresso(p.nome),st=calcStatus(p.nome),fa=calcFaseAtual(p.nome),at=diasAtraso(p.dataPrevista),cor=getCor(pg);return`
    <div class="project">
        <div class="project-header"><span class="project-name">${p.nome}</span><span class="priority ${p.prioridade.toLowerCase()}">${p.prioridade}</span></div>
        <div class="project-info"><span>üìç ${p.local}</span><span>üë§ ${p.resp}</span><span>üìò ${fa}</span><span>üìÖ In√≠cio: ${formatDate(p.dataInicio)}</span><span>üéØ T√©rmino: ${formatDate(p.dataPrevista)}</span><span>üìä Status: ${st}${at>0&&pg<100?` (${at}d atraso)`:''}</span></div>
        <div class="progress-bar"><div class="progress-fill ${cor}" style="width:${pg}%"></div></div>
        <div style="text-align:right;font-weight:600">${pg}%</div>
    </div>`}).join('')}
    <p style="color:#94a3b8;text-align:center;margin-top:30px;font-size:0.85em">Gerado em ${new Date().toLocaleString('pt-BR')}</p>
    </body></html>`);
    w.document.close();
    setTimeout(()=>w.print(),300);
}

function gerarPDF(projetos){
    const content=document.createElement('div');
    content.innerHTML=`<div style="font-family:Segoe UI,sans-serif;padding:20px;max-width:900px">
    <h1 style="color:#667eea;text-align:center;border-bottom:3px solid #667eea;padding-bottom:15px">üìä Dashboard de Infraestrutura</h1>
    <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin:20px 0">
        <div style="text-align:center;padding:15px;background:#f8fafc;border-radius:8px;border-top:4px solid #3b82f6"><div style="font-size:1.8em;font-weight:700">${projetos.length}</div><div style="font-size:0.85em;color:#64748b">Total</div></div>
        <div style="text-align:center;padding:15px;background:#f8fafc;border-radius:8px;border-top:4px solid #22c55e"><div style="font-size:1.8em;font-weight:700">${projetos.filter(p=>calcStatus(p.nome)==='Conclu√≠do').length}</div><div style="font-size:0.85em;color:#64748b">Conclu√≠dos</div></div>
        <div style="text-align:center;padding:15px;background:#f8fafc;border-radius:8px;border-top:4px solid #f59e0b"><div style="font-size:1.8em;font-weight:700">${projetos.filter(p=>calcStatus(p.nome)==='Em andamento').length}</div><div style="font-size:0.85em;color:#64748b">Em Andamento</div></div>
        <div style="text-align:center;padding:15px;background:#f8fafc;border-radius:8px;border-top:4px solid #ef4444"><div style="font-size:1.8em;font-weight:700">${projetos.filter(p=>calcStatus(p.nome)==='Atrasado').length}</div><div style="font-size:0.85em;color:#64748b">Atrasados</div></div>
        <div style="text-align:center;padding:15px;background:#f8fafc;border-radius:8px;border-top:4px solid #ef4444"><div style="font-size:1.8em;font-weight:700">${projetos.filter(p=>isCritico(p.nome)).length}</div><div style="font-size:0.85em;color:#64748b">Cr√≠ticos</div></div>
    </div>
    ${projetos.map(p=>{const pg=calcProgresso(p.nome),st=calcStatus(p.nome),fa=calcFaseAtual(p.nome),at=diasAtraso(p.dataPrevista),cor=pg>=100?'#22c55e':pg>=50?'#f59e0b':'#ef4444';return`
    <div style="border:1px solid #e2e8f0;border-radius:8px;padding:15px;margin:15px 0">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px"><span style="font-size:1.1em;font-weight:700">${p.nome}</span><span style="padding:3px 8px;border-radius:4px;font-size:0.75em;font-weight:600;background:${p.prioridade==='Alta'?'#fee2e2':p.prioridade==='M√©dia'?'#fef3c7':'#dcfce7'};color:${p.prioridade==='Alta'?'#dc2626':p.prioridade==='M√©dia'?'#d97706':'#16a34a'}">${p.prioridade}</span></div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;font-size:0.9em;color:#64748b"><span>üìç ${p.local}</span><span>üë§ ${p.resp}</span><span>üìò ${fa}</span><span>üìÖ In√≠cio: ${formatDate(p.dataInicio)}</span><span>üéØ T√©rmino: ${formatDate(p.dataPrevista)}</span><span>üìä ${st}${at>0&&pg<100?` (${at}d atraso)`:''}</span></div>
        <div style="height:8px;background:#e2e8f0;border-radius:4px;margin:10px 0;overflow:hidden"><div style="height:100%;width:${pg}%;background:${cor};border-radius:4px"></div></div>
        <div style="text-align:right;font-weight:600">${pg}%</div>
    </div>`}).join('')}
    <p style="color:#94a3b8;text-align:center;margin-top:30px;font-size:0.85em">Gerado em ${new Date().toLocaleString('pt-BR')}</p>
    </div>`;
    
    html2pdf().set({margin:10,filename:'projetos-infraestrutura.pdf',image:{type:'jpeg',quality:0.98},html2canvas:{scale:2},jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}}).from(content).save();
}

document.addEventListener('keydown',e=>{if(e.key==='Escape'){fecharModal();fecharPrintModal();fecharActivityModal()}});
window.addEventListener('DOMContentLoaded',()=>{localStorage.removeItem('infraDashboard');populateFilters();render()});
</script>
</body>
</html>
