<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status dos Projetos - Infraestrutura</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .container { max-width: 950px; width: 100%; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: white; font-size: 36px; margin-bottom: 10px; text-shadow: 0 4px 20px rgba(0,0,0,0.3); }
        .header p { color: rgba(255,255,255,0.7); font-size: 16px; }
        .info-bar {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .info-item { text-align: center; }
        .info-item .number { font-size: 28px; font-weight: 700; color: white; }
        .info-item .label { font-size: 11px; color: rgba(255,255,255,0.6); text-transform: uppercase; letter-spacing: 1px; }
        .info-item.total .number { color: #a78bfa; }
        .info-item.concluido .number { color: #34d399; }
        .info-item.andamento .number { color: #60a5fa; }
        .info-item.critico .number { color: #f87171; }
        .update-info { text-align: right; }
        .update-info .date { color: white; font-size: 14px; font-weight: 600; }
        .update-info .time-ago { color: rgba(255,255,255,0.5); font-size: 12px; }
        .alert-box {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border: 2px solid #fca5a5;
            border-radius: 16px;
            padding: 20px 25px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            animation: pulse 2s infinite;
        }
        .alert-box.success {
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
            border-color: #6ee7b7;
            animation: none;
        }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.01); } }
        .alert-icon { font-size: 40px; }
        .alert-content h3 { color: #991b1b; font-size: 16px; margin-bottom: 5px; }
        .alert-box.success .alert-content h3 { color: #065f46; }
        .alert-content p { color: #7f1d1d; font-size: 13px; }
        .alert-box.success .alert-content p { color: #047857; }
        .alert-badges { display: flex; gap: 10px; margin-left: auto; }
        .alert-badge { padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 6px; }
        .alert-badge.atrasado { background: #fee2e2; color: #991b1b; }
        .alert-badge.bloqueado { background: #fef3c7; color: #92400e; }
        .cards-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; }
        .card {
            background: rgba(255,255,255,0.95);
            border-radius: 24px;
            padding: 40px 30px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            transition: all 0.4s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 6px; }
        .card.simples::before { background: linear-gradient(90deg, #667eea, #764ba2); }
        .card.detalhada::before { background: linear-gradient(90deg, #10b981, #059669); }
        .card:hover { transform: translateY(-10px); box-shadow: 0 30px 80px rgba(0,0,0,0.4); }
        .card-icon { width: 80px; height: 80px; border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 36px; margin: 0 auto 25px; }
        .card.simples .card-icon { background: linear-gradient(135deg, #667eea, #764ba2); }
        .card.detalhada .card-icon { background: linear-gradient(135deg, #10b981, #059669); }
        .card h2 { color: #1a1a2e; font-size: 24px; margin-bottom: 15px; }
        .card p { color: #64748b; font-size: 14px; line-height: 1.7; margin-bottom: 25px; }
        .card ul { text-align: left; list-style: none; margin-bottom: 30px; }
        .card ul li { padding: 8px 0; color: #475569; font-size: 13px; display: flex; align-items: center; gap: 10px; }
        .card ul li::before { content: '‚úì'; display: inline-flex; align-items: center; justify-content: center; width: 20px; height: 20px; border-radius: 50%; font-size: 11px; font-weight: bold; }
        .card.simples ul li::before { background: #ede9fe; color: #7c3aed; }
        .card.detalhada ul li::before { background: #d1fae5; color: #059669; }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 14px 32px; border-radius: 12px; font-size: 15px; font-weight: 600; text-decoration: none; color: white; transition: all 0.3s ease; width: 100%; }
        .card.simples .btn { background: linear-gradient(135deg, #667eea, #764ba2); }
        .card.detalhada .btn { background: linear-gradient(135deg, #10b981, #059669); }
        .badge { position: absolute; top: 20px; right: 20px; padding: 6px 14px; border-radius: 20px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .card.simples .badge { background: #ede9fe; color: #7c3aed; }
        .card.detalhada .badge { background: #d1fae5; color: #059669; }
        .footer { text-align: center; margin-top: 40px; color: rgba(255,255,255,0.5); font-size: 13px; }
        .footer a { color: rgba(255,255,255,0.7); text-decoration: none; }
        .hidden { display: none; }
        @media (max-width: 768px) {
            .header h1 { font-size: 28px; }
            .cards-container { grid-template-columns: 1fr; }
            .info-bar { flex-direction: column; text-align: center; }
            .alert-box { flex-direction: column; text-align: center; }
            .alert-badges { margin-left: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Status dos Projetos - Infraestrutura</h1>
            <p>Selecione o tipo de visualiza√ß√£o desejada</p>
        </div>
        <div id="infoBar" class="info-bar">
            <div class="info-item total"><div class="number" id="totalCount">-</div><div class="label">Projetos</div></div>
            <div class="info-item concluido"><div class="number" id="concluidoCount">-</div><div class="label">Conclu√≠dos</div></div>
            <div class="info-item andamento"><div class="number" id="andamentoCount">-</div><div class="label">Em Andamento</div></div>
            <div class="info-item critico"><div class="number" id="criticoCount">-</div><div class="label">Cr√≠ticos</div></div>
            <div class="update-info"><div class="date" id="updateDate">Carregando...</div><div class="time-ago" id="timeAgo"></div></div>
        </div>
        <div id="alertBox" class="alert-box hidden">
            <div class="alert-icon" id="alertIcon">‚ö†Ô∏è</div>
            <div class="alert-content">
                <h3 id="alertTitle">Projetos requerem aten√ß√£o!</h3>
                <p id="alertText">Existem projetos atrasados ou bloqueados.</p>
            </div>
            <div class="alert-badges" id="alertBadges">
                <span class="alert-badge atrasado" id="badgeAtrasados">üî¥ <span id="atrasadosNum">0</span> atrasados</span>
                <span class="alert-badge bloqueado" id="badgeBloqueados">üü° <span id="bloqueadosNum">0</span> bloqueados</span>
            </div>
        </div>
        <div class="cards-container">
            <div class="card simples" onclick="window.location.href='view-simples.html'">
                <span class="badge">Resumida</span>
                <div class="card-icon">üìã</div>
                <h2>Vis√£o Resumida</h2>
                <p>Dashboard consolidado com vis√£o geral.</p>
                <ul>
                    <li>Cards com totais por status</li>
                    <li>Gr√°ficos de distribui√ß√£o</li>
                    <li>Tabela √∫nica consolidada</li>
                    <li>Filtros e ordena√ß√£o</li>
                </ul>
                <a href="view-simples.html" class="btn">Acessar ‚Üí</a>
            </div>
            <div class="card detalhada" onclick="window.location.href='view-detalhada.html'">
                <span class="badge">Completa</span>
                <div class="card-icon">üìà</div>
                <h2>Vis√£o Detalhada</h2>
                <p>Dashboard segmentado por status.</p>
                <ul>
                    <li>Se√ß√µes por status</li>
                    <li>Timeline de Go Lives</li>
                    <li>Indicadores RAG</li>
                    <li>Detalhes completos</li>
                </ul>
                <a href="view-detalhada.html" class="btn">Acessar ‚Üí</a>
            </div>
        </div>
        <div class="footer"><p>Infraestrutura TI ‚Ä¢ <a href="admin.html">√Årea Administrativa</a></p></div>
    </div>
    <script>
        function normalizeStatus(status) {
            if (!status) return 'N√£o Definido';
            const s = status.toLowerCase().trim();
            if (s.includes('conclu')) return 'Conclu√≠do';
            if (s.includes('andamento')) return 'Em Andamento';
            if (s.includes('atras')) return 'Atrasado';
            if (s.includes('aguard')) return 'Aguardando Cliente';
            if (s.includes('n√£o') || s.includes('nao')) return 'N√£o Iniciado';
            return status;
        }
        async function loadData() {
            try {
                const response = await fetch('dados.json?t=' + Date.now());
                if (!response.ok) throw new Error('N√£o encontrado');
                const data = await response.json();
                if (data.projects && data.projects.length > 0) {
                    const p = data.projects;
                    document.getElementById('totalCount').textContent = p.length;
                    document.getElementById('concluidoCount').textContent = p.filter(x => normalizeStatus(x.status) === 'Conclu√≠do').length;
                    document.getElementById('andamentoCount').textContent = p.filter(x => normalizeStatus(x.status) === 'Em Andamento').length;
                    const atrasados = p.filter(x => normalizeStatus(x.status) === 'Atrasado').length;
                    const bloqueados = p.filter(x => x.bloqueador && x.bloqueador !== '-' && x.bloqueador.trim() !== '').length;
                    const criticos = p.filter(x => normalizeStatus(x.status) === 'Atrasado' || (x.rag && x.rag.toLowerCase() === 'vermelho')).length;
                    document.getElementById('criticoCount').textContent = criticos;
                    if (data.lastUpdate) {
                        const d = new Date(data.lastUpdate);
                        document.getElementById('updateDate').textContent = d.toLocaleDateString('pt-BR', {day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'});
                        const diff = Math.floor((new Date() - d) / (1000*60*60*24));
                        document.getElementById('timeAgo').textContent = diff > 0 ? `h√° ${diff} dia(s)` : 'hoje';
                    }
                    const alertBox = document.getElementById('alertBox');
                    alertBox.classList.remove('hidden');
                    if (criticos > 0) {
                        document.getElementById('atrasadosNum').textContent = atrasados;
                        document.getElementById('bloqueadosNum').textContent = bloqueados;
                        if (atrasados === 0) document.getElementById('badgeAtrasados').style.display = 'none';
                        if (bloqueados === 0) document.getElementById('badgeBloqueados').style.display = 'none';
                    } else {
                        alertBox.classList.add('success');
                        document.getElementById('alertIcon').textContent = '‚úÖ';
                        document.getElementById('alertTitle').textContent = 'Tudo em ordem!';
                        document.getElementById('alertText').textContent = 'Nenhum projeto cr√≠tico.';
                        document.getElementById('alertBadges').style.display = 'none';
                    }
                }
            } catch(e) { document.getElementById('updateDate').textContent = 'Dados n√£o dispon√≠veis'; }
        }
        window.addEventListener('load', loadData);
    </script>
</body>
</html>
