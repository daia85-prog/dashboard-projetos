<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vis√£o Detalhada - Infraestrutura v6.1.1</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 20px; min-height: 100vh; }
        .container { max-width: 1600px; margin: 0 auto; }
        .header { background: rgba(255,255,255,0.95); padding: 25px 30px; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); margin-bottom: 25px; }
        .header-top { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .header h1 { font-size: 1.8rem; color: #1a1a2e; display: flex; align-items: center; gap: 12px; }
        .header h1 span { font-size: 2rem; }
        .version { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
        .update-info { font-size: 0.85rem; color: #64748b; margin-top: 5px; }
        .header-actions { display: flex; gap: 10px; flex-wrap: wrap; }
        .btn { padding: 10px 20px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: all 0.3s; display: flex; align-items: center; gap: 8px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }

        /* Status Cards */
        .status-cards { display: grid; grid-template-columns: repeat(7, 1fr); gap: 12px; margin: 20px 0 25px 0; }
        .status-card { background: white; border-radius: 12px; padding: 20px 15px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
        .status-card:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
        .status-card.active { border-color: #667eea; }
        .status-card .number { font-size: 2.5rem; font-weight: 700; }
        .status-card .label { font-size: 0.75rem; color: #64748b; text-transform: uppercase; margin-top: 5px; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .status-card.total .number { color: #1e293b; }
        .status-card.concluido .number { color: #22c55e; }
        .status-card.andamento .number { color: #3b82f6; }
        .status-card.atrasado .number { color: #ef4444; }
        .status-card.aguardando .number { color: #f59e0b; }
        .status-card.nao-iniciado .number { color: #64748b; }
        .status-card.critico .number { color: #991b1b; }

        /* Filters */
        .filters-section { background: white; border-radius: 16px; padding: 20px 25px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .filters-grid { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr auto auto; gap: 15px; align-items: end; }
        .filter-group label { display: block; font-size: 0.8rem; color: #64748b; margin-bottom: 6px; font-weight: 500; }
        .filter-group input, .filter-group select { width: 100%; padding: 10px 14px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 0.9rem; transition: border-color 0.3s; }
        .filter-group input:focus, .filter-group select:focus { outline: none; border-color: #667eea; }
        .btn-clear { background: #64748b; padding: 10px 16px; font-size: 0.85rem; }
        .checkbox-filter { display: flex; align-items: center; gap: 8px; padding: 10px 14px; background: #fff; border: 2px solid #ef4444; border-radius: 10px; cursor: pointer; transition: all 0.3s; }
        .checkbox-filter:hover { background: #fef2f2; }
        .checkbox-filter.active { background: #fef2f2; border-color: #dc2626; }
        .checkbox-filter input { width: 18px; height: 18px; accent-color: #ef4444; }
        .checkbox-filter span { font-size: 0.85rem; font-weight: 600; color: #991b1b; white-space: nowrap; }

        /* Status Sections */
        .status-sections { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; }
        .status-section { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .section-header { padding: 15px 20px; color: white; font-weight: 600; font-size: 1rem; display: flex; justify-content: space-between; align-items: center; }
        .section-header.concluido { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .section-header.andamento { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .section-header.atrasado { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .section-header.aguardando { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .section-header.nao-iniciado { background: linear-gradient(135deg, #64748b, #475569); }
        .section-header .count { background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 15px; font-size: 0.85rem; }
        .section-content { max-height: 400px; overflow-y: auto; }
        .project-item { padding: 15px 20px; border-bottom: 1px solid #f1f5f9; cursor: pointer; transition: background 0.2s; }
        .project-item:hover { background: #f8fafc; }
        .project-item:last-child { border-bottom: none; }
        .project-name { font-weight: 600; color: #1e293b; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; }
        .project-name .rag-dot { width: 10px; height: 10px; border-radius: 50%; }
        .rag-dot.verde { background: #22c55e; }
        .rag-dot.amarelo { background: #f59e0b; }
        .rag-dot.vermelho { background: #ef4444; }
        .project-meta { display: flex; gap: 20px; flex-wrap: wrap; font-size: 0.8rem; color: #64748b; }
        .project-meta span { display: flex; align-items: center; gap: 5px; }
        .progress-mini { width: 60px; height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden; display: inline-block; vertical-align: middle; margin-right: 5px; }
        .progress-mini-fill { height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); }

        /* Modal do Projeto */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(4px); }
        .modal-overlay.active { display: flex; }
        .modal { background: white; border-radius: 20px; width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 80px rgba(0,0,0,0.3); }
        .modal-header { background: linear-gradient(135deg, #667eea, #764ba2); padding: 25px 30px; color: white; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { font-size: 1.5rem; }
        .modal-header p { opacity: 0.9; font-size: 0.9rem; margin-top: 5px; }
        .modal-header-actions { display: flex; gap: 10px; align-items: center; }
        .modal-close { background: rgba(255,255,255,0.2); border: none; color: white; width: 40px; height: 40px; border-radius: 50%; font-size: 1.5rem; cursor: pointer; transition: background 0.3s; }
        .modal-close:hover { background: rgba(255,255,255,0.3); }
        .btn-print-project { background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; padding: 10px 18px; border-radius: 10px; font-size: 0.85rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s; }
        .btn-print-project:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4); }
        .modal-body { padding: 30px; }
        .info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .info-box { background: #f8fafc; padding: 15px 20px; border-radius: 12px; }
        .info-box label { font-size: 0.75rem; color: #64748b; text-transform: uppercase; display: block; margin-bottom: 6px; }
        .info-box span { font-size: 1rem; color: #1e293b; font-weight: 500; }
        .info-box.full-width { grid-column: 1 / -1; }
        .info-box.bloqueador { background: #fef2f2; border: 1px solid #fecaca; }
        .info-box.bloqueador span { color: #991b1b; }
        .badge { padding: 5px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; display: inline-block; }
        .badge.conclu√≠do { background: #dcfce7; color: #166534; }
        .badge.em-andamento { background: #dbeafe; color: #1e40af; }
        .badge.atrasado { background: #fee2e2; color: #991b1b; }
        .badge.aguardando { background: #fef3c7; color: #92400e; }
        .badge.n√£o-iniciado { background: #f1f5f9; color: #475569; }

        /* Atividades no Modal */
        .atividades-section { margin-top: 25px; padding-top: 20px; border-top: 2px solid #e2e8f0; }
        .atividades-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .atividades-header h3 { font-size: 1.1rem; color: #1e293b; display: flex; align-items: center; gap: 10px; }
        .atividades-list { max-height: 300px; overflow-y: auto; }
        .atividade-item { display: flex; align-items: center; gap: 12px; padding: 10px 15px; border-radius: 8px; margin-bottom: 8px; }
        .atividade-item.concluida { background: #f0fdf4; border-left: 3px solid #22c55e; }
        .atividade-item.andamento { background: #eff6ff; border-left: 3px solid #3b82f6; }
        .atividade-item.pendente { background: #f8fafc; border-left: 3px solid #94a3b8; }
        .atividade-status { font-size: 1.2rem; }
        .atividade-info { flex: 1; }
        .atividade-nome { font-size: 0.9rem; font-weight: 500; color: #1e293b; }
        .atividade-data { font-size: 0.75rem; color: #64748b; margin-top: 2px; }

        /* Modal de Impress√£o/PDF */
        .print-modal { max-width: 550px; }
        .print-options { display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px; }
        .print-option { display: flex; align-items: center; gap: 15px; padding: 15px 20px; border: 2px solid #e2e8f0; border-radius: 12px; cursor: pointer; transition: all 0.3s; }
        .print-option:hover { border-color: #667eea; background: #f8fafc; }
        .print-option.selected { border-color: #667eea; background: linear-gradient(135deg, #eef2ff, #e0e7ff); }
        .print-option input { display: none; }
        .print-icon { font-size: 1.5rem; }
        .print-label { font-weight: 600; color: #1e293b; }
        .print-desc { font-size: 0.8rem; color: #64748b; margin-top: 4px; }
        .projects-select-container { margin-top: 12px; max-height: 200px; overflow-y: auto; background: white; border-radius: 8px; padding: 10px; }
        .project-search { width: 100%; padding: 10px 14px; border: 2px solid #e2e8f0; border-radius: 8px; margin-bottom: 10px; font-size: 0.9rem; }
        .project-search:focus { outline: none; border-color: #667eea; }
        .select-all-btn { display: inline-block; padding: 6px 12px; background: #667eea; color: white; border-radius: 6px; font-size: 0.8rem; cursor: pointer; margin-bottom: 10px; }
        .select-all-btn:hover { background: #5a67d8; }
        .project-checkbox { display: flex; align-items: center; gap: 10px; padding: 8px 10px; border-radius: 6px; cursor: pointer; transition: background 0.2s; }
        .project-checkbox:hover { background: #f1f5f9; }
        .project-checkbox input { width: 18px; height: 18px; accent-color: #667eea; }
        .project-checkbox span { font-size: 0.9rem; color: #1e293b; }

        /* Print Styles */
        @media print {
            body { background: white; padding: 10px; }
            .header-actions, .filters-section, .btn, .modal-overlay { display: none !important; }
            .container { max-width: 100%; }
            .status-cards { grid-template-columns: repeat(7, 1fr); }
            .status-sections { grid-template-columns: 1fr 1fr; }
        }

        @media (max-width: 1200px) {
            .filters-grid { grid-template-columns: repeat(4, 1fr); }
            .status-cards { grid-template-columns: repeat(4, 1fr); }
            .status-sections { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .filters-grid { grid-template-columns: 1fr 1fr; }
            .status-cards { grid-template-columns: repeat(2, 1fr); }
            .info-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-top">
                <div>
                    <h1><span>üìã</span> Vis√£o Detalhada - Infraestrutura <span class="version">v6.1.1</span></h1>
                    <p class="update-info">Atualizado em: <span id="lastUpdate">--</span></p>
                </div>
                <div class="header-actions">
                    <button class="btn" onclick="openPrintModal()">üñ®Ô∏è Imprimir</button>
                    <button class="btn" style="background: linear-gradient(135deg, #ef4444, #dc2626);" onclick="openPdfModal()">üìÑ Gerar PDF</button>
                    <button class="btn" style="background: linear-gradient(135deg, #10b981, #059669);" onclick="window.location.href='view-simples.html'">üìä Vis√£o Resumida</button>
                    <button class="btn" style="background: linear-gradient(135deg, #f59e0b, #d97706);" onclick="window.location.href='admin.html'">‚öôÔ∏è Admin</button>
                </div>
            </div>
        </div>

        <!-- Status Cards -->
        <div class="status-cards">
            <div class="status-card total active" onclick="filterByStatus('todos')">
                <div class="number" id="totalProjects">0</div>
                <div class="label">üìÅ Total</div>
            </div>
            <div class="status-card concluido" onclick="filterByStatus('Conclu√≠do')">
                <div class="number" id="concluidosCount">0</div>
                <div class="label">‚úÖ Conclu√≠dos</div>
            </div>
            <div class="status-card andamento" onclick="filterByStatus('Em Andamento')">
                <div class="number" id="andamentoCount">0</div>
                <div class="label">üîÑ Em Andamento</div>
            </div>
            <div class="status-card atrasado" onclick="filterByStatus('Atrasado')">
                <div class="number" id="atrasadoCount">0</div>
                <div class="label">‚è∞ Atrasados</div>
            </div>
            <div class="status-card aguardando" onclick="filterByStatus('Aguardando')">
                <div class="number" id="aguardandoCount">0</div>
                <div class="label">‚è∏Ô∏è Aguardando</div>
            </div>
            <div class="status-card nao-iniciado" onclick="filterByStatus('N√£o Iniciado')">
                <div class="number" id="naoIniciadoCount">0</div>
                <div class="label">üìã N√£o Iniciados</div>
            </div>
            <div class="status-card critico" onclick="filterByStatus('criticos')">
                <div class="number" id="criticosCount">0</div>
                <div class="label">üî¥ Cr√≠ticos</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-section">
            <div class="filters-grid">
                <div class="filter-group">
                    <label>üîç Buscar Projeto</label>
                    <input type="text" id="searchInput" placeholder="Digite o nome do projeto..." oninput="applyFilters()">
                </div>
                <div class="filter-group">
                    <label>üìä Status</label>
                    <select id="filterStatus" onchange="applyFilters()">
                        <option value="">Todos</option>
                        <option value="Conclu√≠do">Conclu√≠do</option>
                        <option value="Em Andamento">Em Andamento</option>
                        <option value="Atrasado">Atrasado</option>
                        <option value="Aguardando">Aguardando</option>
                        <option value="N√£o Iniciado">N√£o Iniciado</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>üö¶ Situa√ß√£o</label>
                    <select id="filterSituacao" onchange="applyFilters()">
                        <option value="">Todas</option>
                        <option value="Verde">Verde</option>
                        <option value="Amarelo">Amarelo</option>
                        <option value="Vermelho">Vermelho</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>üë§ PMO</label>
                    <select id="filterPmo" onchange="applyFilters()">
                        <option value="">Todos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>‚è±Ô∏è Dias Parado</label>
                    <select id="filterParado" onchange="applyFilters()">
                        <option value="">Todos</option>
                        <option value="7">7+ dias</option>
                        <option value="15">15+ dias</option>
                        <option value="30">30+ dias</option>
                        <option value="60">60+ dias</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>üìÖ Go-Live</label>
                    <select id="filterGoLive" onchange="applyFilters()">
                        <option value="">Todos</option>
                        <option value="mes">Este M√™s</option>
                        <option value="30">Pr√≥x. 30 dias</option>
                        <option value="60">Pr√≥x. 60 dias</option>
                        <option value="90">Pr√≥x. 90 dias</option>
                        <option value="atrasados">Atrasados</option>
                    </select>
                </div>
                <div class="checkbox-filter" id="criticosCheckbox" onclick="toggleCriticosFilter()">
                    <input type="checkbox" id="filterCriticos">
                    <span>üö® Apenas Cr√≠ticos</span>
                </div>
                <button class="btn btn-clear" onclick="clearFilters()">‚úï Limpar</button>
            </div>
        </div>

        <!-- Status Sections -->
        <div class="status-sections" id="statusSections"></div>
    </div>

    <!-- Modal do Projeto -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div>
                    <h2 id="modalTitle">Projeto</h2>
                    <p id="modalSubtitle">Detalhes</p>
                </div>
                <div class="modal-header-actions">
                    <button class="btn-print-project" onclick="printProject()">üñ®Ô∏è Imprimir</button>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="info-grid" id="modalInfo"></div>
                <div class="atividades-section" id="atividadesSection"></div>
            </div>
        </div>
    </div>

    <!-- Modal de Impress√£o -->
    <div class="modal-overlay" id="printModalOverlay" onclick="closePrintModal(event)">
        <div class="modal print-modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div><h2>üñ®Ô∏è Op√ß√µes de Impress√£o</h2></div>
                <button class="modal-close" onclick="closePrintModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="print-options">
                    <label class="print-option selected" onclick="selectPrintOption(this, 'current')">
                        <input type="radio" name="print" value="current" checked>
                        <span class="print-icon">üìÑ</span>
                        <div>
                            <div class="print-label">Filtro atual</div>
                            <div class="print-desc">Projetos vis√≠veis na tela</div>
                        </div>
                    </label>
                    <label class="print-option" onclick="selectPrintOption(this, 'all')">
                        <input type="radio" name="print" value="all">
                        <span class="print-icon">üìë</span>
                        <div>
                            <div class="print-label">Todos os projetos</div>
                            <div class="print-desc">Sem filtros aplicados</div>
                        </div>
                    </label>
                    <label class="print-option" onclick="selectPrintOption(this, 'criticos')">
                        <input type="radio" name="print" value="criticos">
                        <span class="print-icon">üö®</span>
                        <div>
                            <div class="print-label">Apenas cr√≠ticos</div>
                            <div class="print-desc">Atrasados, vermelhos ou parados 15+ dias</div>
                        </div>
                    </label>
                    <label class="print-option" onclick="selectPrintOption(this, 'specific')">
                        <input type="radio" name="print" value="specific">
                        <span class="print-icon">‚úÖ</span>
                        <div>
                            <div class="print-label">Projetos espec√≠ficos</div>
                            <div class="print-desc">Selecione os projetos desejados</div>
                            <div class="projects-select-container" id="printProjectsContainer" onclick="event.stopPropagation()">
                                <input type="text" class="project-search" id="printProjectSearch" placeholder="üîç Buscar projeto..." oninput="filterPrintProjectCheckboxes()">
                                <span class="select-all-btn" onclick="toggleSelectAllPrint()">Selecionar todos</span>
                                <div id="printProjectsCheckboxList"></div>
                            </div>
                        </div>
                    </label>
                </div>
                <button class="btn" style="width:100%;" onclick="executePrint()">üñ®Ô∏è Imprimir</button>
            </div>
        </div>
    </div>

    <!-- Modal de PDF -->
    <div class="modal-overlay" id="pdfModalOverlay" onclick="closePdfModal(event)">
        <div class="modal print-modal" onclick="event.stopPropagation()">
            <div class="modal-header" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                <div><h2>üìÑ Gerar PDF</h2></div>
                <button class="modal-close" onclick="closePdfModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="print-options">
                    <label class="print-option selected" onclick="selectPdfOption(this, 'current')">
                        <input type="radio" name="pdf" value="current" checked>
                        <span class="print-icon">üìÑ</span>
                        <div>
                            <div class="print-label">Filtro atual</div>
                            <div class="print-desc">Projetos vis√≠veis na tela</div>
                        </div>
                    </label>
                    <label class="print-option" onclick="selectPdfOption(this, 'all')">
                        <input type="radio" name="pdf" value="all">
                        <span class="print-icon">üìë</span>
                        <div>
                            <div class="print-label">Todos os projetos</div>
                            <div class="print-desc">Sem filtros aplicados</div>
                        </div>
                    </label>
                    <label class="print-option" onclick="selectPdfOption(this, 'criticos')">
                        <input type="radio" name="pdf" value="criticos">
                        <span class="print-icon">üö®</span>
                        <div>
                            <div class="print-label">Apenas cr√≠ticos</div>
                            <div class="print-desc">Atrasados, vermelhos ou parados 15+ dias</div>
                        </div>
                    </label>
                    <label class="print-option" onclick="selectPdfOption(this, 'specific')">
                        <input type="radio" name="pdf" value="specific">
                        <span class="print-icon">‚úÖ</span>
                        <div>
                            <div class="print-label">Projetos espec√≠ficos</div>
                            <div class="print-desc">Selecione os projetos desejados</div>
                            <div class="projects-select-container" id="pdfProjectsContainer" onclick="event.stopPropagation()">
                                <input type="text" class="project-search" id="pdfProjectSearch" placeholder="üîç Buscar projeto..." oninput="filterPdfProjectCheckboxes()">
                                <span class="select-all-btn" onclick="toggleSelectAllPdf()">Selecionar todos</span>
                                <div id="pdfProjectsCheckboxList"></div>
                            </div>
                        </div>
                    </label>
                </div>
                <button class="btn" style="width:100%; background: linear-gradient(135deg, #ef4444, #dc2626);" onclick="executePdf()">üìÑ Gerar PDF</button>
            </div>
        </div>
    </div>

    <script>
        let projects = [], filteredProjects = [], atividades = [], currentProject = null;
        let printOption = 'current', pdfOption = 'current';

        async function loadData() {
            try {
                const response = await fetch('dados.json');
                const data = await response.json();
                projects = data.projetos || [];
                atividades = data.atividades || [];
                filteredProjects = [...projects];
                updateDashboard();
                populateFilters();
                document.getElementById('lastUpdate').textContent = data.ultimaAtualizacao || new Date().toLocaleString('pt-BR');
            } catch (error) {
                console.log('Tentando localStorage...');
                const stored = localStorage.getItem('dashboardData');
                if (stored) {
                    const data = JSON.parse(stored);
                    projects = data.projetos || [];
                    atividades = data.atividades || [];
                    filteredProjects = [...projects];
                    updateDashboard();
                    populateFilters();
                    document.getElementById('lastUpdate').textContent = data.ultimaAtualizacao || '--';
                }
            }
        }

        function normalizeStatus(status) {
            if (!status) return 'N√£o Iniciado';
            const s = status.toLowerCase().trim();
            if (s.includes('conclu')) return 'Conclu√≠do';
            if (s.includes('andamento')) return 'Em Andamento';
            if (s.includes('atrasa')) return 'Atrasado';
            if (s.includes('aguard') || s.includes('cliente')) return 'Aguardando';
            return 'N√£o Iniciado';
        }

        function isCritico(p) {
            const status = normalizeStatus(p.status);
            const situacao = (p.situacao || '').toLowerCase();
            const diasParado = parseInt(p.diasParado) || 0;
            const temBloqueador = p.bloqueador && p.bloqueador !== '-' && p.bloqueador.trim() !== '';
            return status === 'Atrasado' || situacao === 'vermelho' || diasParado >= 15 || temBloqueador;
        }

        function updateDashboard() {
            const counts = { total: 0, concluido: 0, andamento: 0, atrasado: 0, aguardando: 0, naoIniciado: 0, criticos: 0 };
            
            filteredProjects.forEach(p => {
                counts.total++;
                const status = normalizeStatus(p.status);
                if (status === 'Conclu√≠do') counts.concluido++;
                else if (status === 'Em Andamento') counts.andamento++;
                else if (status === 'Atrasado') counts.atrasado++;
                else if (status === 'Aguardando') counts.aguardando++;
                else counts.naoIniciado++;
                if (isCritico(p)) counts.criticos++;
            });

            document.getElementById('totalProjects').textContent = counts.total;
            document.getElementById('concluidosCount').textContent = counts.concluido;
            document.getElementById('andamentoCount').textContent = counts.andamento;
            document.getElementById('atrasadoCount').textContent = counts.atrasado;
            document.getElementById('aguardandoCount').textContent = counts.aguardando;
            document.getElementById('naoIniciadoCount').textContent = counts.naoIniciado;
            document.getElementById('criticosCount').textContent = counts.criticos;

            renderSections();
        }

        function renderSections() {
            const sections = document.getElementById('statusSections');
            const statusGroups = {
                'Em Andamento': { icon: 'üîÑ', class: 'andamento', projects: [] },
                'Atrasado': { icon: '‚è∞', class: 'atrasado', projects: [] },
                'Aguardando': { icon: '‚è∏Ô∏è', class: 'aguardando', projects: [] },
                'N√£o Iniciado': { icon: 'üìã', class: 'nao-iniciado', projects: [] },
                'Conclu√≠do': { icon: '‚úÖ', class: 'concluido', projects: [] }
            };

            filteredProjects.forEach(p => {
                const status = normalizeStatus(p.status);
                if (statusGroups[status]) {
                    statusGroups[status].projects.push(p);
                }
            });

            sections.innerHTML = Object.entries(statusGroups)
                .filter(([_, data]) => data.projects.length > 0)
                .map(([status, data]) => `
                    <div class="status-section">
                        <div class="section-header ${data.class}">
                            <span>${data.icon} ${status}</span>
                            <span class="count">${data.projects.length}</span>
                        </div>
                        <div class="section-content">
                            ${data.projects.map(p => {
                                const originalIndex = projects.indexOf(p);
                                const progresso = parseInt(p.progresso) || 0;
                                const situacao = (p.situacao || 'verde').toLowerCase();
                                return `
                                    <div class="project-item" onclick="openModal(${originalIndex})">
                                        <div class="project-name">
                                            <span class="rag-dot ${situacao}"></span>
                                            ${p.projeto}
                                        </div>
                                        <div class="project-meta">
                                            <span>üìç ${p.localizacao || '-'}</span>
                                            <span>üë§ ${p.pmoInterno || '-'}</span>
                                            <span><div class="progress-mini"><div class="progress-mini-fill" style="width:${progresso}%"></div></div>${progresso}%</span>
                                            <span>üìÖ ${p.goLiveAtual || '-'}</span>
                                            <span>‚è±Ô∏è ${p.diasParado || 0}d</span>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `).join('');
        }

        function populateFilters() {
            const pmos = [...new Set(projects.map(p => p.pmoInterno).filter(Boolean))].sort();
            const select = document.getElementById('filterPmo');
            select.innerHTML = '<option value="">Todos</option>' + pmos.map(pmo => `<option value="${pmo}">${pmo}</option>`).join('');
        }

        function applyFilters() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const status = document.getElementById('filterStatus').value;
            const situacao = document.getElementById('filterSituacao').value.toLowerCase();
            const pmo = document.getElementById('filterPmo').value;
            const parado = parseInt(document.getElementById('filterParado').value) || 0;
            const goLive = document.getElementById('filterGoLive').value;
            const apenaCriticos = document.getElementById('filterCriticos').checked;

            filteredProjects = projects.filter(p => {
                if (search && !p.projeto.toLowerCase().includes(search)) return false;
                if (status && normalizeStatus(p.status) !== status) return false;
                if (situacao && (p.situacao || '').toLowerCase() !== situacao) return false;
                if (pmo && p.pmoInterno !== pmo) return false;
                if (parado && (parseInt(p.diasParado) || 0) < parado) return false;
                if (apenaCriticos && !isCritico(p)) return false;
                
                if (goLive) {
                    const goLiveAtual = p.goLiveAtual ? new Date(p.goLiveAtual.split('/').reverse().join('-')) : null;
                    const hoje = new Date();
                    hoje.setHours(0, 0, 0, 0);
                    
                    if (goLive === 'mes') {
                        const fimMes = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
                        if (!goLiveAtual || goLiveAtual < hoje || goLiveAtual > fimMes) return false;
                    } else if (goLive === 'atrasados') {
                        if (!goLiveAtual || goLiveAtual >= hoje || normalizeStatus(p.status) === 'Conclu√≠do') return false;
                    } else {
                        const dias = parseInt(goLive);
                        const limite = new Date(hoje);
                        limite.setDate(limite.getDate() + dias);
                        if (!goLiveAtual || goLiveAtual < hoje || goLiveAtual > limite) return false;
                    }
                }
                
                return true;
            });

            updateDashboard();
            updateActiveCards();
        }

        function filterByStatus(status) {
            clearFilters(false);
            if (status === 'todos') {
                filteredProjects = [...projects];
            } else if (status === 'criticos') {
                filteredProjects = projects.filter(p => isCritico(p));
            } else {
                filteredProjects = projects.filter(p => normalizeStatus(p.status) === status);
            }
            updateDashboard();
            updateActiveCards(status);
        }

        function updateActiveCards(active = 'todos') {
            document.querySelectorAll('.status-card').forEach(card => card.classList.remove('active'));
            const map = { 'todos': 'total', 'Conclu√≠do': 'concluido', 'Em Andamento': 'andamento', 'Atrasado': 'atrasado', 'Aguardando': 'aguardando', 'N√£o Iniciado': 'nao-iniciado', 'criticos': 'critico' };
            const cls = map[active] || 'total';
            document.querySelector(`.status-card.${cls}`)?.classList.add('active');
        }

        function toggleCriticosFilter() {
            const checkbox = document.getElementById('filterCriticos');
            checkbox.checked = !checkbox.checked;
            document.getElementById('criticosCheckbox').classList.toggle('active', checkbox.checked);
            applyFilters();
        }

        function clearFilters(apply = true) {
            document.getElementById('searchInput').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterSituacao').value = '';
            document.getElementById('filterPmo').value = '';
            document.getElementById('filterParado').value = '';
            document.getElementById('filterGoLive').value = '';
            document.getElementById('filterCriticos').checked = false;
            document.getElementById('criticosCheckbox').classList.remove('active');
            if (apply) {
                filteredProjects = [...projects];
                updateDashboard();
                updateActiveCards();
            }
        }

        // === MODAL DO PROJETO ===
        function openModal(index) {
            currentProject = projects[index];
            const p = currentProject;
            if (!p) return;

            document.getElementById('modalTitle').textContent = p.projeto;
            document.getElementById('modalSubtitle').textContent = `${normalizeStatus(p.status)} ‚Ä¢ ${p.localizacao || '-'}`;

            const info = document.getElementById('modalInfo');
            info.innerHTML = `
                <div class="info-box"><label>Status</label><span class="badge ${normalizeStatus(p.status).toLowerCase().replace(/\s+/g, '-')}">${normalizeStatus(p.status)}</span></div>
                <div class="info-box"><label>Situa√ß√£o</label><span><span class="rag-dot ${(p.situacao || 'verde').toLowerCase()}"></span> ${p.situacao || 'Verde'}</span></div>
                <div class="info-box"><label>Localiza√ß√£o</label><span>${p.localizacao || '-'}</span></div>
                <div class="info-box"><label>PMO Interno</label><span>${p.pmoInterno || '-'}</span></div>
                <div class="info-box"><label>Go Live Original</label><span>${p.goLiveOriginal || '-'}</span></div>
                <div class="info-box"><label>Go Live Atual</label><span>${p.goLiveAtual || '-'}</span></div>
                <div class="info-box"><label>Progresso</label><span><div class="progress-mini" style="width:150px;display:inline-block;vertical-align:middle;margin-right:10px;"><div class="progress-mini-fill" style="width:${p.progresso || 0}%"></div></div> ${p.progresso || 0}%</span></div>
                <div class="info-box"><label>Dias Parado</label><span>${p.diasParado || 0} dias</span></div>
                ${p.bloqueador && p.bloqueador !== '-' ? `<div class="info-box bloqueador full-width"><label>üö® Bloqueador</label><span>${p.bloqueador}</span></div>` : ''}
                ${p.observacoes && p.observacoes !== '-' ? `<div class="info-box full-width"><label>üìù Observa√ß√µes</label><span>${p.observacoes}</span></div>` : ''}
            `;

            // Atividades do projeto
            const atividadesProjeto = atividades.filter(a => a.projeto === p.projeto);
            const atividadesSection = document.getElementById('atividadesSection');
            
            if (atividadesProjeto.length > 0) {
                const concluidas = atividadesProjeto.filter(a => (a.status || '').toLowerCase().includes('conclu'));
                const andamento = atividadesProjeto.filter(a => (a.status || '').toLowerCase().includes('andamento'));
                const pendentes = atividadesProjeto.filter(a => !concluidas.includes(a) && !andamento.includes(a));

                atividadesSection.innerHTML = `
                    <div class="atividades-header">
                        <h3>üìã Atividades (${concluidas.length}/${atividadesProjeto.length})</h3>
                    </div>
                    <div class="atividades-list">
                        ${concluidas.map(a => `
                            <div class="atividade-item concluida">
                                <span class="atividade-status">‚úÖ</span>
                                <div class="atividade-info">
                                    <div class="atividade-nome">${a.atividade}</div>
                                    <div class="atividade-data">Conclu√≠da em ${a.dataConclusao || '-'}</div>
                                </div>
                            </div>
                        `).join('')}
                        ${andamento.map(a => `
                            <div class="atividade-item andamento">
                                <span class="atividade-status">üîÑ</span>
                                <div class="atividade-info">
                                    <div class="atividade-nome">${a.atividade}</div>
                                    <div class="atividade-data">Em andamento</div>
                                </div>
                            </div>
                        `).join('')}
                        ${pendentes.map(a => `
                            <div class="atividade-item pendente">
                                <span class="atividade-status">‚è≥</span>
                                <div class="atividade-info">
                                    <div class="atividade-nome">${a.atividade}</div>
                                    <div class="atividade-data">Pendente</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                atividadesSection.innerHTML = '';
            }

            document.getElementById('modalOverlay').classList.add('active');
        }

        function closeModal(e) {
            if (e && e.target !== e.currentTarget) return;
            document.getElementById('modalOverlay').classList.remove('active');
            currentProject = null;
        }

        // === IMPRIMIR PROJETO INDIVIDUAL ===
        function printProject() {
            if (!currentProject) return;
            const p = currentProject;
            const atividadesProjeto = atividades.filter(a => a.projeto === p.projeto);
            const concluidas = atividadesProjeto.filter(a => (a.status || '').toLowerCase().includes('conclu'));
            const andamento = atividadesProjeto.filter(a => (a.status || '').toLowerCase().includes('andamento'));
            const pendentes = atividadesProjeto.filter(a => !concluidas.includes(a) && !andamento.includes(a));

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${p.projeto} - Relat√≥rio</title>
                    <style>
                        body { font-family: 'Segoe UI', Arial, sans-serif; padding: 30px; max-width: 900px; margin: 0 auto; }
                        .header { text-align: center; border-bottom: 3px solid #667eea; padding-bottom: 20px; margin-bottom: 30px; }
                        .header h1 { color: #1a1a2e; margin: 0 0 10px 0; }
                        .header .badge { display: inline-block; padding: 8px 20px; border-radius: 20px; font-size: 0.9rem; }
                        .badge.conclu√≠do { background: #dcfce7; color: #166534; }
                        .badge.em-andamento { background: #dbeafe; color: #1e40af; }
                        .badge.atrasado { background: #fee2e2; color: #991b1b; }
                        .badge.aguardando { background: #fef3c7; color: #92400e; }
                        .badge.n√£o-iniciado { background: #f1f5f9; color: #475569; }
                        .info-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px; }
                        .info-box { background: #f8fafc; padding: 15px; border-radius: 8px; border-left: 3px solid #667eea; }
                        .info-box label { font-size: 0.75rem; color: #64748b; text-transform: uppercase; display: block; margin-bottom: 5px; }
                        .info-box span { font-size: 1rem; color: #1e293b; font-weight: 500; }
                        .bloqueador { background: #fef2f2 !important; border-left-color: #ef4444 !important; }
                        .bloqueador span { color: #991b1b !important; }
                        .atividades { margin-top: 30px; }
                        .atividades h3 { color: #1e293b; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #e2e8f0; }
                        .section { margin-bottom: 20px; }
                        .section-title { font-weight: 600; padding: 8px 15px; border-radius: 6px; margin-bottom: 10px; }
                        .section-title.concluidas { background: #dcfce7; color: #166534; }
                        .section-title.andamento { background: #dbeafe; color: #1e40af; }
                        .section-title.pendentes { background: #f1f5f9; color: #475569; }
                        .atividade { padding: 10px 15px; margin: 5px 0; background: #f8fafc; border-radius: 6px; display: flex; justify-content: space-between; }
                        .atividade .nome { color: #1e293b; }
                        .atividade .data { color: #64748b; font-size: 0.85rem; }
                        .obs-box { background: #fffbeb; padding: 15px; border-radius: 8px; border-left: 3px solid #f59e0b; margin-top: 20px; }
                        .obs-box h4 { margin: 0 0 10px 0; color: #92400e; }
                        .obs-box p { margin: 0; color: #78350f; }
                        .footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid #e2e8f0; text-align: center; color: #64748b; font-size: 0.85rem; }
                        @media print { body { padding: 20px; } }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${p.projeto}</h1>
                        <span class="badge ${normalizeStatus(p.status).toLowerCase().replace(/\s+/g, '-')}">${normalizeStatus(p.status)}</span>
                    </div>
                    <div class="info-grid">
                        <div class="info-box"><label>Localiza√ß√£o</label><span>${p.localizacao || '-'}</span></div>
                        <div class="info-box"><label>PMO Interno</label><span>${p.pmoInterno || '-'}</span></div>
                        <div class="info-box"><label>Situa√ß√£o</label><span>${p.situacao || 'Verde'}</span></div>
                        <div class="info-box"><label>Go Live Original</label><span>${p.goLiveOriginal || '-'}</span></div>
                        <div class="info-box"><label>Go Live Atual</label><span>${p.goLiveAtual || '-'}</span></div>
                        <div class="info-box"><label>Progresso</label><span>${p.progresso || 0}%</span></div>
                        <div class="info-box"><label>Dias Parado</label><span>${p.diasParado || 0} dias</span></div>
                        <div class="info-box"><label>√öltima Atualiza√ß√£o</label><span>${p.ultAtual || '-'}</span></div>
                        ${p.bloqueador && p.bloqueador !== '-' ? `<div class="info-box bloqueador" style="grid-column: 1 / -1;"><label>üö® Bloqueador</label><span>${p.bloqueador}</span></div>` : ''}
                    </div>
                    ${atividadesProjeto.length > 0 ? `
                    <div class="atividades">
                        <h3>üìã Atividades (${concluidas.length}/${atividadesProjeto.length})</h3>
                        ${concluidas.length > 0 ? `
                        <div class="section">
                            <div class="section-title concluidas">‚úÖ Conclu√≠das (${concluidas.length})</div>
                            ${concluidas.map(a => `<div class="atividade"><span class="nome">${a.atividade}</span><span class="data">${a.dataConclusao || '-'}</span></div>`).join('')}
                        </div>` : ''}
                        ${andamento.length > 0 ? `
                        <div class="section">
                            <div class="section-title andamento">üîÑ Em Andamento (${andamento.length})</div>
                            ${andamento.map(a => `<div class="atividade"><span class="nome">${a.atividade}</span></div>`).join('')}
                        </div>` : ''}
                        ${pendentes.length > 0 ? `
                        <div class="section">
                            <div class="section-title pendentes">‚è≥ Pendentes (${pendentes.length})</div>
                            ${pendentes.map(a => `<div class="atividade"><span class="nome">${a.atividade}</span></div>`).join('')}
                        </div>` : ''}
                    </div>` : ''}
                    ${p.observacoes && p.observacoes !== '-' ? `
                    <div class="obs-box">
                        <h4>üìù Observa√ß√µes</h4>
                        <p>${p.observacoes}</p>
                    </div>` : ''}
                    <div class="footer">
                        Dashboard de Projetos - Infraestrutura v6.1.1 ‚Ä¢ Invent Corp<br>
                        Gerado em: ${new Date().toLocaleString('pt-BR')}
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.focus();
            setTimeout(() => { printWindow.print(); }, 300);
        }

        // === MODAL DE IMPRESS√ÉO ===
        function openPrintModal() {
            const sortedProjects = [...projects].sort((a, b) => a.projeto.localeCompare(b.projeto));
            document.getElementById('printProjectsCheckboxList').innerHTML = sortedProjects.map((p, i) => {
                const originalIndex = projects.indexOf(p);
                return `<label class="project-checkbox"><input type="checkbox" value="${originalIndex}"><span>${p.projeto}</span></label>`;
            }).join('');
            document.getElementById('printModalOverlay').classList.add('active');
        }

        function closePrintModal(e) {
            if (e && e.target !== e.currentTarget) return;
            document.getElementById('printModalOverlay').classList.remove('active');
        }

        function selectPrintOption(el, option) {
            document.querySelectorAll('#printModalOverlay .print-option').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
            printOption = option;
        }

        function filterPrintProjectCheckboxes() {
            const search = document.getElementById('printProjectSearch').value.toLowerCase();
            document.querySelectorAll('#printProjectsCheckboxList label').forEach(l => {
                const name = l.querySelector('span').textContent.toLowerCase();
                l.style.display = name.includes(search) ? '' : 'none';
            });
        }

        function toggleSelectAllPrint() {
            const checkboxes = document.querySelectorAll('#printProjectsCheckboxList input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(c => c.checked);
            checkboxes.forEach(c => c.checked = !allChecked);
        }

        function executePrint() {
            closePrintModal();
            let projectsToPrint = filteredProjects;

            if (printOption === 'all') {
                projectsToPrint = [...projects];
            } else if (printOption === 'criticos') {
                projectsToPrint = projects.filter(p => isCritico(p));
            } else if (printOption === 'specific') {
                const checkboxes = document.querySelectorAll('#printProjectsCheckboxList input[type="checkbox"]:checked');
                if (checkboxes.length > 0) {
                    const indices = Array.from(checkboxes).map(c => parseInt(c.value));
                    projectsToPrint = indices.map(i => projects[i]).filter(p => p);
                }
            }

            filteredProjects = projectsToPrint;
            updateDashboard();
            setTimeout(() => window.print(), 300);
        }

        // === MODAL DE PDF ===
        function openPdfModal() {
            const sortedProjects = [...projects].sort((a, b) => a.projeto.localeCompare(b.projeto));
            document.getElementById('pdfProjectsCheckboxList').innerHTML = sortedProjects.map((p, i) => {
                const originalIndex = projects.indexOf(p);
                return `<label class="project-checkbox"><input type="checkbox" value="${originalIndex}"><span>${p.projeto}</span></label>`;
            }).join('');
            document.getElementById('pdfModalOverlay').classList.add('active');
        }

        function closePdfModal(e) {
            if (e && e.target !== e.currentTarget) return;
            document.getElementById('pdfModalOverlay').classList.remove('active');
        }

        function selectPdfOption(el, option) {
            document.querySelectorAll('#pdfModalOverlay .print-option').forEach(o => o.classList.remove('selected'));
            el.classList.add('selected');
            pdfOption = option;
        }

        function filterPdfProjectCheckboxes() {
            const search = document.getElementById('pdfProjectSearch').value.toLowerCase();
            document.querySelectorAll('#pdfProjectsCheckboxList label').forEach(l => {
                const name = l.querySelector('span').textContent.toLowerCase();
                l.style.display = name.includes(search) ? '' : 'none';
            });
        }

        function toggleSelectAllPdf() {
            const checkboxes = document.querySelectorAll('#pdfProjectsCheckboxList input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(c => c.checked);
            checkboxes.forEach(c => c.checked = !allChecked);
        }

        function executePdf() {
            closePdfModal();
            let projectsToPdf = filteredProjects;

            if (pdfOption === 'all') {
                projectsToPdf = [...projects];
            } else if (pdfOption === 'criticos') {
                projectsToPdf = projects.filter(p => isCritico(p));
            } else if (pdfOption === 'specific') {
                const checkboxes = document.querySelectorAll('#pdfProjectsCheckboxList input[type="checkbox"]:checked');
                if (checkboxes.length > 0) {
                    const indices = Array.from(checkboxes).map(c => parseInt(c.value));
                    projectsToPdf = indices.map(i => projects[i]).filter(p => p);
                }
            }

            generatePDF(projectsToPdf);
        }

        function generatePDF(projectsList) {
            const hoje = new Date().toLocaleDateString('pt-BR');
            const hora = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

            const counts = { concluido: 0, andamento: 0, atrasado: 0, aguardando: 0, naoIniciado: 0 };
            projectsList.forEach(p => {
                const status = normalizeStatus(p.status);
                if (status === 'Conclu√≠do') counts.concluido++;
                else if (status === 'Em Andamento') counts.andamento++;
                else if (status === 'Atrasado') counts.atrasado++;
                else if (status === 'Aguardando') counts.aguardando++;
                else counts.naoIniciado++;
            });

            let html = `
                <div style="font-family: Arial, sans-serif; padding: 20px;">
                    <div style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #667eea; padding-bottom: 20px;">
                        <h1 style="color: #1a1a2e; margin: 0;">üìä Relat√≥rio de Projetos - Infraestrutura</h1>
                        <p style="color: #666; margin: 10px 0 0 0;">Gerado em: ${hoje} √†s ${hora}</p>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;">
                        <div style="background: #f0fdf4; padding: 15px 25px; border-radius: 10px; border-left: 4px solid #22c55e;">
                            <div style="font-size: 24px; font-weight: bold; color: #166534;">${counts.concluido}</div>
                            <div style="font-size: 12px; color: #15803d;">Conclu√≠dos</div>
                        </div>
                        <div style="background: #eff6ff; padding: 15px 25px; border-radius: 10px; border-left: 4px solid #3b82f6;">
                            <div style="font-size: 24px; font-weight: bold; color: #1e40af;">${counts.andamento}</div>
                            <div style="font-size: 12px; color: #1d4ed8;">Em Andamento</div>
                        </div>
                        <div style="background: #fef2f2; padding: 15px 25px; border-radius: 10px; border-left: 4px solid #ef4444;">
                            <div style="font-size: 24px; font-weight: bold; color: #991b1b;">${counts.atrasado}</div>
                            <div style="font-size: 12px; color: #b91c1c;">Atrasados</div>
                        </div>
                        <div style="background: #fffbeb; padding: 15px 25px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                            <div style="font-size: 24px; font-weight: bold; color: #92400e;">${counts.aguardando}</div>
                            <div style="font-size: 12px; color: #b45309;">Aguardando</div>
                        </div>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 11px;">
                        <thead>
                            <tr style="background: #1e293b; color: white;">
                                <th style="padding: 12px 8px; text-align: left;">Projeto</th>
                                <th style="padding: 12px 8px; text-align: left;">Status</th>
                                <th style="padding: 12px 8px; text-align: left;">Situa√ß√£o</th>
                                <th style="padding: 12px 8px; text-align: left;">PMO</th>
                                <th style="padding: 12px 8px; text-align: left;">Go-Live</th>
                                <th style="padding: 12px 8px; text-align: left;">Progresso</th>
                                <th style="padding: 12px 8px; text-align: left;">Dias Parado</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${projectsList.map((p, i) => {
                                const status = normalizeStatus(p.status);
                                const bgColor = i % 2 === 0 ? '#ffffff' : '#f8fafc';
                                const statusColors = {
                                    'Conclu√≠do': '#dcfce7',
                                    'Em Andamento': '#dbeafe',
                                    'Atrasado': '#fee2e2',
                                    'Aguardando': '#fef3c7',
                                    'N√£o Iniciado': '#f1f5f9'
                                };
                                return `<tr style="background: ${bgColor};">
                                    <td style="padding: 10px 8px; border-bottom: 1px solid #e2e8f0;"><strong>${p.projeto}</strong></td>
                                    <td style="padding: 10px 8px; border-bottom: 1px solid #e2e8f0;"><span style="background: ${statusColors[status]}; padding: 4px 10px; border-radius: 12px; font-size: 10px;">${status}</span></td>
                                    <td style="padding: 10px 8px; border-bottom: 1px solid #e2e8f0;">${p.situacao || 'Verde'}</td>
                                    <td style="padding: 10px 8px; border-bottom: 1px solid #e2e8f0;">${p.pmoInterno || '-'}</td>
                                    <td style="padding: 10px 8px; border-bottom: 1px solid #e2e8f0;">${p.goLiveAtual || '-'}</td>
                                    <td style="padding: 10px 8px; border-bottom: 1px solid #e2e8f0;">${p.progresso || 0}%</td>
                                    <td style="padding: 10px 8px; border-bottom: 1px solid #e2e8f0;">${p.diasParado || 0}d</td>
                                </tr>`;
                            }).join('')}
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 30px; text-align: center; color: #64748b; font-size: 11px; border-top: 1px solid #e2e8f0; padding-top: 15px;">
                        Dashboard de Projetos - Infraestrutura v6.1.1 ‚Ä¢ Invent Corp
                    </div>
                </div>
            `;

            const element = document.createElement('div');
            element.innerHTML = html;
            document.body.appendChild(element);

            const opt = {
                margin: 10,
                filename: 'Relatorio_Projetos_Infraestrutura_' + hoje.replace(/\//g, '-') + '.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save().then(() => {
                document.body.removeChild(element);
            });
        }

        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') {
                closeModal();
                closePrintModal();
                closePdfModal();
            }
        });

        window.addEventListener('load', loadData);
    </script>
</body>
</html>
