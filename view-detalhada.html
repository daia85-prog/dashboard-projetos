<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vis√£o Detalhada - Fases & Atividades v9</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .header h1 { font-size: 1.4em; display: flex; align-items: center; gap: 10px; }
        .nav-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .nav-btn { padding: 10px 18px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9em; text-decoration: none; display: inline-flex; align-items: center; gap: 6px; transition: all 0.2s; }
        .nav-btn.orange { background: #f59e0b; color: white; }
        .nav-btn.orange:hover { background: #d97706; }
        .nav-btn.purple { background: #8b5cf6; color: white; }
        .nav-btn.purple:hover { background: #7c3aed; }

        .container { max-width: 1600px; margin: 0 auto; padding: 20px; }

        .filters { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .filters-grid { display: grid; grid-template-columns: 2fr repeat(3, 1fr) auto; gap: 15px; align-items: end; }
        .filter-group { display: flex; flex-direction: column; gap: 5px; }
        .filter-group label { font-size: 0.85em; font-weight: 600; color: #64748b; }
        .filter-group input, .filter-group select { padding: 10px 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 0.95em; transition: border 0.2s; }
        .filter-group input:focus, .filter-group select:focus { outline: none; border-color: #667eea; }
        .btn-clear { padding: 10px 16px; background: #f1f5f9; border: 2px solid #e2e8f0; border-radius: 8px; cursor: pointer; font-weight: 600; color: #64748b; transition: all 0.2s; }
        .btn-clear:hover { background: #e2e8f0; border-color: #cbd5e1; }

        .main-layout { display: grid; grid-template-columns: 380px 1fr; gap: 20px; }
        
        .projects-panel { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-height: calc(100vh - 200px); overflow: hidden; display: flex; flex-direction: column; }
        .projects-header { padding: 15px 20px; border-bottom: 2px solid #e2e8f0; background: #f8fafc; }
        .projects-header h2 { font-size: 1.1em; color: #1e293b; }
        .projects-list { overflow-y: auto; flex: 1; padding: 10px; }
        
        .project-item { padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 10px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s; }
        .project-item:hover { border-color: #667eea; background: #f8fafc; }
        .project-item.active { border-color: #667eea; background: #eef2ff; box-shadow: 0 0 0 3px rgba(102,126,234,0.2); }
        .project-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .project-name { font-weight: 700; color: #1e293b; font-size: 0.95em; }
        .project-progress { font-weight: 700; font-size: 0.9em; }
        .project-meta { display: flex; gap: 8px; font-size: 0.8em; color: #64748b; flex-wrap: wrap; align-items: center; }
        
        .badge { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: 0.75em; font-weight: 600; }
        .badge-alta { background: #fee2e2; color: #dc2626; }
        .badge-media { background: #fef3c7; color: #d97706; }
        .badge-baixa { background: #dbeafe; color: #2563eb; }
        .badge-concluido { background: #dcfce7; color: #166534; }
        .badge-andamento { background: #dbeafe; color: #1e40af; }
        .badge-aguardando { background: #fef3c7; color: #92400e; }
        .badge-nao-iniciado { background: #f3f4f6; color: #6b7280; }

        .details-panel { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-height: calc(100vh - 200px); overflow-y: auto; }
        .details-empty { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 400px; color: #94a3b8; }
        .details-empty-icon { font-size: 4em; margin-bottom: 15px; }
        
        .details-header { padding: 20px; border-bottom: 3px solid #667eea; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 12px 12px 0 0; }
        .details-title { font-size: 1.5em; font-weight: 700; margin-bottom: 12px; }
        .details-meta { display: flex; gap: 15px; flex-wrap: wrap; font-size: 0.9em; opacity: 0.95; }
        .details-meta span { display: flex; align-items: center; gap: 5px; }
        .details-meta .badge { background: rgba(255,255,255,0.2); color: white; }

        .phases-timeline { padding: 25px 20px; background: #f8fafc; border-bottom: 1px solid #e2e8f0; }
        .phases-timeline h3 { font-size: 1em; color: #475569; margin-bottom: 20px; }
        .phase-steps { display: flex; justify-content: space-between; position: relative; }
        .phase-steps::before { content: ''; position: absolute; top: 15px; left: 5%; width: 90%; height: 3px; background: #e2e8f0; z-index: 0; }
        .phase-step { flex: 1; text-align: center; position: relative; z-index: 1; }
        .phase-circle { width: 32px; height: 32px; border-radius: 50%; background: #e2e8f0; margin: 0 auto 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.8em; color: #64748b; transition: all 0.3s; }
        .phase-step.completed .phase-circle { background: #22c55e; color: white; }
        .phase-step.current .phase-circle { background: #667eea; color: white; box-shadow: 0 0 0 4px rgba(102,126,234,0.3); transform: scale(1.1); }
        .phase-label { font-size: 0.7em; color: #64748b; font-weight: 600; line-height: 1.2; }
        .phase-step.completed .phase-label { color: #22c55e; }
        .phase-step.current .phase-label { color: #667eea; font-weight: 700; }

        .activities-section { padding: 20px; }
        .activities-section h3 { font-size: 1em; color: #475569; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .activities-count { background: #667eea; color: white; padding: 2px 10px; border-radius: 12px; font-size: 0.85em; }

        .activity-item { background: #f9fafb; border-left: 4px solid #e2e8f0; padding: 12px 15px; margin-bottom: 10px; border-radius: 0 8px 8px 0; cursor: pointer; transition: all 0.2s; }
        .activity-item:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .activity-item.concluido { border-left-color: #22c55e; background: #f0fdf4; }
        .activity-item.andamento { border-left-color: #3b82f6; background: #eff6ff; }
        .activity-item.aguardando { border-left-color: #f59e0b; background: #fffbeb; }
        .activity-item.nao-iniciado { border-left-color: #94a3b8; background: #f8fafc; }
        
        .activity-header { display: flex; justify-content: space-between; align-items: center; }
        .activity-info { flex: 1; }
        .activity-name { font-weight: 600; color: #1e293b; font-size: 0.95em; }
        .activity-phase { font-size: 0.8em; color: #64748b; margin-top: 2px; }

        .tratativas-section { margin-top: 12px; padding-top: 12px; border-top: 1px dashed #e2e8f0; display: none; }
        .tratativas-section.active { display: block; }
        .tratativas-header { font-size: 0.85em; color: #667eea; font-weight: 600; margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
        
        .tratativa-item { background: white; padding: 10px 12px; margin-bottom: 8px; border-radius: 6px; border-left: 3px solid #667eea; }
        .tratativa-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .tratativa-user { font-weight: 600; color: #1e293b; font-size: 0.85em; }
        .tratativa-date { color: #94a3b8; font-size: 0.8em; }
        .tratativa-tipo { display: inline-block; padding: 2px 8px; border-radius: 10px; font-size: 0.7em; font-weight: 600; margin-bottom: 6px; }
        .tipo-atualizacao { background: #dbeafe; color: #1e40af; }
        .tipo-alerta { background: #fee2e2; color: #dc2626; }
        .tipo-resolucao { background: #dcfce7; color: #166534; }
        .tipo-comentario { background: #fef3c7; color: #92400e; }
        .tratativa-content { color: #475569; font-size: 0.9em; line-height: 1.4; }
        .no-tratativas { color: #94a3b8; font-style: italic; font-size: 0.85em; }

        .expand-icon { font-size: 0.8em; color: #94a3b8; transition: transform 0.2s; margin-left: 10px; }
        .activity-item.expanded .expand-icon { transform: rotate(180deg); }

        .footer { text-align: center; padding: 15px; color: rgba(255,255,255,0.8); font-size: 0.85em; margin-top: 20px; }

        @media (max-width: 1200px) {
            .main-layout { grid-template-columns: 1fr; }
            .projects-panel { max-height: 300px; }
            .details-panel { max-height: none; }
        }
        @media (max-width: 768px) {
            .filters-grid { grid-template-columns: 1fr 1fr; }
            .phase-label { font-size: 0.6em; }
            .phase-circle { width: 26px; height: 26px; font-size: 0.7em; }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>üìã Vis√£o Detalhada - Fases & Atividades</h1>
        <nav class="nav-buttons">
            <a href="index.html" class="nav-btn orange">üè† Vis√£o Executiva</a>
            <a href="view-projetos.html" class="nav-btn purple">üö® Alertas</a>
        </nav>
    </header>

    <div class="container">
        <div class="filters">
            <div class="filters-grid">
                <div class="filter-group">
                    <label>üîç Buscar Projeto</label>
                    <input type="text" id="searchProject" placeholder="Nome do projeto..." oninput="filterProjects()">
                </div>
                <div class="filter-group">
                    <label>üìä Status</label>
                    <select id="filterStatus" onchange="filterProjects()">
                        <option value="">Todos</option>
                        <option value="Conclu√≠do">Conclu√≠do</option>
                        <option value="Em andamento">Em andamento</option>
                        <option value="Aguardando">Aguardando</option>
                        <option value="N√£o Iniciado">N√£o Iniciado</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>‚ö° Prioridade</label>
                    <select id="filterPriority" onchange="filterProjects()">
                        <option value="">Todas</option>
                        <option value="Alta">Alta</option>
                        <option value="M√©dia">M√©dia</option>
                        <option value="Baixa">Baixa</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>üë§ Respons√°vel</label>
                    <select id="filterResp" onchange="filterProjects()"></select>
                </div>
                <div class="filter-group">
                    <label>&nbsp;</label>
                    <button class="btn-clear" onclick="clearFilters()">üóëÔ∏è Limpar</button>
                </div>
            </div>
        </div>

        <div class="main-layout">
            <div class="projects-panel">
                <div class="projects-header">
                    <h2>üìÇ Projetos (<span id="projectCount">30</span>)</h2>
                </div>
                <div class="projects-list" id="projectsList"></div>
            </div>

            <div class="details-panel" id="detailsPanel">
                <div class="details-empty">
                    <div class="details-empty-icon">üëÜ</div>
                    <p>Selecione um projeto para ver detalhes</p>
                </div>
            </div>
        </div>

        <footer class="footer">Vis√£o Detalhada v9 | Invent Corp | Dashboard de Infraestrutura</footer>
    </div>

<script>
const PROJETOS = [
    { nome: 'BARBECUE B2B', local: 'S√£o Paulo - SP', resp: 'ALEX', prioridade: 'Alta', dataInicio: '2025-06-01', dataPrevista: '2026-02-06' },
    { nome: 'BELEZA', local: 'S√£o Paulo - SP', resp: 'ANDERSON', prioridade: 'M√©dia', dataInicio: '2025-05-01', dataPrevista: '2025-11-30' },
    { nome: 'BETA', local: 'Rio de Janeiro - RJ', resp: 'ANDERSON', prioridade: 'Alta', dataInicio: '2025-07-01', dataPrevista: '2026-03-10' },
    { nome: 'BETA ESTEIO', local: 'Esteio - RS', resp: 'ANDERSON', prioridade: 'M√©dia', dataInicio: '2026-01-16', dataPrevista: '2026-07-15' },
    { nome: 'BP', local: 'S√£o Paulo - SP', resp: 'GIOVANNI', prioridade: 'M√©dia', dataInicio: '2025-12-01', dataPrevista: '2026-06-30' },
    { nome: 'BR', local: 'Jaboat√£o - PE', resp: 'F√ÅBIO', prioridade: 'Alta', dataInicio: '2026-02-01', dataPrevista: '2026-08-01' },
    { nome: 'CANDELABRIA', local: 'Candel√°ria - RS', resp: 'ALEX', prioridade: 'M√©dia', dataInicio: '2025-06-01', dataPrevista: '2025-12-09' },
    { nome: 'CDSK', local: 'S√£o Paulo - SP', resp: 'VINICIUS', prioridade: 'Alta', dataInicio: '2025-08-01', dataPrevista: '2026-02-28' },
    { nome: 'COUGAR', local: 'S√£o Paulo - SP', resp: 'LEANDRO', prioridade: 'Alta', dataInicio: '2025-05-01', dataPrevista: '2026-02-09' },
    { nome: 'CRISTAL MG RETROFIT', local: 'Belo Horizonte - MG', resp: 'GIOVANNI', prioridade: 'Alta', dataInicio: '2025-11-01', dataPrevista: '2026-05-30' },
    { nome: 'DIA', local: 'S√£o Paulo - SP', resp: 'F√ÅBIO', prioridade: 'Alta', dataInicio: '2025-09-15', dataPrevista: '2026-04-15' },
    { nome: 'DIAMANTE', local: 'Curitiba - PR', resp: 'LEANDRO', prioridade: 'M√©dia', dataInicio: '2026-03-01', dataPrevista: '2026-09-01' },
    { nome: 'ELETRO', local: 'S√£o Paulo - SP', resp: 'VINICIUS', prioridade: 'M√©dia', dataInicio: '2025-10-01', dataPrevista: '2026-04-30' },
    { nome: 'ESPERAN√áA', local: 'Fortaleza - CE', resp: 'ALEX', prioridade: 'M√©dia', dataInicio: '2025-04-01', dataPrevista: '2025-10-30' },
    { nome: 'FLOWER', local: 'Campinas - SP', resp: 'GIOVANNI', prioridade: 'Baixa', dataInicio: '2025-11-15', dataPrevista: '2026-05-15' },
    { nome: 'GAVI√ÉO', local: 'Salvador - BA', resp: 'F√ÅBIO', prioridade: 'Alta', dataInicio: '2025-03-01', dataPrevista: '2025-09-30' },
    { nome: 'MKT CHILE', local: 'Santiago - Chile', resp: 'ANDERSON', prioridade: 'Alta', dataInicio: '2026-04-01', dataPrevista: '2026-10-01' },
    { nome: 'MKT PERU', local: 'Lima - Peru', resp: 'ANDERSON', prioridade: 'Alta', dataInicio: '2026-05-01', dataPrevista: '2026-11-01' },
    { nome: 'MASTER', local: 'Porto Alegre - RS', resp: 'LEANDRO', prioridade: 'M√©dia', dataInicio: '2026-03-15', dataPrevista: '2026-09-15' },
    { nome: 'NAVEPARK', local: 'Navegantes - SC', resp: 'ALEX', prioridade: 'M√©dia', dataInicio: '2025-10-01', dataPrevista: '2026-04-01' },
    { nome: 'OCTOPUS MS', local: 'Campo Grande - MS', resp: 'GIOVANNI', prioridade: 'M√©dia', dataInicio: '2025-09-01', dataPrevista: '2026-03-30' },
    { nome: 'OCTOPUS SC', local: 'Florian√≥polis - SC', resp: 'LEANDRO', prioridade: 'Alta', dataInicio: '2025-05-15', dataPrevista: '2025-11-15' },
    { nome: 'OPTIMUS PRIME', local: 'Manaus - AM', resp: 'VINICIUS', prioridade: 'Alta', dataInicio: '2025-04-01', dataPrevista: '2025-10-01' },
    { nome: 'PBL GUATEMALA', local: 'Cidade da Guatemala', resp: 'F√ÅBIO', prioridade: 'Alta', dataInicio: '2025-08-15', dataPrevista: '2026-02-15' },
    { nome: 'PROMO B2B CD GRU', local: 'Guarulhos - SP', resp: 'ALEX', prioridade: 'Alta', dataInicio: '2025-06-15', dataPrevista: '2025-12-15' },
    { nome: 'PTL SP', local: 'S√£o Paulo - SP', resp: 'VINICIUS', prioridade: 'M√©dia', dataInicio: '2025-07-01', dataPrevista: '2026-01-01' },
    { nome: 'REISADO', local: 'Recife - PE', resp: 'F√ÅBIO', prioridade: 'M√©dia', dataInicio: '2025-05-01', dataPrevista: '2025-11-01' },
    { nome: 'REVERSE', local: 'Bras√≠lia - DF', resp: 'GIOVANNI', prioridade: 'Alta', dataInicio: '2025-08-01', dataPrevista: '2026-02-01' },
    { nome: 'SUPER DIVINOPOLIS', local: 'Divin√≥polis - MG', resp: 'ALEX', prioridade: 'M√©dia', dataInicio: '2025-06-01', dataPrevista: '2025-12-01' },
    { nome: 'TITANIO', local: 'Goi√¢nia - GO', resp: 'LEANDRO', prioridade: 'Alta', dataInicio: '2025-07-15', dataPrevista: '2026-01-15' }
];

const PROJETO_STATUS = {
    'BARBECUE B2B': 23, 'BELEZA': 23, 'BETA': 21, 'BETA ESTEIO': 1, 'BP': 3,
    'BR': 1, 'CANDELABRIA': 23, 'CDSK': 23, 'COUGAR': 23, 'CRISTAL MG RETROFIT': 4,
    'DIA': 7, 'DIAMANTE': 0, 'ELETRO': 10, 'ESPERAN√áA': 23, 'FLOWER': 4,
    'GAVI√ÉO': 23, 'MKT CHILE': 0, 'MKT PERU': 0, 'MASTER': 0, 'NAVEPARK': 8,
    'OCTOPUS MS': 11, 'OCTOPUS SC': 23, 'OPTIMUS PRIME': 23, 'PBL GUATEMALA': 12,
    'PROMO B2B CD GRU': 23, 'PTL SP': 23, 'REISADO': 23, 'REVERSE': 14,
    'SUPER DIVINOPOLIS': 23, 'TITANIO': 20
};

const FASES = ['1. Kickoff', '2. Levantamento & Design', '3. Provisionamento', '4. Implanta√ß√£o', '5. Homologa√ß√£o', '6. Go Live', '7. Hypercare', '8. Encerramento'];

const ATIVIDADES_POR_FASE = {
    '1. Kickoff': ['Reuni√£o de Kickoff', 'Defini√ß√£o de Escopo'],
    '2. Levantamento & Design': ['Levantamento T√©cnico', 'Documenta√ß√£o de Arquitetura', 'Elabora√ß√£o do Cronograma'],
    '3. Provisionamento': ['Solicita√ß√£o de Acessos (VPN/IPs)', 'Aquisi√ß√£o de Equipamentos', 'Prepara√ß√£o de Ambiente'],
    '4. Implanta√ß√£o': ['Instala√ß√£o F√≠sica', 'Configura√ß√£o de Rede', 'Integra√ß√£o de Sistemas'],
    '5. Homologa√ß√£o': ['Testes Funcionais', 'Testes de Performance', 'Valida√ß√£o com Cliente'],
    '6. Go Live': ['Janela de Mudan√ßa (GMUD)', 'Migra√ß√£o para Produ√ß√£o', 'Valida√ß√£o P√≥s-Migra√ß√£o'],
    '7. Hypercare': ['Monitoramento Intensivo', 'Corre√ß√£o de Incidentes', 'Ajustes e Otimiza√ß√£o'],
    '8. Encerramento': ['Documenta√ß√£o Final', 'Treinamento/Repasse', 'Aceite Formal']
};

const TRATATIVAS = {
    'BARBECUE B2B_Reuni√£o de Kickoff': [
        { user: 'ALEX', role: 'PMO', date: '01/06/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado com sucesso. Equipe completa presente.' },
        { user: 'DAIANA', role: 'Gestora', date: '01/06/2025 14:00', type: 'comentario', content: 'Projeto priorit√°rio para B2B. Acompanhar de perto.' }
    ],
    'BARBECUE B2B_Aceite Formal': [
        { user: 'ALEX', role: 'PMO', date: '06/02/2026 10:00', type: 'resolucao', content: 'Projeto conclu√≠do com sucesso. Aceite assinado pelo cliente.' },
        { user: 'DOUGLAS', role: 'Diretor', date: '06/02/2026 14:00', type: 'comentario', content: 'Parab√©ns √† equipe pela entrega no prazo!' }
    ],
    'BELEZA_Reuni√£o de Kickoff': [
        { user: 'ANDERSON', role: 'PMO', date: '01/05/2025 09:00', type: 'atualizacao', content: 'Kickoff realizado. Escopo alinhado com stakeholders.' }
    ],
    'BELEZA_Aceite Formal': [
        { user: 'ANDERSON', role: 'PMO', date: '30/11/2025 10:00', type: 'resolucao', content: 'Projeto BELEZA conclu√≠do. Cliente satisfeito com a entrega.' }
    ],
    'BETA_Reuni√£o de Kickoff': [
        { user: 'ANDERSON', role: 'PMO', date: '01/07/2025 10:00', type: 'atualizacao', content: 'Kickoff do projeto BETA realizado no Rio de Janeiro.' },
        { user: 'DAIANA', role: 'Gestora', date: '01/07/2025 15:00', type: 'comentario', content: 'Prioridade alta. Acompanhar cronograma semanalmente.' }
    ],
    'BETA_Levantamento T√©cnico': [
        { user: 'ANDERSON', role: 'PMO', date: '15/01/2026 09:00', type: 'atualizacao', content: 'Levantamento t√©cnico em andamento. Mapeando infraestrutura atual.' }
    ],
    'DIA_Reuni√£o de Kickoff': [
        { user: 'F√ÅBIO', role: 'PMO', date: '15/09/2025 10:00', type: 'atualizacao', content: 'Kickoff realizado com cliente DIA.' }
    ],
    'DIA_Solicita√ß√£o de Acessos (VPN/IPs)': [
        { user: 'F√ÅBIO', role: 'PMO', date: '10/01/2026 09:00', type: 'alerta', content: 'Aguardando cliente liberar acessos VPN h√° 15 dias.' },
        { user: 'DAIANA', role: 'Gestora', date: '12/01/2026 14:00', type: 'comentario', content: 'Escalar para gerente comercial do cliente.' }
    ],
    'COUGAR_Aceite Formal': [
        { user: 'LEANDRO', role: 'PMO', date: '09/02/2026 10:00', type: 'resolucao', content: 'Projeto COUGAR encerrado com sucesso.' },
        { user: 'DOUGLAS', role: 'Diretor', date: '09/02/2026 15:00', type: 'comentario', content: 'Excelente trabalho da equipe!' }
    ]
};

function calcProgresso(nome) { return Math.round(((PROJETO_STATUS[nome] || 0) / 23) * 100); }

function calcStatus(nome) {
    const prog = calcProgresso(nome);
    if (prog === 100) return 'Conclu√≠do';
    if (prog === 0) return 'N√£o Iniciado';
    const proj = PROJETOS.find(p => p.nome === nome);
    if (proj && new Date(proj.dataInicio) > new Date()) return 'Aguardando';
    return 'Em andamento';
}

function calcFaseAtual(nome) {
    const a = PROJETO_STATUS[nome] || 0;
    if (a === 0) return 0;
    if (a <= 2) return 1;
    if (a <= 5) return 2;
    if (a <= 8) return 3;
    if (a <= 11) return 4;
    if (a <= 14) return 5;
    if (a <= 17) return 6;
    if (a <= 20) return 7;
    return 8;
}

function formatDate(d) { return d ? new Date(d).toLocaleDateString('pt-BR') : '-'; }
function getStatusClass(s) { return { 'Conclu√≠do': 'concluido', 'Em andamento': 'andamento', 'Aguardando': 'aguardando', 'N√£o Iniciado': 'nao-iniciado' }[s] || 'nao-iniciado'; }
function getPriorityClass(p) { return { 'Alta': 'alta', 'M√©dia': 'media', 'Baixa': 'baixa' }[p] || 'media'; }
function getProgressColor(p) { return p >= 80 ? '#22c55e' : p >= 40 ? '#f59e0b' : '#ef4444'; }

function renderProjectsList() {
    const search = document.getElementById('searchProject').value.toLowerCase();
    const st = document.getElementById('filterStatus').value;
    const pr = document.getElementById('filterPriority').value;
    const re = document.getElementById('filterResp').value;

    const filtered = PROJETOS.filter(p => {
        const status = calcStatus(p.nome);
        return (!search || p.nome.toLowerCase().includes(search)) && (!st || status === st) && (!pr || p.prioridade === pr) && (!re || p.resp === re);
    });

    document.getElementById('projectCount').textContent = filtered.length;
    document.getElementById('projectsList').innerHTML = filtered.map(p => {
        const prog = calcProgresso(p.nome), status = calcStatus(p.nome);
        return `<div class="project-item" onclick="showDetails('${p.nome}')" id="proj-${p.nome.replace(/\s+/g, '-')}">
            <div class="project-item-header"><span class="project-name">${p.nome}</span><span class="project-progress" style="color:${getProgressColor(prog)}">${prog}%</span></div>
            <div class="project-meta"><span class="badge badge-${getPriorityClass(p.prioridade)}">${p.prioridade}</span><span>üìç ${p.local}</span><span>üë§ ${p.resp}</span><span class="badge badge-${getStatusClass(status)}">${status}</span></div>
        </div>`;
    }).join('') || '<p style="padding:20px;color:#94a3b8;text-align:center;">Nenhum projeto encontrado</p>';
}

function showDetails(nome) {
    document.querySelectorAll('.project-item').forEach(el => el.classList.remove('active'));
    const projEl = document.getElementById('proj-' + nome.replace(/\s+/g, '-'));
    if (projEl) projEl.classList.add('active');

    const proj = PROJETOS.find(p => p.nome === nome);
    if (!proj) return;

    const prog = calcProgresso(nome), status = calcStatus(nome), faseAtual = calcFaseAtual(nome), atv = PROJETO_STATUS[nome] || 0;

    const timeline = FASES.map((f, i) => {
        const n = i + 1; let cls = '', c = n;
        if (n < faseAtual) { cls = 'completed'; c = '‚úì'; } else if (n === faseAtual) cls = 'current';
        return `<div class="phase-step ${cls}"><div class="phase-circle">${c}</div><div class="phase-label">${f.split('. ')[1]}</div></div>`;
    }).join('');

    let actHTML = '', idx = 0;
    FASES.forEach(fase => {
        ATIVIDADES_POR_FASE[fase].forEach(a => {
            let st = 'N√£o Iniciado', cl = 'nao-iniciado';
            if (idx < atv) { st = 'Conclu√≠do'; cl = 'concluido'; }
            else if (idx === atv) { st = new Date(proj.dataInicio) <= new Date() ? 'Em andamento' : 'Aguardando'; cl = st === 'Em andamento' ? 'andamento' : 'aguardando'; }
            const key = `${nome}_${a}`, trats = TRATATIVAS[key] || [], tc = trats.length;
            const tratHTML = tc > 0 ? trats.map(t => `<div class="tratativa-item"><div class="tratativa-top"><span class="tratativa-user">${t.user} (${t.role})</span><span class="tratativa-date">${t.date}</span></div><span class="tratativa-tipo tipo-${t.type}">${{atualizacao:'Atualiza√ß√£o',alerta:'Alerta',resolucao:'Resolu√ß√£o',comentario:'Coment√°rio'}[t.type]}</span><div class="tratativa-content">${t.content}</div></div>`).join('') : '<p class="no-tratativas">Nenhuma tratativa registrada.</p>';
            actHTML += `<div class="activity-item ${cl}" onclick="toggleTratativas(this,event)"><div class="activity-header"><div class="activity-info"><div class="activity-name">${a}</div><div class="activity-phase">${fase}</div></div><span class="badge badge-${cl}">${st}</span><span class="expand-icon">${tc > 0 ? '‚ñº' : ''}</span></div><div class="tratativas-section"><div class="tratativas-header">üí¨ Tratativas (${tc})</div>${tratHTML}</div></div>`;
            idx++;
        });
    });

    document.getElementById('detailsPanel').innerHTML = `
        <div class="details-header"><div class="details-title">${nome}</div><div class="details-meta"><span>üìç <strong>${proj.local}</strong></span><span>üë§ <strong>${proj.resp}</strong></span><span>‚ö° <span class="badge badge-${getPriorityClass(proj.prioridade)}">${proj.prioridade}</span></span><span>üìÖ ${formatDate(proj.dataInicio)} ‚Üí ${formatDate(proj.dataPrevista)}</span><span>üìà <strong>${prog}%</strong></span></div></div>
        <div class="phases-timeline"><h3>üó∫Ô∏è Progresso por Fase (${faseAtual > 0 ? FASES[faseAtual-1] : 'N√£o iniciado'})</h3><div class="phase-steps">${timeline}</div></div>
        <div class="activities-section"><h3>üìù Atividades <span class="activities-count">${atv}/23</span></h3>${actHTML}</div>`;
}

function toggleTratativas(el, e) { e.stopPropagation(); const s = el.querySelector('.tratativas-section'); if (s) { s.classList.toggle('active'); el.classList.toggle('expanded'); } }
function filterProjects() { renderProjectsList(); }
function clearFilters() { document.getElementById('searchProject').value = ''; document.getElementById('filterStatus').value = ''; document.getElementById('filterPriority').value = ''; document.getElementById('filterResp').value = ''; renderProjectsList(); }
function populateRespFilter() { const r = [...new Set(PROJETOS.map(p => p.resp))].sort(); document.getElementById('filterResp').innerHTML = '<option value="">Todos</option>' + r.map(x => `<option value="${x}">${x}</option>`).join(''); }

document.addEventListener('DOMContentLoaded', () => { populateRespFilter(); renderProjectsList(); });
</script>
</body>
</html>
