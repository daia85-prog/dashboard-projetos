<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Vis√£o Detalhada - Fases & Atividades v9</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:#e5e7eb;color:#111827;min-height:100vh}

/* TOPBAR */
.topbar{background:linear-gradient(90deg,#6366f1,#8b5cf6);padding:14px 30px;display:flex;justify-content:space-between;align-items:center;color:#fff;box-shadow:0 4px 15px rgba(99,102,241,.3)}
.topbar-title{font-size:1.1rem;font-weight:600;display:flex;align-items:center;gap:8px}
.topbar-buttons{display:flex;gap:8px}
.btn{border-radius:999px;border:none;padding:8px 18px;font-size:.85rem;font-weight:600;display:inline-flex;align-items:center;gap:6px;cursor:pointer;text-decoration:none;color:#fff;transition:all .2s}
.btn-executiva{background:#f97316}
.btn-alertas{background:#22c55e}
.btn:hover{opacity:.9;transform:translateY(-1px)}

.page{max-width:1400px;margin:20px auto 32px;padding:0 16px}

/* FILTROS */
.filters{background:#fff;border-radius:20px;padding:18px 22px;box-shadow:0 10px 30px rgba(15,23,42,.12);margin-bottom:18px;display:grid;grid-template-columns:2.2fr 1.2fr 1.2fr 1.2fr auto;gap:14px;align-items:end}
.filter-group{display:flex;flex-direction:column;gap:4px}
.filter-label{font-size:.8rem;font-weight:600;color:#6b7280;display:flex;align-items:center;gap:4px}
.filter-input,.filter-select{border-radius:999px;border:1px solid #e5e7eb;padding:10px 16px;font-size:.9rem;background:#fff;transition:all .2s}
.filter-input:focus,.filter-select:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px rgba(99,102,241,.15)}
.btn-clear{background:#ef4444;color:#fff;border-radius:999px;border:none;padding:10px 20px;font-size:.85rem;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:all .2s}
.btn-clear:hover{background:#dc2626}

/* LAYOUT PRINCIPAL */
.layout{display:grid;grid-template-columns:360px 1fr;gap:18px;align-items:flex-start}

/* COLUNA ESQUERDA - PROJETOS */
.projects-panel{background:#fff;border-radius:20px;padding:16px;box-shadow:0 10px 30px rgba(15,23,42,.12);max-height:calc(100vh - 200px);display:flex;flex-direction:column}
.projects-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding:0 6px}
.projects-header-title{font-size:.95rem;font-weight:700;display:flex;align-items:center;gap:8px;color:#111827}
.projects-header-title span{background:#eef2ff;color:#4f46e5;padding:2px 10px;border-radius:999px;font-size:.8rem}
.projects-list{overflow-y:auto;padding-right:6px;flex:1}
.projects-list::-webkit-scrollbar{width:6px}
.projects-list::-webkit-scrollbar-track{background:#f1f5f9;border-radius:10px}
.projects-list::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:10px}
.projects-list::-webkit-scrollbar-thumb:hover{background:#94a3b8}

.project-card{border-radius:14px;padding:12px 14px;margin-bottom:10px;background:#f9fafb;border:2px solid #e5e7eb;cursor:pointer;transition:all .2s;display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
.project-card:hover{border-color:#a5b4fc;box-shadow:0 6px 18px rgba(99,102,241,.15);transform:translateY(-2px)}
.project-card.active{box-shadow:0 0 0 3px #a5b4fc,0 10px 25px rgba(99,102,241,.25);border-color:#6366f1;background:#eef2ff}
.project-main{display:flex;flex-direction:column;gap:6px;flex:1}
.project-name{font-size:.95rem;font-weight:700;color:#111827}
.project-meta-line{font-size:.78rem;color:#6b7280;display:flex;flex-wrap:wrap;gap:8px;align-items:center}
.project-status-line{font-size:.75rem;display:flex;align-items:center;gap:6px;margin-top:4px}
.project-progress{font-size:.9rem;font-weight:700;color:#059669;white-space:nowrap;display:flex;flex-direction:column;align-items:flex-end;gap:2px}
.project-progress small{font-size:.7rem;color:#6b7280;font-weight:500}

.badge{display:inline-flex;align-items:center;justify-content:center;padding:3px 10px;border-radius:999px;font-size:.72rem;font-weight:600;white-space:nowrap}
.badge-prio-alta{background:#fee2e2;color:#dc2626}
.badge-prio-media{background:#fef3c7;color:#d97706}
.badge-prio-baixa{background:#dbeafe;color:#2563eb}
.badge-status-concluido{background:#dcfce7;color:#166534}
.badge-status-andamento{background:#dbeafe;color:#1e40af}
.badge-status-planejamento{background:#fef3c7;color:#92400e}
.badge-status-aguardando{background:#fee2e2;color:#b91c1c}
.badge-status-nao-iniciado{background:#f1f5f9;color:#475569}

/* PAINEL DIREITO - DETALHES */
.detail-panel{background:#fff;border-radius:20px;padding:20px 24px;box-shadow:0 10px 30px rgba(15,23,42,.12);min-height:500px}
.detail-placeholder{display:flex;flex-direction:column;align-items:center;justify-content:center;height:400px;color:#9ca3af;text-align:center}
.detail-placeholder .icon{font-size:4rem;margin-bottom:15px;opacity:.5}
.detail-placeholder .text{font-size:1rem;line-height:1.6}

.detail-header{margin-bottom:16px;padding-bottom:16px;border-bottom:3px solid #6366f1}
.detail-title{font-size:1.4rem;font-weight:700;color:#111827;margin-bottom:10px;display:flex;align-items:center;gap:10px}
.detail-title .badge{font-size:.75rem}
.detail-meta{display:flex;flex-wrap:wrap;gap:12px 20px;font-size:.85rem;color:#4b5563}
.detail-meta span{display:flex;align-items:center;gap:5px}
.detail-meta strong{color:#111827}

/* TIMELINE FASES */
.phases-block{margin:20px 0;padding:18px 20px;border-radius:16px;background:linear-gradient(135deg,#f8fafc,#f1f5f9)}
.phases-title{font-size:1rem;font-weight:600;margin-bottom:14px;display:flex;align-items:center;gap:8px;color:#1e293b}
.phase-steps{display:flex;justify-content:space-between;align-items:center;position:relative;padding:15px 0 8px}
.phase-step{flex:1;text-align:center;position:relative}
.phase-step::before{content:'';position:absolute;top:17px;left:50%;width:100%;height:4px;background:#e2e8f0;z-index:0}
.phase-step:first-child::before{left:50%;width:50%}
.phase-step:last-child::before{width:50%}
.phase-circle{width:34px;height:34px;border-radius:50%;background:#e2e8f0;margin:0 auto 8px;display:flex;align-items:center;justify-content:center;font-size:.85rem;font-weight:700;position:relative;z-index:1;transition:all .3s;border:3px solid #fff;box-shadow:0 2px 8px rgba(0,0,0,.1)}
.phase-label{font-size:.7rem;color:#64748b;font-weight:600;line-height:1.2}
.phase-step.completed .phase-circle{background:#22c55e;color:#fff}
.phase-step.completed::before{background:#22c55e}
.phase-step.current .phase-circle{background:#6366f1;color:#fff;box-shadow:0 0 0 6px rgba(99,102,241,.25),0 4px 12px rgba(99,102,241,.3);transform:scale(1.1)}

/* ATIVIDADES */
.activities-block{margin-top:20px;padding:18px 20px;border-radius:16px;background:#fff;border:1px solid #e5e7eb}
.activities-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.activities-title{font-size:1rem;font-weight:600;display:flex;align-items:center;gap:8px;color:#1e293b}
.activities-counter{display:flex;align-items:center;gap:8px}
.badge-counter{background:#eef2ff;color:#4f46e5;padding:4px 12px;border-radius:999px;font-size:.8rem;font-weight:700}
.activities-list{max-height:400px;overflow-y:auto;padding-right:8px}
.activities-list::-webkit-scrollbar{width:5px}
.activities-list::-webkit-scrollbar-track{background:#f1f5f9;border-radius:10px}
.activities-list::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:10px}

.activity-item{border-radius:12px;padding:12px 14px;margin-bottom:8px;border-left:5px solid #e5e7eb;font-size:.88rem;display:flex;justify-content:space-between;align-items:center;cursor:pointer;transition:all .2s;background:#f9fafb}
.activity-item:hover{box-shadow:0 4px 12px rgba(0,0,0,.08);transform:translateX(4px)}
.activity-main{display:flex;flex-direction:column;gap:3px;flex:1}
.activity-name{font-weight:600;color:#1e293b}
.activity-phase{font-size:.75rem;color:#64748b}
.activity-status{font-size:.72rem;padding:4px 10px;border-radius:999px;background:#e5e7eb;color:#475569;white-space:nowrap;font-weight:600}
.activity-item.status-concluido{border-left-color:#22c55e;background:#f0fdf4}
.activity-item.status-concluido .activity-status{background:#dcfce7;color:#166534}
.activity-item.status-andamento{border-left-color:#3b82f6;background:#eff6ff}
.activity-item.status-andamento .activity-status{background:#dbeafe;color:#1e40af}
.activity-item.status-aguardando{border-left-color:#f59e0b;background:#fffbeb}
.activity-item.status-aguardando .activity-status{background:#fef3c7;color:#92400e}
.activity-item.status-nao-iniciado{border-left-color:#94a3b8;background:#f8fafc}

/* MODAL TRATATIVAS */
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(15,23,42,.6);display:none;align-items:center;justify-content:center;z-index:9999;padding:20px;backdrop-filter:blur(4px)}
.modal-overlay.active{display:flex}
.modal-box{background:#fff;border-radius:20px;max-width:700px;width:100%;max-height:85vh;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 25px 60px rgba(0,0,0,.3);animation:modalIn .3s ease}
@keyframes modalIn{from{opacity:0;transform:scale(.95) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}
.modal-header{padding:20px 24px;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;display:flex;justify-content:space-between;align-items:center}
.modal-title{font-size:1.15rem;font-weight:700;display:flex;align-items:center;gap:10px}
.modal-title::before{content:'üìå';font-size:1.2rem}
.modal-close{background:rgba(255,255,255,.2);border:none;font-size:1.5rem;cursor:pointer;color:#fff;width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all .2s}
.modal-close:hover{background:rgba(255,255,255,.3);transform:rotate(90deg)}
.modal-body{padding:0;overflow-y:auto;flex:1}
.modal-info{padding:20px 24px;background:#f8fafc;border-bottom:1px solid #e5e7eb}
.modal-info-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #f1f5f9}
.modal-info-row:last-child{border-bottom:none}
.modal-info-row .label{color:#64748b;font-size:.88rem}
.modal-info-row .value{color:#1e293b;font-weight:600;font-size:.88rem;text-align:right}

.tratativas-section{padding:20px 24px}
.tratativas-header{display:flex;align-items:center;gap:10px;margin-bottom:16px;color:#1e293b;font-weight:700;font-size:1rem}
.tratativas-header::before{content:'üí¨'}
.tratativas-empty{text-align:center;padding:30px;background:#f8fafc;border-radius:12px;border:2px dashed #e5e7eb}
.tratativas-empty .icon{font-size:2.5rem;margin-bottom:10px;opacity:.5}
.tratativas-empty .msg{color:#64748b;font-size:.9rem}

.tratativa-item{background:#f8fafc;border-radius:12px;padding:16px;margin-bottom:12px;border-left:4px solid #6366f1;transition:all .2s}
.tratativa-item:hover{box-shadow:0 4px 12px rgba(0,0,0,.08)}
.tratativa-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}
.tratativa-user{display:flex;align-items:center;gap:12px}
.tratativa-avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.95rem}
.tratativa-user-info .name{font-weight:600;color:#1e293b;font-size:.9rem}
.tratativa-user-info .role{font-size:.75rem;color:#64748b;margin-top:2px}
.tratativa-date{font-size:.75rem;color:#94a3b8;text-align:right}
.tratativa-tipo{display:inline-block;padding:4px 10px;border-radius:999px;font-size:.72rem;font-weight:600;margin-bottom:10px}
.tipo-atualizacao{background:#dbeafe;color:#1e40af}
.tipo-alerta{background:#fee2e2;color:#dc2626}
.tipo-resolucao{background:#dcfce7;color:#166534}
.tipo-comentario{background:#f1f5f9;color:#475569}
.tratativa-content{color:#475569;font-size:.88rem;line-height:1.6;padding:12px;background:#fff;border-radius:8px}

.no-projects{font-size:.9rem;color:#9ca3af;font-style:italic;padding:30px;text-align:center}

.footer{text-align:center;padding:12px;font-size:.75rem;color:#9ca3af;margin-top:16px}

@media(max-width:1024px){
    .layout{grid-template-columns:1fr}
    .projects-panel{max-height:none}
    .filters{grid-template-columns:1fr 1fr}
}
@media(max-width:640px){
    .filters{grid-template-columns:1fr}
    .phase-steps{flex-wrap:wrap;gap:10px}
    .phase-step{flex:0 0 25%}
    .phase-step::before{display:none}
}
/* PRINT MODAL */
.pm-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:2000;justify-content:center;align-items:center}
.pm-overlay.show{display:flex}
.pm-box{background:#fff;border-radius:20px;padding:24px;max-width:500px;width:90%;max-height:85vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.3)}
.pm-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid #e5e7eb}
.pm-header h2{font-size:1.1rem;color:#1e293b;display:flex;align-items:center;gap:8px}
.pm-close{background:none;border:none;font-size:1.5rem;cursor:pointer;color:#94a3b8;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center}
.pm-close:hover{background:#f1f5f9;color:#475569}
.pm-opt{display:flex;align-items:center;gap:12px;padding:12px 14px;background:#f8fafc;border-radius:12px;cursor:pointer;border:2px solid transparent;transition:all .2s;margin-bottom:8px}
.pm-opt:hover{border-color:#6366f1;background:#f0f4ff}
.pm-opt.selected{border-color:#6366f1;background:#eff6ff}
.pm-opt input[type="radio"]{width:18px;height:18px;cursor:pointer;accent-color:#6366f1}
.pm-opt-text{flex:1}
.pm-opt-title{font-weight:600;color:#1e293b;font-size:.9rem}
.pm-opt-desc{font-size:.78rem;color:#6b7280;margin-top:2px}
.pm-list{max-height:200px;overflow-y:auto;border:1px solid #e2e8f0;border-radius:12px;padding:10px;margin-top:8px;display:none}
.pm-list.show{display:block}
.pm-item{display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px;cursor:pointer;font-size:.85rem}
.pm-item:hover{background:#f1f5f9}
.pm-item input{width:16px;height:16px;accent-color:#6366f1}
.pm-btns{display:none;gap:8px;margin-top:8px}
.pm-btns.show{display:flex}
.pm-btns button{flex:1;padding:8px;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:.82rem}
.pm-btn-ok{background:#22c55e;color:#fff}
.pm-btn-no{background:#ef4444;color:#fff}
.pm-footer{display:flex;gap:10px;margin-top:16px;padding-top:12px;border-top:1px solid #e5e7eb}
.pm-footer button{flex:1;padding:12px;border:none;border-radius:12px;font-weight:600;cursor:pointer;font-size:.9rem;transition:all .2s}
.pm-cancel{background:#f1f5f9;color:#64748b}
.pm-cancel:hover{background:#e2e8f0}
.pm-exec{background:#6366f1;color:#fff}
.pm-exec:hover{background:#4f46e5}

@media print {
    * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color-adjust: exact !important; }
    body { background: white !important; margin: 0 !important; padding: 0 !important; }
    .topbar { padding: 10px 20px !important; }
    .topbar-buttons { display: none !important; }
    .filters { display: none !important; }
    .page { padding: 10px !important; margin: 0 !important; }
    .projects-panel { display: none !important; }
    .layout { grid-template-columns: 1fr !important; }
    .detail-panel { box-shadow: none !important; border-radius: 0 !important; }
    .phase-card { break-inside: avoid; margin-bottom: 10px !important; }
    .phase-step { break-inside: avoid; }
    .modal-overlay { display: none !important; }
    .pm-overlay { display: none !important; }
    .detail-header { break-after: avoid; }
}
</style>
</head>
<body>

<div class="topbar">
    <div class="topbar-title">üìã Vis√£o Detalhada - Fases & Atividades</div>
    <div class="topbar-buttons">
        <a href="index.html" class="btn btn-executiva">üè† Vis√£o Executiva</a>
        <a href="view-projetos.html" class="btn btn-alertas">üö® Alertas</a>
        <a href="view-simples.html" class="btn" style="background:#f59e0b">üìÑ Resumida</a>
        <button class="btn" style="background:#22c55e" onclick="abrirPrintModal()">üñ®Ô∏è Imprimir / PDF</button>
    </div>
</div>

<div class="page">
    <!-- FILTROS -->
    <div class="filters">
        <div class="filter-group">
            <label class="filter-label">üîç Buscar Projeto</label>
            <input id="filterBusca" class="filter-input" type="text" placeholder="Nome do projeto..." oninput="renderLista()">
        </div>
        <div class="filter-group">
            <label class="filter-label">üìä Status</label>
            <select id="filterStatus" class="filter-select" onchange="renderLista()">
                <option value="">Todos</option>
                <option value="Conclu√≠do">Conclu√≠do</option>
                <option value="Em andamento">Em andamento</option>
                <option value="Planejamento">Planejamento</option>
                <option value="Aguardando">Aguardando</option>
                <option value="N√£o Iniciado">N√£o Iniciado</option>
            </select>
        </div>
        <div class="filter-group">
            <label class="filter-label">‚ö° Prioridade</label>
            <select id="filterPrioridade" class="filter-select" onchange="renderLista()">
                <option value="">Todas</option>
                <option value="Alta">Alta</option>
                <option value="M√©dia">M√©dia</option>
                <option value="Baixa">Baixa</option>
            </select>
        </div>
        <div class="filter-group">
            <label class="filter-label">üë§ Respons√°vel</label>
            <select id="filterResp" class="filter-select" onchange="renderLista()">
                <option value="">Todos</option>
                <option value="ALEX">ALEX</option>
                <option value="ANDERSON">ANDERSON</option>
                <option value="F√ÅBIO">F√ÅBIO</option>
                <option value="GIOVANNI">GIOVANNI</option>
                <option value="LEANDRO">LEANDRO</option>
                <option value="VINICIUS">VINICIUS</option>
            </select>
        </div>
        <div class="filter-group">
            <button type="button" class="btn-clear" onclick="limparFiltros()">üóëÔ∏è Limpar</button>
        </div>
    </div>

    <!-- LAYOUT PRINCIPAL -->
    <div class="layout">
        <!-- ESQUERDA: PROJETOS -->
        <div class="projects-panel">
            <div class="projects-header">
                <div class="projects-header-title">üìÅ Projetos <span id="countProjetos">0</span></div>
            </div>
            <div id="listaProjetos" class="projects-list"></div>
        </div>

        <!-- DIREITA: DETALHES -->
        <div class="detail-panel">
            <div id="detailEmpty" class="detail-placeholder">
                <div class="icon">üëÜ</div>
                <div class="text">Selecione um projeto √† esquerda<br>para ver as <strong>8 fases</strong> e <strong>23 atividades</strong></div>
            </div>

            <div id="detailContent" style="display:none;">
                <!-- HEADER -->
                <div class="detail-header">
                    <div class="detail-title">
                        <span id="detNomeProjeto">PROJETO</span>
                        <span class="badge badge-prio-alta" id="detPrioBadge">Alta</span>
                    </div>
                    <div class="detail-meta">
                        <span>üìç <strong id="detLocal"></strong></span>
                        <span>üë§ <strong id="detResp"></strong></span>
                        <span>üìÖ <strong id="detPeriodo"></strong></span>
                        <span>üìä <strong id="detStatus"></strong></span>
                        <span>üìà <strong id="detProg"></strong></span>
                    </div>
                </div>

                <!-- FASES -->
                <div class="phases-block">
                    <div class="phases-title">üó∫Ô∏è Progresso por Fase</div>
                    <div class="phase-steps" id="timelineFases">
                        <div class="phase-step" data-fase="1">
                            <div class="phase-circle">1</div>
                            <div class="phase-label">Kickoff</div>
                        </div>
                        <div class="phase-step" data-fase="2">
                            <div class="phase-circle">2</div>
                            <div class="phase-label">Levantamento</div>
                        </div>
                        <div class="phase-step" data-fase="3">
                            <div class="phase-circle">3</div>
                            <div class="phase-label">Provis√£o</div>
                        </div>
                        <div class="phase-step" data-fase="4">
                            <div class="phase-circle">4</div>
                            <div class="phase-label">Implanta√ß√£o</div>
                        </div>
                        <div class="phase-step" data-fase="5">
                            <div class="phase-circle">5</div>
                            <div class="phase-label">Homologa√ß√£o</div>
                        </div>
                        <div class="phase-step" data-fase="6">
                            <div class="phase-circle">6</div>
                            <div class="phase-label">Go Live</div>
                        </div>
                        <div class="phase-step" data-fase="7">
                            <div class="phase-circle">7</div>
                            <div class="phase-label">Hypercare</div>
                        </div>
                        <div class="phase-step" data-fase="8">
                            <div class="phase-circle">8</div>
                            <div class="phase-label">Encerramento</div>
                        </div>
                    </div>
                </div>

                <!-- ATIVIDADES -->
                <div class="activities-block">
                    <div class="activities-header">
                        <div class="activities-title">üìã Atividades do Projeto</div>
                        <div class="activities-counter">
                            <span class="badge-counter" id="ativCount">0/23</span>
                        </div>
                    </div>
                    <div id="listaAtividades" class="activities-list"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">Vis√£o Detalhada v9 ¬∑ Invent Corp ¬∑ Dashboard de Infraestrutura</div>
</div>

<!-- MODAL TRATATIVAS -->
<div id="modalTratativas" class="modal-overlay" onclick="fecharModal(event)">
    <div class="modal-box" onclick="event.stopPropagation()">
        <div class="modal-header">
            <div class="modal-title" id="modalAtivNome">Atividade</div>
            <button class="modal-close" onclick="fecharModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="modal-info" id="modalAtivInfo"></div>
            <div class="tratativas-section">
                <div class="tratativas-header">Hist√≥rico de Tratativas</div>
                <div id="modalTratativasBody"></div>
            </div>
        </div>
    </div>
</div>

<script>
// ========== DADOS (30 Projetos) ==========
const PROJETOS = [
    { nome:'BARBECUE B2B', local:'S√£o Paulo - SP', resp:'ALEX', prioridade:'Alta', inicio:'2025-06-01', fim:'2026-02-06' },
    { nome:'BELEZA', local:'S√£o Paulo - SP', resp:'ANDERSON', prioridade:'M√©dia', inicio:'2025-05-01', fim:'2025-11-30' },
    { nome:'BETA', local:'Rio de Janeiro - RJ', resp:'ANDERSON', prioridade:'Alta', inicio:'2025-07-01', fim:'2026-03-10' },
    { nome:'BETA ESTEIO', local:'Esteio - RS', resp:'ANDERSON', prioridade:'M√©dia', inicio:'2026-01-30', fim:'2026-08-17' },
    { nome:'BP', local:'S√£o Paulo - SP', resp:'GIOVANNI', prioridade:'M√©dia', inicio:'2025-12-01', fim:'2026-06-30' },
    { nome:'BR', local:'Jaboat√£o - PE', resp:'F√ÅBIO', prioridade:'Alta', inicio:'2026-01-30', fim:'2026-08-01' },
    { nome:'CANDELABRIA', local:'Candel√°ria - RS', resp:'ALEX', prioridade:'M√©dia', inicio:'2025-06-01', fim:'2025-12-09' },
    { nome:'CDSK', local:'S√£o Paulo - SP', resp:'VINICIUS', prioridade:'Alta', inicio:'2025-08-01', fim:'2026-02-28' },
    { nome:'COUGAR', local:'S√£o Paulo - SP', resp:'LEANDRO', prioridade:'Alta', inicio:'2025-05-01', fim:'2026-02-09' },
    { nome:'CRISTAL MG RETROFIT', local:'Belo Horizonte - MG', resp:'GIOVANNI', prioridade:'Alta', inicio:'2025-12-16', fim:'2026-05-30' },
    { nome:'DIA', local:'S√£o Paulo - SP', resp:'ANDERSON', prioridade:'Alta', inicio:'2025-09-01', fim:'2026-01-15' },
    { nome:'DIAMANTE', local:'Curitiba - PR', resp:'F√ÅBIO', prioridade:'M√©dia', inicio:'2026-02-15', fim:'2026-08-15' },
    { nome:'ELETRO', local:'S√£o Paulo - SP', resp:'GIOVANNI', prioridade:'M√©dia', inicio:'2025-10-01', fim:'2026-04-30' },
    { nome:'ESPERAN√áA', local:'Belo Horizonte - MG', resp:'VINICIUS', prioridade:'M√©dia', inicio:'2025-04-01', fim:'2026-01-19' },
    { nome:'FLOWER', local:'S√£o Paulo - SP', resp:'ANDERSON', prioridade:'Baixa', inicio:'2025-12-01', fim:'2026-06-30' },
    { nome:'GAVI√ÉO', local:'Fortaleza - CE', resp:'F√ÅBIO', prioridade:'Alta', inicio:'2025-05-01', fim:'2026-02-01' },
    { nome:'MKT CHILE', local:'Santiago - Chile', resp:'ALEX', prioridade:'M√©dia', inicio:'2026-06-01', fim:'2026-12-01' },
    { nome:'MKT PERU', local:'Lima - Peru', resp:'ALEX', prioridade:'M√©dia', inicio:'2026-01-30', fim:'2026-12-01' },
    { nome:'MASTER', local:'S√£o Paulo - SP', resp:'LEANDRO', prioridade:'Alta', inicio:'2026-03-01', fim:'2026-09-01' },
    { nome:'NAVEPARK', local:'Curitiba - PR', resp:'ANDERSON', prioridade:'M√©dia', inicio:'2025-12-16', fim:'2026-06-23' },
    { nome:'OCTOPUS MS', local:'Campo Grande - MS', resp:'ALEX', prioridade:'M√©dia', inicio:'2025-10-01', fim:'2026-04-30' },
    { nome:'OCTOPUS SC', local:'Florian√≥polis - SC', resp:'ALEX', prioridade:'M√©dia', inicio:'2025-06-01', fim:'2025-12-15' },
    { nome:'OPTIMUS PRIME', local:'S√£o Paulo - SP', resp:'GIOVANNI', prioridade:'Alta', inicio:'2025-04-01', fim:'2025-10-27' },
    { nome:'PBL GUATEMALA', local:'Guatemala City', resp:'F√ÅBIO', prioridade:'Alta', inicio:'2025-12-30', fim:'2026-05-15' },
    { nome:'PROMO B2B CD GRU', local:'Guarulhos - SP', resp:'LEANDRO', prioridade:'Alta', inicio:'2025-07-01', fim:'2026-02-04' },
    { nome:'PTL SP', local:'S√£o Paulo - SP', resp:'VINICIUS', prioridade:'M√©dia', inicio:'2025-04-01', fim:'2025-10-30' },
    { nome:'REISADO', local:'Recife - PE', resp:'F√ÅBIO', prioridade:'M√©dia', inicio:'2025-06-01', fim:'2025-12-20' },
    { nome:'REVERSE', local:'S√£o Paulo - SP', resp:'ALEX', prioridade:'Alta', inicio:'2025-09-01', fim:'2026-03-15' },
    { nome:'SUPER DIVINOPOLIS', local:'Divin√≥polis - MG', resp:'GIOVANNI', prioridade:'M√©dia', inicio:'2025-10-01', fim:'2026-04-30' },
    { nome:'TITANIO', local:'S√£o Paulo - SP', resp:'ALEX', prioridade:'Alta', inicio:'2025-07-01', fim:'2026-02-28' }
];

// ========== 23 ATIVIDADES PADR√ÉO ==========
const ATIVIDADES_PADRAO = [
    { fase:'1. Kickoff', nome:'Reuni√£o de Kickoff' },
    { fase:'1. Kickoff', nome:'Defini√ß√£o de Escopo' },
    { fase:'2. Levantamento & Design', nome:'Levantamento T√©cnico' },
    { fase:'2. Levantamento & Design', nome:'Documenta√ß√£o de Arquitetura' },
    { fase:'2. Levantamento & Design', nome:'Elabora√ß√£o do Cronograma' },
    { fase:'3. Provisionamento', nome:'Solicita√ß√£o de Acessos (VPN/IPs)' },
    { fase:'3. Provisionamento', nome:'Aquisi√ß√£o de Equipamentos' },
    { fase:'3. Provisionamento', nome:'Prepara√ß√£o de Ambiente' },
    { fase:'4. Implanta√ß√£o', nome:'Instala√ß√£o F√≠sica' },
    { fase:'4. Implanta√ß√£o', nome:'Configura√ß√£o de Rede' },
    { fase:'4. Implanta√ß√£o', nome:'Integra√ß√£o de Sistemas' },
    { fase:'5. Homologa√ß√£o', nome:'Testes Funcionais' },
    { fase:'5. Homologa√ß√£o', nome:'Testes de Performance' },
    { fase:'5. Homologa√ß√£o', nome:'Valida√ß√£o com Cliente' },
    { fase:'6. Go Live', nome:'Janela de Mudan√ßa (GMUD)' },
    { fase:'6. Go Live', nome:'Migra√ß√£o para Produ√ß√£o' },
    { fase:'6. Go Live', nome:'Valida√ß√£o P√≥s-Migra√ß√£o' },
    { fase:'7. Hypercare', nome:'Monitoramento Intensivo' },
    { fase:'7. Hypercare', nome:'Corre√ß√£o de Incidentes' },
    { fase:'7. Hypercare', nome:'Ajustes e Otimiza√ß√£o' },
    { fase:'8. Encerramento', nome:'Documenta√ß√£o Final' },
    { fase:'8. Encerramento', nome:'Treinamento/Repasse' },
    { fase:'8. Encerramento', nome:'Aceite Formal' }
];

// ========== TRATATIVAS (exemplo com dados reais) ==========
const TRATATIVAS = {
    'BARBECUE B2B_Reuni√£o de Kickoff': [
        { user:'ALEX', role:'PMO', date:'01/06/2025 09:00', tipo:'Atualiza√ß√£o', content:'Kickoff realizado com sucesso. Equipe completa presente. Definidos os principais marcos do projeto.' },
        { user:'DAIANA', role:'Gestora', date:'01/06/2025 14:00', tipo:'Coment√°rio', content:'Projeto priorit√°rio para B2B. Acompanhar de perto o cronograma.' }
    ],
    'BARBECUE B2B_Aceite Formal': [
        { user:'ALEX', role:'PMO', date:'06/02/2026 10:00', tipo:'Resolu√ß√£o', content:'Projeto conclu√≠do com sucesso! Aceite formal assinado pelo cliente. Parab√©ns √† equipe!' }
    ],
    'BETA_Reuni√£o de Kickoff': [
        { user:'ANDERSON', role:'PMO', date:'01/07/2025 10:00', tipo:'Atualiza√ß√£o', content:'Kickoff do projeto BETA realizado no Rio de Janeiro. Stakeholders alinhados.' },
        { user:'DAIANA', role:'Gestora', date:'01/07/2025 14:30', tipo:'Coment√°rio', content:'Projeto estrat√©gico. Manter comunica√ß√£o frequente com o cliente.' }
    ],
    'BETA_Levantamento T√©cnico': [
        { user:'ANDERSON', role:'PMO', date:'15/01/2026 09:00', tipo:'Atualiza√ß√£o', content:'Levantamento t√©cnico em andamento. Mapeando infraestrutura atual do cliente.' }
    ],
    'BP_Reuni√£o de Kickoff': [
        { user:'GIOVANNI', role:'PMO', date:'01/12/2025 09:00', tipo:'Atualiza√ß√£o', content:'Kickoff realizado. Cliente BP presente com equipe de TI.' }
    ],
    'BP_Levantamento T√©cnico': [
        { user:'GIOVANNI', role:'PMO', date:'20/01/2026 10:00', tipo:'Atualiza√ß√£o', content:'Levantamento em andamento. Identificados 3 sites para migra√ß√£o.' }
    ],
    'BR_Reuni√£o de Kickoff': [
        { user:'F√ÅBIO', role:'PMO', date:'01/02/2026 09:00', tipo:'Atualiza√ß√£o', content:'Kickoff realizado em Jaboat√£o-PE. Equipe local mobilizada.' },
        { user:'DAIANA', role:'Gestora', date:'01/02/2026 15:00', tipo:'Alerta', content:'ATEN√á√ÉO: Log√≠stica para o Nordeste requer planejamento antecipado.' }
    ],
    'DIA_Solicita√ß√£o de Acessos (VPN/IPs)': [
        { user:'ANDERSON', role:'PMO', date:'15/01/2026 10:00', tipo:'Alerta', content:'ATEN√á√ÉO: Aguardando libera√ß√£o de VPN pelo cliente h√° 5 dias.' },
        { user:'DAIANA', role:'Gestora', date:'15/01/2026 11:30', tipo:'Coment√°rio', content:'Escalar para gerente de TI do cliente. Prazo impactando cronograma.' }
    ],
    'PBL GUATEMALA_Testes Funcionais': [
        { user:'F√ÅBIO', role:'PMO', date:'25/01/2026 10:00', tipo:'Atualiza√ß√£o', content:'Testes iniciados. 40% dos cen√°rios executados com sucesso.' },
        { user:'F√ÅBIO', role:'PMO', date:'28/01/2026 15:30', tipo:'Alerta', content:'Bug cr√≠tico identificado na integra√ß√£o com ERP. Equipe de dev acionada.' },
        { user:'F√ÅBIO', role:'PMO', date:'30/01/2026 11:00', tipo:'Resolu√ß√£o', content:'Bug corrigido. Testes retomados. Cronograma mantido.' }
    ],
    'COUGAR_Aceite Formal': [
        { user:'LEANDRO', role:'PMO', date:'09/02/2026 10:00', tipo:'Resolu√ß√£o', content:'Projeto COUGAR conclu√≠do! Cliente extremamente satisfeito. Aceite assinado.' }
    ],
    'CRISTAL MG RETROFIT_Instala√ß√£o F√≠sica': [
        { user:'GIOVANNI', role:'PMO', date:'20/01/2026 14:00', tipo:'Atualiza√ß√£o', content:'Instala√ß√£o em andamento em BH. 2 de 4 racks montados.' },
        { user:'GIOVANNI', role:'PMO', date:'25/01/2026 09:00', tipo:'Alerta', content:'Atraso na entrega de switches. Novo prazo: 28/01.' }
    ],
    'REVERSE_Documenta√ß√£o de Arquitetura': [
        { user:'ALEX', role:'PMO', date:'10/01/2026 10:00', tipo:'Atualiza√ß√£o', content:'Documenta√ß√£o 70% conclu√≠da. Aguardando valida√ß√£o do cliente.' }
    ],
    'TITANIO_Configura√ß√£o de Rede': [
        { user:'ALEX', role:'PMO', date:'15/01/2026 09:00', tipo:'Atualiza√ß√£o', content:'Configura√ß√£o de rede iniciada. VLANs definidas.' },
        { user:'ALEX', role:'PMO', date:'20/01/2026 16:00', tipo:'Resolu√ß√£o', content:'Configura√ß√£o conclu√≠da. Testes de conectividade OK.' }
    ]
};

// ========== PROJETOS CONCLU√çDOS ==========
const CONCLUIDOS = [
    'BARBECUE B2B','BELEZA','CANDELABRIA','CDSK','COUGAR','ESPERAN√áA',
    'GAVI√ÉO','OCTOPUS SC','OPTIMUS PRIME','PROMO B2B CD GRU',
    'PTL SP','REISADO','SUPER DIVINOPOLIS'
];

// ========== ELEMENTOS DOM ==========
const elLista = document.getElementById('listaProjetos');
const elCount = document.getElementById('countProjetos');
const elEmpty = document.getElementById('detailEmpty');
const elDetail = document.getElementById('detailContent');
const elNome = document.getElementById('detNomeProjeto');
const elLocal = document.getElementById('detLocal');
const elResp = document.getElementById('detResp');
const elPeriodo = document.getElementById('detPeriodo');
const elStatus = document.getElementById('detStatus');
const elProg = document.getElementById('detProg');
const elPrioBadge = document.getElementById('detPrioBadge');
const elAtivCount = document.getElementById('ativCount');
const elListaAtiv = document.getElementById('listaAtividades');

const fBusca = document.getElementById('filterBusca');
const fStatus = document.getElementById('filterStatus');
const fPrio = document.getElementById('filterPrioridade');
const fResp = document.getElementById('filterResp');

let projetoAtual = null;

// ========== FUN√á√ïES ==========
function calcularStatusEProgresso(p) {
    if (CONCLUIDOS.includes(p.nome)) {
        return { status: 'Conclu√≠do', prog: 100 };
    }
    
    const hoje = new Date();
    const inicio = new Date(p.inicio);
    const fim = new Date(p.fim);
    
    if (hoje < inicio) {
        return { status: 'N√£o Iniciado', prog: 0 };
    }
    
    if (hoje > fim) {
        return { status: 'Aguardando', prog: 65 };
    }
    
    // Calcular progresso baseado no tempo
    const total = fim - inicio;
    const decorrido = hoje - inicio;
    const prog = Math.min(95, Math.max(5, Math.round((decorrido / total) * 100)));
    
    return { status: 'Em andamento', prog };
}

function renderLista() {
    const termo = (fBusca.value || '').trim().toLowerCase();
    const st = fStatus.value;
    const prio = fPrio.value;
    const resp = fResp.value;

    const filtrados = PROJETOS.filter(p => {
        const { status } = calcularStatusEProgresso(p);
        if (termo && !p.nome.toLowerCase().includes(termo)) return false;
        if (st && st !== status) return false;
        if (prio && prio !== p.prioridade) return false;
        if (resp && resp !== p.resp) return false;
        p._status = status;
        return true;
    });

    elCount.textContent = filtrados.length;

    if (!filtrados.length) {
        elLista.innerHTML = '<div class="no-projects">Nenhum projeto encontrado com os filtros atuais.</div>';
        elEmpty.style.display = 'flex';
        elDetail.style.display = 'none';
        return;
    }

    elLista.innerHTML = filtrados.map(p => {
        const { prog, status } = calcularStatusEProgresso(p);
        const prioClass = p.prioridade === 'Alta' ? 'badge-prio-alta' : p.prioridade === 'M√©dia' ? 'badge-prio-media' : 'badge-prio-baixa';
        const statusClass = status === 'Conclu√≠do' ? 'badge-status-concluido' : 
                           status === 'Em andamento' ? 'badge-status-andamento' : 
                           status === 'Aguardando' ? 'badge-status-aguardando' : 'badge-status-nao-iniciado';
        const isActive = projetoAtual === p.nome ? 'active' : '';

        return `
            <div class="project-card ${isActive}" data-proj="${p.nome}" onclick="selecionarProjeto('${p.nome}')">
                <div class="project-main">
                    <div class="project-name">${p.nome}</div>
                    <div class="project-meta-line">
                        <span>üìç ${p.local}</span>
                        <span>üë§ ${p.resp}</span>
                    </div>
                    <div class="project-status-line">
                        <span class="badge ${prioClass}">${p.prioridade}</span>
                        <span class="badge ${statusClass}">${status}</span>
                    </div>
                </div>
                <div class="project-progress">
                    ${prog}%
                    <small>${status === 'Conclu√≠do' ? '‚úì' : 'progresso'}</small>
                </div>
            </div>
        `;
    }).join('');
}

function selecionarProjeto(nomeProj) {
    projetoAtual = nomeProj;

    document.querySelectorAll('.project-card').forEach(card => {
        card.classList.toggle('active', card.getAttribute('data-proj') === nomeProj);
    });

    const p = PROJETOS.find(x => x.nome === nomeProj);
    if (!p) return;

    const { status, prog } = calcularStatusEProgresso(p);

    elNome.textContent = p.nome;
    elLocal.textContent = p.local;
    elResp.textContent = p.resp;
    elPeriodo.textContent = `${formatarDataBR(p.inicio)} ‚Üí ${formatarDataBR(p.fim)}`;
    elStatus.textContent = status;
    elProg.textContent = `${prog}% conclu√≠do`;

    // Badge prioridade
    const prioClass = p.prioridade === 'Alta' ? 'badge-prio-alta' : p.prioridade === 'M√©dia' ? 'badge-prio-media' : 'badge-prio-baixa';
    elPrioBadge.className = `badge ${prioClass}`;
    elPrioBadge.textContent = p.prioridade;

    // Timeline de fases
    const faseIdx = status === 'Conclu√≠do' ? 8 : (prog <= 0 ? 1 : Math.min(8, Math.ceil((prog / 100) * 8)));
    atualizarTimelineFases(faseIdx);

    // Atividades
    renderAtividades(status, prog);

    elEmpty.style.display = 'none';
    elDetail.style.display = 'block';
}

function atualizarTimelineFases(idxAtual) {
    const steps = document.querySelectorAll('#timelineFases .phase-step');
    steps.forEach((step, idx) => {
        step.classList.remove('completed', 'current');
        const n = idx + 1;
        if (n < idxAtual) {
            step.classList.add('completed');
            step.querySelector('.phase-circle').textContent = '‚úì';
        } else {
            step.querySelector('.phase-circle').textContent = n;
        }
        if (n === idxAtual) step.classList.add('current');
    });
}

function renderAtividades(statusProjeto, prog) {
    const atividades = ATIVIDADES_PADRAO;
    
    // Calcular quantas atividades est√£o conclu√≠das baseado no progresso
    let ativConcluidas = 0;
    if (statusProjeto === 'Conclu√≠do') {
        ativConcluidas = 23;
    } else {
        ativConcluidas = Math.floor((prog / 100) * 23);
    }
    
    elAtivCount.textContent = `${ativConcluidas}/23`;

    elListaAtiv.innerHTML = atividades.map((a, idx) => {
        let status = 'N√£o Iniciado';
        let statusClass = 'status-nao-iniciado';
        
        if (statusProjeto === 'Conclu√≠do' || idx < ativConcluidas) {
            status = 'Conclu√≠do';
            statusClass = 'status-concluido';
        } else if (idx === ativConcluidas) {
            status = 'Em andamento';
            statusClass = 'status-andamento';
        } else if (idx === ativConcluidas + 1) {
            status = 'Aguardando';
            statusClass = 'status-aguardando';
        }

        return `
            <div class="activity-item ${statusClass}" onclick="abrirTratativas('${a.nome}', '${a.fase}', '${status}')">
                <div class="activity-main">
                    <div class="activity-name">${a.nome}</div>
                    <div class="activity-phase">${a.fase}</div>
                </div>
                <div class="activity-status">${status}</div>
            </div>
        `;
    }).join('');
}

function abrirTratativas(nomeAtiv, fase, status) {
    if (!projetoAtual) return;

    const key = `${projetoAtual}_${nomeAtiv}`;
    const tratativas = TRATATIVAS[key] || [];
    const p = PROJETOS.find(x => x.nome === projetoAtual);

    document.getElementById('modalAtivNome').textContent = nomeAtiv;
    
    // Info da atividade
    document.getElementById('modalAtivInfo').innerHTML = `
        <div class="modal-info-row"><span class="label">Projeto</span><span class="value">${projetoAtual}</span></div>
        <div class="modal-info-row"><span class="label">Fase</span><span class="value">${fase}</span></div>
        <div class="modal-info-row"><span class="label">Respons√°vel</span><span class="value">${p.resp}</span></div>
        <div class="modal-info-row"><span class="label">Status</span><span class="value">${status}</span></div>
    `;

    // Tratativas
    const modalBody = document.getElementById('modalTratativasBody');
    
    if (!tratativas.length) {
        modalBody.innerHTML = `
            <div class="tratativas-empty">
                <div class="icon">üì≠</div>
                <div class="msg">Nenhuma tratativa registrada para esta atividade.</div>
            </div>
        `;
    } else {
        modalBody.innerHTML = tratativas.map(t => {
            const tipoClass = `tipo-${t.tipo.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'')}`;
            return `
                <div class="tratativa-item">
                    <div class="tratativa-header">
                        <div class="tratativa-user">
                            <div class="tratativa-avatar">${t.user.charAt(0)}</div>
                            <div class="tratativa-user-info">
                                <div class="name">${t.user}</div>
                                <div class="role">${t.role}</div>
                            </div>
                        </div>
                        <div class="tratativa-date">${t.date}</div>
                    </div>
                    <span class="tratativa-tipo ${tipoClass}">${getTipoIcon(t.tipo)} ${t.tipo}</span>
                    <div class="tratativa-content">${t.content}</div>
                </div>
            `;
        }).join('');
    }

    document.getElementById('modalTratativas').classList.add('active');
}

function getTipoIcon(tipo) {
    const icons = { 'Atualiza√ß√£o': 'üìù', 'Alerta': '‚ö†Ô∏è', 'Resolu√ß√£o': '‚úÖ', 'Coment√°rio': 'üí¨' };
    return icons[tipo] || 'üìå';
}

function fecharModal(event) {
    if (!event || event.target.id === 'modalTratativas') {
        document.getElementById('modalTratativas').classList.remove('active');
    }
}

function formatarDataBR(iso) {
    if (!iso) return '--';
    const d = new Date(iso);
    if (isNaN(d)) return iso;
    return d.toLocaleDateString('pt-BR');
}

function limparFiltros() {
    fBusca.value = '';
    fStatus.value = '';
    fPrio.value = '';
    fResp.value = '';
    projetoAtual = null;
    renderLista();
    elEmpty.style.display = 'flex';
    elDetail.style.display = 'none';
}

// Tecla ESC fecha modal
document.addEventListener('keydown', e => {
    if (e.key === 'Escape') fecharModal();
});

// Inicializar
renderLista();

// === PRINT MODAL ===
function abrirPrintModal(){
  document.getElementById('pmList').innerHTML=PROJETOS.map(p=>`<label class="pm-item"><input type="checkbox" value="${p.nome}" checked> ${p.nome}</label>`).join('');
  document.getElementById('pmOverlay').classList.add('show');
}
function fecharPrintModal(){document.getElementById('pmOverlay').classList.remove('show')}
function pmSelOpcao(el,tipo){
  document.querySelectorAll('.pm-opt').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');el.querySelector('input').checked=true;
  document.getElementById('pmList').classList.toggle('show',tipo==='especificos');
  document.getElementById('pmBtns').classList.toggle('show',tipo==='especificos');
}
function pmMarcar(m){document.querySelectorAll('#pmList input[type="checkbox"]').forEach(cb=>cb.checked=m)}
function pmExecutar(){
  const tipo=document.querySelector('input[name="pmType"]:checked').value;
  let proj=[];
  if(tipo==='filtro'){
    const t=(fBusca.value||'').trim().toLowerCase(),sf=fStatus.value,pf=fPrio.value,rf=fResp.value;
    proj=PROJETOS.filter(p=>{
      if(t&&!p.nome.toLowerCase().includes(t))return false;
      if(sf&&p.status!==sf)return false;if(pf&&p.prioridade!==pf)return false;if(rf&&p.resp!==rf)return false;return true;
    });
  }
  else if(tipo==='todos')proj=PROJETOS;
  else if(tipo==='criticos')proj=PROJETOS.filter(p=>p.prioridade==='Alta');
  else{const cks=document.querySelectorAll('#pmList input:checked');proj=PROJETOS.filter(p=>[...cks].some(c=>c.value===p.nome))}
  if(!proj.length){alert('Nenhum projeto selecionado!');return}
  fecharPrintModal();
  const w=window.open('','_blank');
  w.document.write(`<!DOCTYPE html><html><head><title>Vis√£o Detalhada</title><style>
    body{font-family:system-ui,sans-serif;padding:25px;max-width:950px;margin:0 auto}
    h1{color:#6366f1;text-align:center;border-bottom:3px solid #6366f1;padding-bottom:12px;font-size:1.3em}
    .proj{border:1px solid #e2e8f0;border-radius:10px;padding:14px;margin:12px 0;page-break-inside:avoid}
    .proj-name{font-weight:700;font-size:1.05em;margin-bottom:6px;color:#1e293b}
    .proj-meta{font-size:.82em;color:#64748b;margin-bottom:8px}
    .fase{margin:6px 0;padding:8px;background:#f8fafc;border-radius:8px;border-left:3px solid #6366f1}
    .fase-name{font-weight:600;font-size:.85em;color:#475569}
    .fase-ativs{font-size:.78em;color:#6b7280;margin-top:3px}
    @media print{body{padding:10px}*{-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important}}
  </style></head><body><h1>üìã Vis√£o Detalhada - Fases & Atividades</h1>`);
  proj.forEach(p=>{
    w.document.write(`<div class="proj"><div class="proj-name">${p.nome}</div><div class="proj-meta">üìç ${p.local} ¬∑ üë§ ${p.resp} ¬∑ ‚ö° ${p.prioridade} ¬∑ üìÖ ${p.inicio} ‚Üí ${p.fim}</div>`);
    const fases=['1. Kickoff','2. Levantamento & Design','3. Provisionamento','4. Implanta√ß√£o','5. Homologa√ß√£o','6. Go Live','7. Hypercare','8. Encerramento'];
    fases.forEach(f=>{
      const ativs=ATIVIDADES_PADRAO.filter(a=>a.fase===f);
      if(ativs.length)w.document.write(`<div class="fase"><div class="fase-name">${f}</div><div class="fase-ativs">${ativs.map(a=>a.nome).join(' ¬∑ ')}</div></div>`);
    });
    w.document.write('</div>');
  });
  w.document.write(`<p style="color:#94a3b8;text-align:center;margin-top:20px;font-size:.8em">Gerado em ${new Date().toLocaleString('pt-BR')} ¬∑ Invent Corp</p></body></html>`);
  w.document.close();setTimeout(()=>w.print(),400);
}
</script>

<!-- PRINT MODAL -->
<div class="pm-overlay" id="pmOverlay" onclick="if(event.target===this)fecharPrintModal()">
  <div class="pm-box">
    <div class="pm-header"><h2>üñ®Ô∏è Imprimir</h2><button class="pm-close" onclick="fecharPrintModal()">√ó</button></div>
    <label class="pm-opt selected" onclick="pmSelOpcao(this,'filtro')"><input type="radio" name="pmType" value="filtro" checked><div class="pm-opt-text"><div class="pm-opt-title">üìã Filtro Atual</div><div class="pm-opt-desc">Projetos vis√≠veis na tela com os filtros aplicados</div></div></label>
    <label class="pm-opt" onclick="pmSelOpcao(this,'todos')"><input type="radio" name="pmType" value="todos"><div class="pm-opt-text"><div class="pm-opt-title">üìÇ Todos os Projetos</div><div class="pm-opt-desc">Incluir todos os 30 projetos</div></div></label>
    <label class="pm-opt" onclick="pmSelOpcao(this,'criticos')"><input type="radio" name="pmType" value="criticos"><div class="pm-opt-text"><div class="pm-opt-title">üö® Apenas Cr√≠ticos</div><div class="pm-opt-desc">Somente projetos com prioridade alta</div></div></label>
    <label class="pm-opt" onclick="pmSelOpcao(this,'especificos')"><input type="radio" name="pmType" value="especificos"><div class="pm-opt-text"><div class="pm-opt-title">‚úÖ Projetos Espec√≠ficos</div><div class="pm-opt-desc">Selecionar manualmente quais projetos incluir</div></div></label>
    <div class="pm-list" id="pmList"></div>
    <div class="pm-btns" id="pmBtns"><button class="pm-btn-ok" onclick="pmMarcar(true)">‚úÖ Marcar todos</button><button class="pm-btn-no" onclick="pmMarcar(false)">‚úñ Desmarcar todos</button></div>
    <div class="pm-footer"><button class="pm-cancel" onclick="fecharPrintModal()">Cancelar</button><button class="pm-exec" onclick="pmExecutar()">üñ®Ô∏è Imprimir</button></div>
  </div>
</div>

</body>
</html>
