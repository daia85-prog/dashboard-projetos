<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Vis√£o Detalhada v9</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',sans-serif;background:#f0f2f5;min-height:100vh}
.header{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:15px 25px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px}
.header h1{font-size:1.3em}
.nav-buttons{display:flex;gap:10px}
.nav-btn{padding:10px 18px;border:none;border-radius:8px;font-weight:600;text-decoration:none;color:#fff;font-size:.85em}
.nav-btn.blue{background:#3b82f6}
.nav-btn.green{background:#22c55e}
.nav-btn.yellow{background:#f59e0b}
.container{max-width:1500px;margin:0 auto;padding:20px}
.filters{background:#fff;border-radius:12px;padding:20px;margin-bottom:20px;display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:15px;align-items:end}
.filter-group label{display:block;font-size:.8em;color:#64748b;margin-bottom:5px;font-weight:500}
.filter-group select,.filter-group input{width:100%;padding:10px 12px;border:1px solid #e2e8f0;border-radius:8px;font-size:.9em}
.project-section{margin-bottom:20px;background:#fff;border-radius:12px;overflow:hidden;border:1px solid #e2e8f0}
.project-header{padding:18px 20px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;background:#f8fafc;border-bottom:1px solid #e2e8f0}
.project-header:hover{background:#f1f5f9}
.project-title{font-weight:700;color:#1e293b;font-size:1.1em;display:flex;align-items:center;gap:10px}
.project-meta{display:flex;gap:15px;font-size:.85em;color:#64748b;align-items:center}
.project-body{display:none;padding:20px}
.project-body.show{display:block}
.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:15px;margin-bottom:20px;padding:15px;background:#f8fafc;border-radius:10px}
.info-item .label{color:#64748b;font-size:.8em}
.info-item .value{color:#1e293b;font-weight:600;font-size:.95em}
.progress-section{margin-bottom:20px}
.progress-bar{height:10px;background:#e2e8f0;border-radius:5px;overflow:hidden}
.progress-fill{height:100%;border-radius:5px;transition:width .5s}
.progress-fill.verde{background:#22c55e}
.progress-fill.amarelo{background:#f59e0b}
.progress-fill.vermelho{background:#ef4444}
.progress-text{text-align:right;font-size:.85em;color:#64748b;margin-top:5px}
.activities-section h4{color:#475569;margin-bottom:15px;font-size:1em;display:flex;align-items:center;gap:8px}
.activity-item{display:flex;justify-content:space-between;align-items:center;padding:15px;background:#f8fafc;border-radius:10px;margin-bottom:10px;cursor:pointer;border-left:4px solid #e2e8f0;transition:all .2s}
.activity-item:hover{background:#f1f5f9;transform:translateX(5px)}
.activity-item.concluido{border-left-color:#22c55e}
.activity-item.em-andamento{border-left-color:#3b82f6}
.activity-item.atrasado{border-left-color:#ef4444}
.activity-item.nao-iniciado{border-left-color:#94a3b8}
.activity-info .name{font-weight:600;color:#1e293b;font-size:.95em}
.activity-info .fase{font-size:.8em;color:#64748b;margin-top:2px}
.activity-dates{text-align:right;font-size:.8em;color:#64748b}
.status{padding:5px 12px;border-radius:6px;font-size:.75em;font-weight:600}
.status.concluido{background:#dcfce7;color:#166534}
.status.em-andamento{background:#dbeafe;color:#1e40af}
.status.nao-iniciado{background:#f1f5f9;color:#64748b}
.status.atrasado{background:#fee2e2;color:#991b1b}
.status.planejamento{background:#f3e8ff;color:#7c3aed}
.priority{padding:4px 10px;border-radius:5px;font-size:.75em;font-weight:700}
.priority.alta{background:#fee2e2;color:#dc2626}
.priority.media{background:#fef3c7;color:#d97706}
.priority.baixa{background:#dcfce7;color:#16a34a}
.empty{text-align:center;padding:40px;color:#64748b}

/* Modal de Atividade */
.modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:1000;justify-content:center;align-items:center;padding:20px}
.modal-overlay.show{display:flex}
.modal{background:#fff;border-radius:16px;max-width:600px;width:100%;max-height:85vh;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.3)}
.modal-header{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:20px;display:flex;justify-content:space-between;align-items:center}
.modal-header h2{font-size:1.1em;display:flex;align-items:center;gap:10px}
.modal-header h2::before{content:'üìå';font-size:1.2em}
.modal-close{background:rgba(255,255,255,.2);border:none;color:#fff;width:35px;height:35px;border-radius:50%;cursor:pointer;font-size:1.3em;transition:background .2s}
.modal-close:hover{background:rgba(255,255,255,.3)}
.modal-body{padding:0;max-height:calc(85vh - 70px);overflow-y:auto}
.modal-info-list{padding:20px}
.modal-info-row{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid #f1f5f9}
.modal-info-row:last-child{border-bottom:none}
.modal-info-row .label{color:#64748b;font-size:.9em}
.modal-info-row .value{color:#1e293b;font-weight:600;font-size:.9em;text-align:right}

/* Hist√≥rico de Tratativas */
.tratativas-section{background:#f8fafc;padding:20px;border-top:1px solid #e2e8f0}
.tratativas-header{display:flex;align-items:center;gap:10px;margin-bottom:15px;color:#475569;font-weight:600}
.tratativas-header::before{content:'üìã';font-size:1.1em}
.tratativas-empty{text-align:center;padding:20px;background:#fff;border-radius:10px;border:2px dashed #e2e8f0}
.tratativas-empty .msg{color:#f59e0b;font-weight:500;margin-bottom:5px}
.tratativas-empty .sub{color:#94a3b8;font-size:.85em}
.tratativa-item{background:#fff;border-radius:10px;padding:15px;margin-bottom:12px;border-left:4px solid #667eea;box-shadow:0 2px 8px rgba(0,0,0,.05)}
.tratativa-header{display:flex;justify-content:space-between;align-items:start;margin-bottom:10px}
.tratativa-user{display:flex;align-items:center;gap:10px}
.tratativa-avatar{width:35px;height:35px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.85em}
.tratativa-user-info .name{font-weight:600;color:#1e293b;font-size:.9em}
.tratativa-user-info .role{font-size:.75em;color:#64748b}
.tratativa-date{font-size:.75em;color:#94a3b8;text-align:right}
.tratativa-content{color:#475569;font-size:.9em;line-height:1.5;padding:10px;background:#f8fafc;border-radius:8px}
.tratativa-type{display:inline-block;padding:3px 8px;border-radius:4px;font-size:.7em;font-weight:600;margin-bottom:8px}
.tratativa-type.comentario{background:#dbeafe;color:#1e40af}
.tratativa-type.atualizacao{background:#dcfce7;color:#166534}
.tratativa-type.alerta{background:#fee2e2;color:#991b1b}
.tratativa-type.resolucao{background:#f3e8ff;color:#7c3aed}

.footer{text-align:center;padding:15px;background:#fff;border-top:1px solid #e2e8f0;font-size:.8em;color:#64748b;margin-top:20px}
</style>
</head>
<body>
<header class="header">
<h1>üìã Vis√£o Detalhada - Fases & Atividades</h1>
<nav class="nav-buttons">
<a href="index.html" class="nav-btn blue">üè† Vis√£o Executiva</a>
<a href="view-projetos.html" class="nav-btn green">üìä Alertas</a>
</nav>
</header>

<div class="container">
<div class="filters">
<div class="filter-group"><label>üîç Buscar Projeto</label><input type="text" id="filtroNome" placeholder="Nome do projeto..." oninput="render()"></div>
<div class="filter-group"><label>üìä Status</label><select id="filtroStatus" onchange="render()"><option value="">Todos</option><option value="Conclu√≠do">Conclu√≠do</option><option value="Em andamento">Em andamento</option><option value="Planejamento">Planejamento</option><option value="Atrasado">Atrasado</option></select></div>
<div class="filter-group"><label>‚ö° Prioridade</label><select id="filtroPrioridade" onchange="render()"><option value="">Todas</option><option value="Alta">Alta</option><option value="M√©dia">M√©dia</option><option value="Baixa">Baixa</option></select></div>
<div class="filter-group"><label>üë§ PMO</label><select id="filtroPMO" onchange="render()"><option value="">Todos</option><option>ALEX</option><option>ANDERSON</option><option>F√ÅBIO</option><option>GIOVANNI</option><option>LEANDRO</option><option>VINICIUS</option></select></div>
</div>
<div id="projetos"></div>
</div>

<footer class="footer">Vis√£o Detalhada v9 | Invent Corp | 30 Projetos</footer>

<!-- Modal de Atividade -->
<div class="modal-overlay" id="modalAtividade" onclick="fecharModalAtividade()">
<div class="modal" onclick="event.stopPropagation()">
<div class="modal-header">
<h2 id="modalAtividadeTitle">KICKOFF INTERNO</h2>
<button class="modal-close" onclick="fecharModalAtividade()">√ó</button>
</div>
<div class="modal-body">
<div class="modal-info-list" id="modalAtividadeInfo"></div>
<div class="tratativas-section">
<div class="tratativas-header">Hist√≥rico de Tratativas</div>
<div id="tratativasContainer"></div>
</div>
</div>
</div>
</div>

<script>
const PROJETOS = [
    { nome: 'BARBECUE B2B', local: 'S√£o Paulo - SP', pmo: 'ALEX', prioridade: 'Alta', status: 'Conclu√≠do', progresso: 100 },
    { nome: 'BELEZA', local: 'S√£o Paulo - SP', pmo: 'ANDERSON', prioridade: 'M√©dia', status: 'Conclu√≠do', progresso: 100 },
    { nome: 'BETA', local: 'Rio de Janeiro - RJ', pmo: 'ANDERSON', prioridade: 'Alta', status: 'Conclu√≠do', progresso: 100 },
    { nome: 'BETA ESTEIO', local: 'Esteio - RS', pmo: 'ANDERSON', prioridade: 'M√©dia', status: 'Planejamento', progresso: 5 },
    { nome: 'BP', local: 'S√£o Paulo - SP', pmo: 'GIOVANNI', prioridade: 'M√©dia', status: 'Em andamento', progresso: 15 },
    { nome: 'BR', local: 'Jaboat√£o - PE', pmo: 'F√ÅBIO', prioridade: 'Alta', status: 'Planejamento', progresso: 5 },
    { nome: 'CANDELABRIA', local: 'Candel√°ria - RS', pmo: 'ALEX', prioridade: 'M√©dia', status: 'Conclu√≠do', progresso: 100 },
    { nome: 'CDSK', local: 'S√£o Paulo - SP', pmo: 'VINICIUS', prioridade: 'Alta', status: 'Em andamento', progresso: 75 },
    { nome: 'COUGAR', local: 'S√£o Paulo - SP', pmo: 'LEANDRO', prioridade: 'Alta', status: 'Conclu√≠do', progresso: 100 },
    { nome: 'CRISTAL MG RETROFIT', local: 'Belo Horizonte - MG', pmo: 'GIOVANNI', prioridade: 'Alta', status: 'Em andamento', progresso: 15 },
    { nome: 'DIA', local: 'S√£o Paulo - SP', pmo: 'ANDERSON', prioridade: 'Alta', status: 'Atrasado', progresso: 30 },
    { nome: 'DIAMANTE', local: 'Curitiba - PR', pmo: 'F√ÅBIO', prioridade: 'M√©dia', status: 'Planejamento', progresso: 0 },
    { nome: 'ELETRO', local: 'S√£o Paulo - SP', pmo: 'GIOVANNI', prioridade: 'M√©dia', status: 'Em andamento', progresso: 35 },
    { nome: 'ESPERAN√áA', local: 'Belo Horizonte - MG', pmo: 'VINICIUS', prioridade: 'M√©dia', status: 'Conclu√≠do', progresso: 100 },
    { nome: 'FLOWER', local: 'S√£o Paulo - SP', pmo: 'ANDERSON', prioridade: 'Baixa', status: 'Em andamento', progresso: 10 },
    { nome: 'GAVI√ÉO', local: 'Fortaleza - CE', pmo: 'F√ÅBIO', prioridade: 'Alta', status: 'Conclu√≠do', progresso: 100 },
    { nome: 'MKT CHILE', local: 'Santiago - Chile', pmo: 'ALEX', prioridade: 'M√©dia', status: 'Planejamento', progresso: 0 },
    { nome: 'MKT PERU', local: 'Lima - Peru', pmo: 'ALEX', prioridade: 'M√©dia', status: 'Planejamento', progresso: 0 },
    { nome: 'MASTER', local: 'S√£o Paulo - SP', pmo: 'LEANDRO', prioridade: 'Alta', status: 'Planejamento', progresso: 0 },
    { nome: 'NAVEPARK', local: 'Curitiba - PR', pmo: 'ANDERSON', prioridade: 'M√©dia', status: 'Em andamento', progresso: 25 },
    { nome: 'OCTOPUS MS', local: 'Campo Grande - MS', pmo: 'ALEX', prioridade: 'M√©dia', status: 'Em andamento', progresso: 40 },
    { nome: 'OCTOPUS SC', local: 'Florian√≥polis - SC', pmo: 'ALEX', prioridade: 'M√©dia', status: 'Conclu√≠do', progresso: 100 },
    { nome: 'OPTIMUS PRIME', local: 'S√£o Paulo - SP', pmo: 'GIOVANNI', prioridade: 'Alta', status: 'Conclu√≠do', progresso: 100 },
    { nome: 'PBL GUATEMALA', local: 'Guatemala City', pmo: 'F√ÅBIO', prioridade: 'Alta', status: 'Em andamento', progresso: 45 },
    { nome: 'PROMO B2B CD GRU', local: 'Guarulhos - SP', pmo: 'LEANDRO', prioridade: 'Alta', status: 'Conclu√≠do', progresso: 100 },
    { nome: 'PTL SP', local: 'S√£o Paulo - SP', pmo: 'VINICIUS', prioridade: 'M√©dia', status: 'Conclu√≠do', progresso: 100 },
    { nome: 'REISADO', local: 'Recife - PE', pmo: 'F√ÅBIO', prioridade: 'M√©dia', status: 'Conclu√≠do', progresso: 100 },
    { nome: 'REVERSE', local: 'S√£o Paulo - SP', pmo: 'ALEX', prioridade: 'Alta', status: 'Em andamento', progresso: 55 },
    { nome: 'SUPER DIVINOPOLIS', local: 'Divin√≥polis - MG', pmo: 'GIOVANNI', prioridade: 'M√©dia', status: 'Em andamento', progresso: 50 },
    { nome: 'TITANIO', local: 'S√£o Paulo - SP', pmo: 'ALEX', prioridade: 'Alta', status: 'Em andamento', progresso: 80 }
];

const ATIVIDADES_MODELO = [
    { nome: 'Kickoff Interno', fase: '1. Inicia√ß√£o', duracao: 10 },
    { nome: 'Levantamento de Requisitos', fase: '1. Inicia√ß√£o', duracao: 15 },
    { nome: 'Documenta√ß√£o T√©cnica', fase: '2. Planejamento', duracao: 20 },
    { nome: 'Aprova√ß√£o de Escopo', fase: '2. Planejamento', duracao: 5 },
    { nome: 'Provisionamento de Recursos', fase: '3. Provisionamento', duracao: 15 },
    { nome: 'Configura√ß√£o de Ambiente', fase: '3. Provisionamento', duracao: 10 },
    { nome: 'Desenvolvimento/Implementa√ß√£o', fase: '4. Implementa√ß√£o', duracao: 30 },
    { nome: 'Integra√ß√£o de Sistemas', fase: '4. Implementa√ß√£o', duracao: 15 },
    { nome: 'Testes Unit√°rios', fase: '5. Testes', duracao: 10 },
    { nome: 'Homologa√ß√£o Cliente', fase: '5. Testes', duracao: 15 },
    { nome: 'Deploy em Produ√ß√£o', fase: '6. Deploy', duracao: 5 },
    { nome: 'Valida√ß√£o P√≥s-Deploy', fase: '6. Deploy', duracao: 3 },
    { nome: 'Monitoramento', fase: '7. Estabiliza√ß√£o', duracao: 15 },
    { nome: 'Ajustes Finos', fase: '7. Estabiliza√ß√£o', duracao: 10 },
    { nome: 'Documenta√ß√£o Final', fase: '8. Encerramento', duracao: 5 },
    { nome: 'Encerramento Formal', fase: '8. Encerramento', duracao: 3 }
];

// Tratativas fict√≠cias por projeto/atividade
const TRATATIVAS = {
    'OCTOPUS MS_Kickoff Interno': [
        { user: 'ALEX', role: 'PMO', date: '01/01/2026 09:30', type: 'atualizacao', content: 'Kickoff realizado com sucesso. Participantes: equipe t√©cnica, cliente e stakeholders. Definidos os principais marcos do projeto.' },
        { user: 'DAIANA', role: 'Gestora', date: '01/01/2026 14:15', type: 'comentario', content: 'Excelente in√≠cio! Favor garantir que a documenta√ß√£o do kickoff seja compartilhada com todos os envolvidos.' }
    ],
    'DIA_Provisionamento de Recursos': [
        { user: 'ANDERSON', role: 'PMO', date: '15/01/2026 10:00', type: 'alerta', content: 'ATEN√á√ÉO: Aguardando libera√ß√£o de VPN pelo cliente. Prazo original comprometido.' },
        { user: 'DAIANA', role: 'Gestora', date: '15/01/2026 11:30', type: 'comentario', content: 'Escalar para o gerente de TI do cliente. Precisamos dessa VPN urgente.' },
        { user: 'ANDERSON', role: 'PMO', date: '18/01/2026 09:00', type: 'atualizacao', content: 'Reuni√£o agendada com TI do cliente para 20/01. Esperamos resolver o bloqueio.' },
        { user: 'DOUGLAS', role: 'Diretor', date: '20/01/2026 16:00', type: 'comentario', content: 'Acompanhando de perto. Manter atualizado sobre progresso da VPN.' }
    ],
    'CDSK_Deploy em Produ√ß√£o': [
        { user: 'VINICIUS', role: 'PMO', date: '05/02/2026 08:00', type: 'atualizacao', content: 'Deploy da Fase 1 iniciado. Janela de manuten√ß√£o: 08:00 √†s 12:00.' },
        { user: 'VINICIUS', role: 'PMO', date: '05/02/2026 11:45', type: 'resolucao', content: 'Deploy conclu√≠do com sucesso! Sistemas operacionais. Iniciando monitoramento.' }
    ],
    'TITANIO_Monitoramento': [
        { user: 'ALEX', role: 'PMO', date: '01/02/2026 14:00', type: 'atualizacao', content: 'Per√≠odo de estabiliza√ß√£o iniciado. Monitoramento 24/7 ativo.' },
        { user: 'ALEX', role: 'PMO', date: '02/02/2026 09:00', type: 'comentario', content: 'Nenhum incidente reportado nas primeiras 24h. Sistema est√°vel.' }
    ],
    'PBL GUATEMALA_Desenvolvimento/Implementa√ß√£o': [
        { user: 'F√ÅBIO', role: 'PMO', date: '25/01/2026 10:00', type: 'atualizacao', content: 'Implementa√ß√£o em andamento. 60% dos m√≥dulos conclu√≠dos.' },
        { user: 'F√ÅBIO', role: 'PMO', date: '28/01/2026 15:30', type: 'alerta', content: 'Identificado problema de compatibilidade com sistema legado. Equipe analisando solu√ß√µes.' },
        { user: 'DAIANA', role: 'Gestora', date: '29/01/2026 09:00', type: 'comentario', content: 'Qual o impacto no cronograma? Precisamos avaliar riscos.' },
        { user: 'F√ÅBIO', role: 'PMO', date: '30/01/2026 11:00', type: 'resolucao', content: 'Problema resolvido com workaround. Cronograma mantido. Documenta√ß√£o atualizada.' }
    ],
    'REVERSE_Testes Unit√°rios': [
        { user: 'ALEX', role: 'PMO', date: '28/01/2026 14:00', type: 'atualizacao', content: 'Iniciados testes unit√°rios. Cobertura atual: 45%.' },
        { user: 'ALEX', role: 'PMO', date: '01/02/2026 16:00', type: 'atualizacao', content: 'Cobertura de testes em 78%. Alguns bugs identificados e corrigidos.' }
    ],
    'NAVEPARK_Configura√ß√£o de Ambiente': [
        { user: 'ANDERSON', role: 'PMO', date: '20/01/2026 09:00', type: 'comentario', content: 'Aguardando sinal do datacenter para finalizar configura√ß√£o.' },
        { user: 'ANDERSON', role: 'PMO', date: '25/01/2026 14:00', type: 'atualizacao', content: 'Sinal recebido. Configura√ß√£o em andamento.' }
    ]
};

function getAtividades(projeto) {
    const p = PROJETOS.find(x => x.nome === projeto);
    if (!p) return [];
    
    const progresso = p.progresso;
    const totalAtiv = ATIVIDADES_MODELO.length;
    const ativConcluidas = Math.floor((progresso / 100) * totalAtiv);
    
    let dataBase = new Date('2026-01-01');
    
    return ATIVIDADES_MODELO.map((a, i) => {
        let status;
        if (i < ativConcluidas) {
            status = 'Conclu√≠do';
        } else if (i === ativConcluidas && progresso > 0) {
            status = p.status === 'Atrasado' ? 'Atrasado' : 'Em andamento';
        } else {
            status = 'N√£o Iniciado';
        }
        
        const dataInicio = new Date(dataBase);
        dataBase.setDate(dataBase.getDate() + a.duracao);
        const dataFim = new Date(dataBase);
        
        return {
            ...a,
            projeto: projeto,
            status: status,
            dataInicio: dataInicio.toLocaleDateString('pt-BR'),
            dataFim: dataFim.toLocaleDateString('pt-BR'),
            responsavel: p.pmo,
            descricao: getDescricaoAtividade(a.nome, status)
        };
    });
}

function getDescricaoAtividade(nome, status) {
    const descricoes = {
        'Kickoff Interno': 'Kickoff realizado',
        'Levantamento de Requisitos': 'Requisitos documentados',
        'Documenta√ß√£o T√©cnica': 'Documenta√ß√£o em elabora√ß√£o',
        'Aprova√ß√£o de Escopo': 'Escopo aprovado pelo cliente',
        'Provisionamento de Recursos': 'Recursos alocados',
        'Configura√ß√£o de Ambiente': 'Ambiente configurado',
        'Desenvolvimento/Implementa√ß√£o': 'Desenvolvimento em progresso',
        'Integra√ß√£o de Sistemas': 'Integra√ß√£o em andamento',
        'Testes Unit√°rios': 'Testes sendo executados',
        'Homologa√ß√£o Cliente': 'Aguardando homologa√ß√£o',
        'Deploy em Produ√ß√£o': 'Deploy programado',
        'Valida√ß√£o P√≥s-Deploy': 'Valida√ß√£o em curso',
        'Monitoramento': 'Monitoramento ativo',
        'Ajustes Finos': 'Ajustes sendo realizados',
        'Documenta√ß√£o Final': 'Documenta√ß√£o sendo finalizada',
        'Encerramento Formal': 'Projeto em encerramento'
    };
    return descricoes[nome] || 'Atividade em progresso';
}

function getStatusClass(s) {
    return s.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/ /g, '-');
}

function getCor(p) {
    return p >= 80 ? 'verde' : p >= 40 ? 'amarelo' : 'vermelho';
}

function render() {
    const fn = document.getElementById('filtroNome').value.toLowerCase();
    const fs = document.getElementById('filtroStatus').value;
    const fp = document.getElementById('filtroPrioridade').value;
    const fm = document.getElementById('filtroPMO').value;
    
    const pf = PROJETOS.filter(p => {
        if (fn && !p.nome.toLowerCase().includes(fn)) return false;
        if (fs && p.status !== fs) return false;
        if (fp && p.prioridade !== fp) return false;
        if (fm && p.pmo !== fm) return false;
        return true;
    });
    
    if (!pf.length) {
        document.getElementById('projetos').innerHTML = '<div class="empty">Nenhum projeto encontrado</div>';
        return;
    }
    
    document.getElementById('projetos').innerHTML = pf.map(p => {
        const atividades = getAtividades(p.nome);
        const cor = getCor(p.progresso);
        const ativConcluidas = atividades.filter(a => a.status === 'Conclu√≠do').length;
        
        return `
            <div class="project-section">
                <div class="project-header" onclick="toggleProject(this)">
                    <div class="project-title">
                        <span>${p.nome}</span>
                        <span class="priority ${p.prioridade.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'')}">${p.prioridade}</span>
                    </div>
                    <div class="project-meta">
                        <span>üìç ${p.local}</span>
                        <span>üë§ ${p.pmo}</span>
                        <span class="status ${getStatusClass(p.status)}">${p.status}</span>
                        <span><strong>${p.progresso}%</strong></span>
                    </div>
                </div>
                <div class="project-body">
                    <div class="info-grid">
                        <div class="info-item"><span class="label">Status</span><div class="value">${p.status}</div></div>
                        <div class="info-item"><span class="label">PMO Respons√°vel</span><div class="value">${p.pmo}</div></div>
                        <div class="info-item"><span class="label">Local</span><div class="value">${p.local}</div></div>
                        <div class="info-item"><span class="label">Prioridade</span><div class="value">${p.prioridade}</div></div>
                    </div>
                    <div class="progress-section">
                        <div class="progress-bar"><div class="progress-fill ${cor}" style="width:${p.progresso}%"></div></div>
                        <div class="progress-text">${ativConcluidas}/${atividades.length} atividades conclu√≠das (${p.progresso}%)</div>
                    </div>
                    <div class="activities-section">
                        <h4>üìã Atividades do Projeto</h4>
                        ${atividades.map(a => `
                            <div class="activity-item ${getStatusClass(a.status)}" onclick="abrirModalAtividade('${p.nome}', '${a.nome}')">
                                <div class="activity-info">
                                    <div class="name">${a.nome}</div>
                                    <div class="fase">${a.fase}</div>
                                </div>
                                <div class="activity-dates">
                                    <div>${a.dataInicio} - ${a.dataFim}</div>
                                </div>
                                <span class="status ${getStatusClass(a.status)}">${a.status}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

function toggleProject(el) {
    el.nextElementSibling.classList.toggle('show');
}

function abrirModalAtividade(projeto, atividade) {
    const p = PROJETOS.find(x => x.nome === projeto);
    const atividades = getAtividades(projeto);
    const a = atividades.find(x => x.nome === atividade);
    
    if (!a) return;
    
    document.getElementById('modalAtividadeTitle').textContent = a.nome.toUpperCase();
    
    document.getElementById('modalAtividadeInfo').innerHTML = `
        <div class="modal-info-row"><span class="label">Projeto</span><span class="value">${projeto}</span></div>
        <div class="modal-info-row"><span class="label">Fase</span><span class="value">${a.fase}</span></div>
        <div class="modal-info-row"><span class="label">Respons√°vel</span><span class="value">${a.responsavel}</span></div>
        <div class="modal-info-row"><span class="label">Data In√≠cio</span><span class="value">${a.dataInicio}</span></div>
        <div class="modal-info-row"><span class="label">Data T√©rmino</span><span class="value">${a.dataFim}</span></div>
        <div class="modal-info-row"><span class="label">Status</span><span class="value">${a.status}</span></div>
        <div class="modal-info-row"><span class="label">Descri√ß√£o</span><span class="value">${a.descricao}</span></div>
    `;
    
    // Carregar tratativas
    const key = `${projeto}_${atividade}`;
    const tratativas = TRATATIVAS[key] || [];
    
    if (tratativas.length === 0) {
        document.getElementById('tratativasContainer').innerHTML = `
            <div class="tratativas-empty">
                <div class="msg">Nenhuma tratativa registrada ainda.</div>
                <div class="sub">Em vers√µes futuras, aqui aparecer√£o todas as atualiza√ß√µes e coment√°rios desta atividade.</div>
            </div>
        `;
    } else {
        document.getElementById('tratativasContainer').innerHTML = tratativas.map(t => `
            <div class="tratativa-item">
                <div class="tratativa-header">
                    <div class="tratativa-user">
                        <div class="tratativa-avatar">${t.user.charAt(0)}</div>
                        <div class="tratativa-user-info">
                            <div class="name">${t.user}</div>
                            <div class="role">${t.role}</div>
                        </div>
                    </div>
                    <div class="tratativa-date">${t.date}</div>
                </div>
                <span class="tratativa-type ${t.type}">${getTipoLabel(t.type)}</span>
                <div class="tratativa-content">${t.content}</div>
            </div>
        `).join('');
    }
    
    document.getElementById('modalAtividade').classList.add('show');
}

function getTipoLabel(type) {
    const labels = {
        'comentario': 'üí¨ Coment√°rio',
        'atualizacao': 'üìù Atualiza√ß√£o',
        'alerta': '‚ö†Ô∏è Alerta',
        'resolucao': '‚úÖ Resolu√ß√£o'
    };
    return labels[type] || type;
}

function fecharModalAtividade() {
    document.getElementById('modalAtividade').classList.remove('show');
}

render();

document.addEventListener('keydown', e => {
    if (e.key === 'Escape') fecharModalAtividade();
});
</script>
</body>
</html>
