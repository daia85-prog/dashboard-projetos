<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vis√£o Resumida - Infraestrutura v5.5.0</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; min-height: 100vh; }
        .container { max-width: 1600px; margin: 0 auto; }
        .header { background: white; padding: 25px 30px; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .header h1 { color: #1a1a2e; font-size: 24px; display: flex; align-items: center; gap: 10px; }
        .header .version { background: #ede9fe; color: #7c3aed; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .header p { color: #64748b; font-size: 13px; margin-top: 5px; }
        .btn { background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 12px 20px; border-radius: 10px; font-size: 13px; font-weight: 600; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; }
        .btn-secondary { background: linear-gradient(135deg, #64748b, #475569); }
        .hidden { display: none !important; }
        .loading { background: white; padding: 60px; border-radius: 16px; text-align: center; }
        .spinner { width: 50px; height: 50px; border: 4px solid #f3f4f6; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* KPIs */
        .kpis-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .kpi-card { background: white; padding: 18px 20px; border-radius: 14px; box-shadow: 0 5px 20px rgba(0,0,0,0.12); position: relative; overflow: hidden; }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; }
        .kpi-card.ontime::before { background: linear-gradient(90deg, #10b981, #059669); }
        .kpi-card.delta::before { background: linear-gradient(90deg, #f59e0b, #d97706); }
        .kpi-card.taxa::before { background: linear-gradient(90deg, #3b82f6, #2563eb); }
        .kpi-card.aging::before { background: linear-gradient(90deg, #8b5cf6, #7c3aed); }
        .kpi-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .kpi-label { font-size: 11px; text-transform: uppercase; color: #64748b; font-weight: 600; letter-spacing: 0.5px; }
        .kpi-help { width: 18px; height: 18px; background: #f1f5f9; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; color: #64748b; cursor: help; position: relative; }
        .kpi-help:hover .kpi-tooltip { display: block; }
        .kpi-tooltip { display: none; position: absolute; bottom: 100%; right: 0; margin-bottom: 8px; width: 200px; background: #1e293b; color: white; padding: 10px 12px; border-radius: 8px; font-size: 11px; line-height: 1.4; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        .kpi-value { font-size: 28px; font-weight: 700; }
        .kpi-card.ontime .kpi-value { color: #10b981; }
        .kpi-card.delta .kpi-value { color: #f59e0b; }
        .kpi-card.taxa .kpi-value { color: #3b82f6; }
        .kpi-card.aging .kpi-value { color: #8b5cf6; }
        .kpi-sub { font-size: 11px; color: #94a3b8; margin-top: 4px; }
        
        /* Cards Status */
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .card { background: white; padding: 20px 18px; border-radius: 14px; box-shadow: 0 5px 20px rgba(0,0,0,0.12); text-align: center; cursor: pointer; position: relative; overflow: hidden; transition: all 0.3s; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 15px 40px rgba(0,0,0,0.2); }
        .card.total::before { background: linear-gradient(90deg, #667eea, #764ba2); }
        .card.concluido::before { background: #10b981; }
        .card.andamento::before { background: #3b82f6; }
        .card.atrasado::before { background: #ef4444; }
        .card.aguardando::before { background: #f59e0b; }
        .card.nao-iniciado::before { background: #6b7280; }
        .card.critico::before { background: #dc2626; }
        .card-icon { font-size: 20px; margin-bottom: 5px; }
        .card-number { font-size: 36px; font-weight: 800; margin: 5px 0; line-height: 1; }
        .card.total .card-number { color: #667eea; }
        .card.concluido .card-number { color: #10b981; }
        .card.andamento .card-number { color: #3b82f6; }
        .card.atrasado .card-number { color: #ef4444; }
        .card.aguardando .card-number { color: #f59e0b; }
        .card.nao-iniciado .card-number { color: #6b7280; }
        .card.critico .card-number { color: #dc2626; }
        .card-label { color: #94a3b8; font-size: 9px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
        .card.active { box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.5); }
        .card .info-icon { position: absolute; top: 8px; right: 8px; width: 16px; height: 16px; background: #f1f5f9; border-radius: 50%; font-size: 10px; display: flex; align-items: center; justify-content: center; color: #64748b; cursor: help; }
        .card .info-icon:hover .card-tooltip { display: block; }
        .card-tooltip { display: none; position: absolute; bottom: 100%; right: 0; margin-bottom: 5px; width: 180px; background: #1e293b; color: white; padding: 8px 10px; border-radius: 6px; font-size: 10px; text-align: left; z-index: 100; }
        
        /* RESUMO EXECUTIVO */
        .executive-summary { background: linear-gradient(135deg, #f8fafc, #f1f5f9); border: 1px solid #e2e8f0; border-radius: 12px; padding: 16px 20px; margin-bottom: 16px; display: flex; align-items: center; gap: 12px; }
        .summary-icon { font-size: 24px; }
        .summary-text { font-size: 14px; color: #334155; line-height: 1.5; flex: 1; }
        .summary-text strong { color: #1e293b; }
        .summary-text .highlight-red { color: #dc2626; font-weight: 600; }
        .summary-text .highlight-green { color: #16a34a; font-weight: 600; }
        .summary-text .highlight-blue { color: #2563eb; font-weight: 600; }
        
        /* ALERT BAR INTELIGENTE */
        .alert-bar { border-radius: 12px; padding: 14px 20px; margin-bottom: 16px; display: flex; align-items: center; gap: 12px; transition: all 0.3s; }
        .alert-bar.danger { background: linear-gradient(135deg, #fef2f2, #fee2e2); border: 1px solid #fca5a5; }
        .alert-bar.warning { background: linear-gradient(135deg, #fffbeb, #fef3c7); border: 1px solid #fcd34d; }
        .alert-bar.success { background: linear-gradient(135deg, #f0fdf4, #dcfce7); border: 1px solid #86efac; }
        .alert-bar.hidden { display: none; }
        .alert-icon { font-size: 20px; }
        .alert-text { font-size: 13px; font-weight: 500; flex: 1; }
        .alert-bar.danger .alert-text { color: #991b1b; }
        .alert-bar.warning .alert-text { color: #92400e; }
        .alert-bar.success .alert-text { color: #166534; }
        
        /* Decis√µes */
        .decisoes-section { background: white; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); margin-bottom: 20px; overflow: hidden; }
        .decisoes-header { background: linear-gradient(135deg, #dc2626, #991b1b); color: white; padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; }
        .decisoes-header h2 { font-size: 15px; display: flex; align-items: center; gap: 10px; }
        .decisoes-badge { background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 12px; font-size: 12px; }
        .decisoes-body { padding: 0; }
        .decisoes-table { width: 100%; border-collapse: collapse; }
        .decisoes-table th { background: #fef2f2; color: #991b1b; padding: 12px 16px; text-align: left; font-size: 10px; text-transform: uppercase; font-weight: 600; }
        .decisoes-table td { padding: 14px 16px; border-bottom: 1px solid #fef2f2; font-size: 13px; }
        .decisoes-table tr:hover { background: #fff5f5; }
        .decisoes-table .projeto { font-weight: 600; color: #1e293b; }
        .decisoes-table .bloqueador { color: #dc2626; }
        .decisoes-table .dias { background: #fee2e2; color: #991b1b; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .decisoes-table .acao { background: #fef3c7; color: #92400e; padding: 4px 12px; border-radius: 8px; font-size: 11px; font-weight: 600; }
        .no-decisoes { text-align: center; padding: 30px; color: #10b981; font-size: 13px; }
        
        /* Filters */
        .filters-section { background: white; padding: 20px 25px; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); margin-bottom: 20px; }
        .filters-grid { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr auto; gap: 15px; align-items: end; }
        .filter-group label { display: block; font-size: 11px; text-transform: uppercase; color: #64748b; margin-bottom: 6px; font-weight: 600; }
        .filter-group input, .filter-group select { width: 100%; padding: 10px 14px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 13px; transition: border-color 0.2s; }
        .filter-group input:focus, .filter-group select:focus { outline: none; border-color: #667eea; }
        .btn-clear { background: #f3f4f6; color: #64748b; box-shadow: none; padding: 10px 16px; }
        
        /* Charts */
        .charts-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .chart-card { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); }
        .chart-card h3 { color: #1a1a2e; font-size: 14px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .pie-container { display: flex; align-items: center; justify-content: center; gap: 20px; }
        .pie-chart { width: 110px; height: 110px; border-radius: 50%; position: relative; }
        .pie-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 55px; height: 55px; background: white; border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .pie-center .number { font-size: 16px; font-weight: 700; color: #1a1a2e; }
        .pie-center .label { font-size: 8px; color: #64748b; }
        .pie-legend { display: flex; flex-direction: column; gap: 5px; }
        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 11px; color: #475569; }
        .legend-dot { width: 10px; height: 10px; border-radius: 3px; }
        
        /* Bloqueadores */
        .bloqueador-item { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .bloqueador-label { min-width: 100px; font-size: 11px; color: #374151; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .bloqueador-bar { flex: 1; height: 22px; background: #fee2e2; border-radius: 6px; overflow: hidden; }
        .bloqueador-fill { height: 100%; background: linear-gradient(90deg, #ef4444, #dc2626); border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding: 0 10px; font-size: 11px; font-weight: 600; color: white; }
        .no-bloqueadores { text-align: center; padding: 20px; color: #10b981; font-size: 12px; }
        
        /* Timeline Go Lives */
        .timeline-chart { display: flex; flex-direction: column; gap: 8px; }
        .timeline-item { display: flex; align-items: center; gap: 10px; }
        .timeline-date { min-width: 70px; font-size: 11px; color: #1e293b; font-weight: 700; }
        .timeline-days { min-width: 55px; font-size: 9px; padding: 2px 6px; border-radius: 4px; text-align: center; }
        .timeline-days.atrasado { background: #fee2e2; color: #991b1b; }
        .timeline-days.proximo { background: #fef3c7; color: #92400e; }
        .timeline-days.ok { background: #d1fae5; color: #065f46; }
        .timeline-bar { flex: 1; height: 22px; border-radius: 6px; display: flex; align-items: center; padding: 0 10px; font-size: 10px; font-weight: 600; color: white; }
        .timeline-bar.verde { background: linear-gradient(90deg, #10b981, #059669); }
        .timeline-bar.amarelo { background: linear-gradient(90deg, #f59e0b, #d97706); }
        .timeline-bar.vermelho { background: linear-gradient(90deg, #ef4444, #dc2626); }
        .timeline-bar.cinza { background: linear-gradient(90deg, #6b7280, #4b5563); }
        .no-timeline { text-align: center; padding: 20px; color: #64748b; font-size: 12px; }
        
        /* Parados */
        .parado-item { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .parado-nome { min-width: 80px; font-size: 10px; color: #374151; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .parado-bar { flex: 1; height: 20px; background: #f3f4f6; border-radius: 6px; overflow: hidden; }
        .parado-fill { height: 100%; border-radius: 6px; display: flex; align-items: center; justify-content: flex-end; padding: 0 8px; font-size: 10px; font-weight: 600; color: white; }
        .parado-fill.ok { background: linear-gradient(90deg, #10b981, #059669); }
        .parado-fill.warning { background: linear-gradient(90deg, #f59e0b, #d97706); }
        .parado-fill.critical { background: linear-gradient(90deg, #ef4444, #dc2626); }
        .no-parados { text-align: center; padding: 20px; color: #10b981; font-size: 12px; }
        
        /* Table */
        .table-section { background: white; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); overflow: hidden; }
        .table-header { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; }
        .table-header h2 { font-size: 15px; }
        .results-badge { background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 12px; font-size: 12px; }
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8fafc; color: #475569; padding: 12px 16px; text-align: left; font-weight: 600; text-transform: uppercase; font-size: 10px; white-space: nowrap; }
        td { padding: 14px 16px; border-bottom: 1px solid #f1f5f9; font-size: 12px; color: #334155; }
        tr:hover { background: #f8fafc; }
        tr.clickable { cursor: pointer; }
        .project-name { font-weight: 600; color: #1e293b; }
        .status-badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 10px; font-weight: 600; }
        .status-badge.andamento { background: #dbeafe; color: #1d4ed8; }
        .status-badge.concluido { background: #dcfce7; color: #166534; }
        .status-badge.atrasado { background: #fee2e2; color: #991b1b; }
        .status-badge.aguardando { background: #fef3c7; color: #92400e; }
        .status-badge.nao-iniciado { background: #f3f4f6; color: #4b5563; }
        .situacao { display: inline-flex; align-items: center; gap: 5px; padding: 3px 8px; border-radius: 6px; font-size: 10px; font-weight: 600; }
        .situacao-dot { width: 8px; height: 8px; border-radius: 50%; }
        .situacao.verde { background: #dcfce7; color: #166534; }
        .situacao.verde .situacao-dot { background: #22c55e; }
        .situacao.amarelo { background: #fef9c3; color: #854d0e; }
        .situacao.amarelo .situacao-dot { background: #eab308; }
        .situacao.vermelho { background: #fee2e2; color: #991b1b; }
        .situacao.vermelho .situacao-dot { background: #ef4444; }
        .situacao.cinza { background: #f3f4f6; color: #4b5563; }
        .situacao.cinza .situacao-dot { background: #9ca3af; }
        .progress-container { display: flex; align-items: center; gap: 8px; }
        .progress-bar { flex: 1; height: 6px; background: #e5e7eb; border-radius: 3px; overflow: hidden; min-width: 50px; }
        .progress-fill { height: 100%; border-radius: 3px; }
        .progress-fill.low { background: linear-gradient(90deg, #ef4444, #f87171); }
        .progress-fill.medium { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
        .progress-fill.high { background: linear-gradient(90deg, #10b981, #34d399); }
        .progress-text { font-size: 11px; font-weight: 600; min-width: 32px; color: #475569; }
        .empty-state { text-align: center; padding: 40px; color: #64748b; }
        
        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal { background: white; border-radius: 20px; width: 90%; max-width: 700px; max-height: 90vh; overflow-y: auto; transform: scale(0.9); transition: transform 0.3s; }
        .modal-overlay.active .modal { transform: scale(1); }
        .modal-header { padding: 24px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: start; }
        .modal-header h2 { color: #1a1a2e; font-size: 20px; margin-bottom: 5px; }
        .modal-header p { color: #64748b; font-size: 12px; }
        .modal-close { background: none; border: none; font-size: 28px; cursor: pointer; color: #64748b; }
        .modal-body { padding: 24px; }
        .info-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .info-box { background: #f8fafc; padding: 12px; border-radius: 10px; }
        .info-box label { display: block; font-size: 9px; text-transform: uppercase; color: #64748b; margin-bottom: 4px; font-weight: 600; }
        .info-box span { font-size: 12px; color: #1e293b; font-weight: 600; }
        
        /* Print Modal */
        .print-modal { max-width: 500px; }
        .print-options { display: flex; flex-direction: column; gap: 10px; margin: 15px 0; }
        .print-option { display: flex; align-items: flex-start; gap: 12px; padding: 14px; background: #f8fafc; border-radius: 10px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s; }
        .print-option:hover, .print-option.selected { background: #ede9fe; border-color: #667eea; }
        .print-option input[type="radio"] { display: none; }
        .print-icon { font-size: 20px; }
        .print-label { font-weight: 600; color: #1a1a2e; font-size: 13px; }
        .print-desc { font-size: 11px; color: #64748b; margin-top: 2px; }
        
        /* Sele√ß√£o de projetos para impress√£o */
        .projects-select-container { margin-top: 10px; max-height: 200px; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; }
        .project-checkbox { display: flex; align-items: center; gap: 8px; padding: 6px 8px; border-radius: 6px; cursor: pointer; font-size: 12px; }
        .project-checkbox:hover { background: #f1f5f9; }
        .project-checkbox input { width: 16px; height: 16px; accent-color: #667eea; }
        .project-search { width: 100%; padding: 8px 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 12px; margin-bottom: 10px; }
        .project-search:focus { outline: none; border-color: #667eea; }
        .project-checkbox.hidden { display: none; }
        .select-all-btn { font-size: 11px; color: #667eea; cursor: pointer; margin-bottom: 8px; display: inline-block; }
        .select-all-btn:hover { text-decoration: underline; }
        
        @media print { 
            body { background: white; padding: 10px; } 
            .btn, .filters-section, .modal-overlay, .charts-row, .header > div:last-child, .kpis-section, .decisoes-section { display: none !important; } 
            .table-section { box-shadow: none; border: 1px solid #e5e7eb; } 
        }
        @media (max-width: 1200px) { .charts-row { grid-template-columns: 1fr; } .filters-grid { grid-template-columns: 1fr 1fr 1fr; } }
        @media (max-width: 768px) { .header { flex-direction: column; } .cards-grid { grid-template-columns: repeat(3, 1fr); } .filters-grid { grid-template-columns: 1fr; } .info-grid { grid-template-columns: 1fr; } .kpis-section { grid-template-columns: repeat(2, 1fr); } }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>üìã Vis√£o Resumida - Infraestrutura <span class="version">v5.5.0</span></h1>
                <p>Atualizado em: <span id="currentDate">Carregando...</span></p>
            </div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;">
                <a href="index.html" class="btn btn-secondary">‚Üê Voltar</a>
                <button class="btn" onclick="openPrintModal()">üñ®Ô∏è Imprimir</button>
                <button class="btn" style="background: linear-gradient(135deg, #ef4444, #dc2626);" onclick="openPdfModal()">üìÑ Gerar PDF</button>
            </div>
        </div>
        
        <div id="loading" class="loading"><div class="spinner"></div><h3>Carregando dados...</h3></div>
        
        <div id="dashboardContent" class="hidden">
            <!-- KPIs - SIMPLIFICADOS -->
            <div class="kpis-section">
                <div class="kpi-card ontime">
                    <div class="kpi-header">
                        <div class="kpi-label">No Prazo</div>
                        <div class="kpi-help">?<div class="kpi-tooltip">Percentual de projetos com Go Live no prazo (Atual = Original)</div></div>
                    </div>
                    <div class="kpi-value" id="kpiOntime">--%</div>
                    <div class="kpi-sub" id="kpiOntimeSub">de X com data</div>
                </div>
                <div class="kpi-card delta">
                    <div class="kpi-header">
                        <div class="kpi-label">Atraso M√©dio</div>
                        <div class="kpi-help">?<div class="kpi-tooltip">M√©dia de dias de atraso entre Go Live Original e Atual</div></div>
                    </div>
                    <div class="kpi-value" id="kpiDelta">-- dias</div>
                    <div class="kpi-sub" id="kpiDeltaSub">nos go-lives</div>
                </div>
                <div class="kpi-card taxa">
                    <div class="kpi-header">
                        <div class="kpi-label">Projetos Atualizados</div>
                        <div class="kpi-help">?<div class="kpi-tooltip">Percentual de projetos atualizados nos √∫ltimos 7 dias</div></div>
                    </div>
                    <div class="kpi-value" id="kpiTaxa">--%</div>
                    <div class="kpi-sub" id="kpiTaxaSub">√∫ltimos 7 dias</div>
                </div>
                <div class="kpi-card aging">
                    <div class="kpi-header">
                        <div class="kpi-label">Tempo M√©dio Parado</div>
                        <div class="kpi-help">?<div class="kpi-tooltip">M√©dia de dias sem atualiza√ß√£o dos projetos n√£o conclu√≠dos</div></div>
                    </div>
                    <div class="kpi-value" id="kpiAging">-- dias</div>
                    <div class="kpi-sub" id="kpiAgingSub">sem atualiza√ß√£o</div>
                </div>
            </div>
            
            <!-- RESUMO EXECUTIVO -->
            <div class="executive-summary" id="executiveSummary">
                <div class="summary-icon">üìã</div>
                <div class="summary-text" id="summaryText">Carregando resumo...</div>
            </div>
            
            <!-- ALERT BAR INTELIGENTE -->
            <div class="alert-bar" id="alertBar">
                <span class="alert-icon">‚ö†Ô∏è</span>
                <span class="alert-text" id="alertText">Verificando status...</span>
            </div>
            
            <!-- Cards Status COM √çCONES -->
            <div class="cards-grid">
                <div class="card total" onclick="filterByStatus('')"><div class="card-icon">üìä</div><div class="card-number" id="totalProjects">0</div><div class="card-label">Total</div></div>
                <div class="card concluido" onclick="filterByStatus('Conclu√≠do')"><div class="card-icon">‚úÖ</div><div class="card-number" id="completedCount">0</div><div class="card-label">Conclu√≠dos</div></div>
                <div class="card andamento" onclick="filterByStatus('Em Andamento')"><div class="card-icon">‚è≥</div><div class="card-number" id="ongoingCount">0</div><div class="card-label">Em Andamento</div></div>
                <div class="card atrasado" onclick="filterByStatus('Atrasado')"><div class="card-icon">üî¥</div><div class="card-number" id="delayedCount">0</div><div class="card-label">Atrasados</div></div>
                <div class="card aguardando" onclick="filterByStatus('Aguardando Cliente')"><div class="card-icon">‚è∏Ô∏è</div><div class="card-number" id="waitingCount">0</div><div class="card-label">Aguardando</div></div>
                <div class="card nao-iniciado" onclick="filterByStatus('N√£o Iniciado')"><div class="card-icon">üìã</div><div class="card-number" id="notStartedCount">0</div><div class="card-label">N√£o Iniciados</div></div>
                <div class="card critico" onclick="filterByCritico()">
                    <div class="info-icon">?<div class="card-tooltip">Cr√≠tico = Vermelho OU Atrasado OU 15+ dias parado</div></div>
                    <div class="card-icon">üö®</div><div class="card-number" id="criticoCount">0</div><div class="card-label">Cr√≠ticos</div>
                </div>
            </div>
            
            <!-- Decis√µes -->
            <div class="decisoes-section" id="decisoesSection">
                <div class="decisoes-header">
                    <h2>üéØ Decis√µes Necess√°rias (Esta Semana)</h2>
                    <span class="decisoes-badge" id="decisoesBadge">0 itens</span>
                </div>
                <div class="decisoes-body">
                    <table class="decisoes-table">
                        <thead><tr><th>Projeto</th><th>Bloqueador</th><th>Respons√°vel</th><th>Dias Parado</th><th>A√ß√£o Sugerida</th></tr></thead>
                        <tbody id="decisoesTable"></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Filters - COM GO-LIVE -->
            <div class="filters-section">
                <div class="filters-grid">
                    <div class="filter-group"><label>Buscar projeto</label><input type="text" id="searchInput" placeholder="Digite o nome..." oninput="applyFilters()"></div>
                    <div class="filter-group"><label>Status</label><select id="filterStatus" onchange="applyFilters()"><option value="">Todos</option><option value="Em Andamento">Em Andamento</option><option value="Conclu√≠do">Conclu√≠do</option><option value="Atrasado">Atrasado</option><option value="Aguardando Cliente">Aguardando</option><option value="N√£o Iniciado">N√£o Iniciado</option></select></div>
                    <div class="filter-group"><label>Situa√ß√£o</label><select id="filterSituacao" onchange="applyFilters()"><option value="">Todas</option><option value="vermelho">üî¥ Vermelho</option><option value="amarelo">üü° Amarelo</option><option value="verde">üü¢ Verde</option><option value="cinza">‚ö™ Cinza</option></select></div>
                    <div class="filter-group"><label>Go-Live</label><select id="filterGoLive" onchange="applyFilters()"><option value="">Todos</option><option value="mes">Este M√™s</option><option value="30">Pr√≥x. 30 dias</option><option value="60">Pr√≥x. 60 dias</option><option value="90">Pr√≥x. 90 dias</option><option value="atrasado">Atrasados</option></select></div>
                    <div class="filter-group"><label>Parados</label><select id="filterParados" onchange="applyFilters()"><option value="">Todos</option><option value="7">7+ dias</option><option value="15">15+ dias</option><option value="30">30+ dias</option><option value="60">60+ dias</option></select></div>
                    <div class="filter-group"><label>PMO</label><select id="filterPMO" onchange="applyFilters()"><option value="">Todos</option></select></div>
                    <div class="filter-group"><button class="btn btn-clear" onclick="clearFilters()">‚úï Limpar</button></div>
                </div>
            </div>
            
            <!-- Charts -->
            <div class="charts-row">
                <div class="chart-card"><h3>üìä Distribui√ß√£o</h3><div class="pie-container"><div class="pie-chart" id="pieChart"><div class="pie-center"><div class="number" id="pieTotal">0</div><div class="label">Projetos</div></div></div><div class="pie-legend" id="pieLegend"></div></div></div>
                <div class="chart-card"><h3>üî• Top 5 Bloqueadores</h3><div id="bloqueadoresChart"></div></div>
                <div class="chart-card"><h3>üìÖ Pr√≥ximos Go Lives</h3><div class="timeline-chart" id="timelineChart"></div></div>
            </div>
            
            <!-- Table -->
            <div class="table-section">
                <div class="table-header"><h2>üìã Todos os Projetos</h2><span class="results-badge" id="resultsCount">0 projetos</span></div>
                <div class="table-container">
                    <table>
                        <thead><tr>
                            <th>Projeto</th>
                            <th>Localiza√ß√£o</th>
                            <th>Go Live</th>
                            <th>Status</th>
                            <th>Situa√ß√£o</th>
                            <th>Progresso</th>
                            <th>Etapa</th>
                            <th>PMO</th>
                            <th>Dias Parado</th>
                        </tr></thead>
                        <tbody id="projectsTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Detalhes -->
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header"><div><h2 id="modalTitle">Projeto</h2><p id="modalSubtitle">Detalhes</p></div><button class="modal-close" onclick="closeModal()">&times;</button></div>
            <div class="modal-body"><div class="info-grid" id="modalInfo"></div></div>
        </div>
    </div>
    
    <!-- Modal Impress√£o - PROJETOS ESPEC√çFICOS -->
    <div class="modal-overlay" id="printModalOverlay" onclick="closePrintModal(event)">
        <div class="modal print-modal" onclick="event.stopPropagation()">
            <div class="modal-header"><div><h2>üñ®Ô∏è Op√ß√µes de Impress√£o</h2></div><button class="modal-close" onclick="closePrintModal()">&times;</button></div>
            <div class="modal-body">
                <div class="print-options">
                    <label class="print-option selected" onclick="selectPrintOption(this, 'current')">
                        <input type="radio" name="print" value="current" checked>
                        <span class="print-icon">üìÑ</span>
                        <div><div class="print-label">Filtro atual</div><div class="print-desc">Projetos vis√≠veis na tela</div></div>
                    </label>
                    <label class="print-option" onclick="selectPrintOption(this, 'all')">
                        <input type="radio" name="print" value="all">
                        <span class="print-icon">üìë</span>
                        <div><div class="print-label">Todos os projetos</div><div class="print-desc">Sem filtros aplicados</div></div>
                    </label>
                    <label class="print-option" onclick="selectPrintOption(this, 'criticos')">
                        <input type="radio" name="print" value="criticos">
                        <span class="print-icon">üö®</span>
                        <div><div class="print-label">Apenas cr√≠ticos</div><div class="print-desc">Atrasados, vermelhos ou parados</div></div>
                    </label>
                    <label class="print-option" onclick="selectPrintOption(this, 'specific')">
                        <input type="radio" name="print" value="specific">
                        <span class="print-icon">‚úÖ</span>
                        <div>
                            <div class="print-label">Projetos espec√≠ficos</div>
                            <div class="print-desc">Selecione os projetos desejados</div>
                            <div class="projects-select-container" id="projectsSelectContainer" onclick="event.stopPropagation()">
                                <input type="text" class="project-search" id="projectSearch" placeholder="üîç Buscar projeto..." oninput="filterProjectCheckboxes()">
                                <span class="select-all-btn" onclick="toggleSelectAll()">Selecionar todos</span>
                                <div id="projectsCheckboxList"></div>
                            </div>
                        </div>
                    </label>
                </div>
                <button class="btn" style="width:100%;" onclick="executePrint()">üñ®Ô∏è Imprimir</button>
            </div>
        </div>
    </div>
    
    <!-- Modal PDF - MESMAS OP√á√ïES -->
    <div class="modal-overlay" id="pdfModalOverlay" onclick="closePdfModal(event)">
        <div class="modal print-modal" onclick="event.stopPropagation()">
            <div class="modal-header"><div><h2>üìÑ Exportar PDF</h2></div><button class="modal-close" onclick="closePdfModal()">&times;</button></div>
            <div class="modal-body">
                <div class="print-options">
                    <label class="print-option selected" onclick="selectPdfOption(this, 'current')">
                        <input type="radio" name="pdf" value="current" checked>
                        <span class="print-icon">üìÑ</span>
                        <div><div class="print-label">Filtro atual</div><div class="print-desc">Projetos vis√≠veis na tela</div></div>
                    </label>
                    <label class="print-option" onclick="selectPdfOption(this, 'all')">
                        <input type="radio" name="pdf" value="all">
                        <span class="print-icon">üìë</span>
                        <div><div class="print-label">Todos os projetos</div><div class="print-desc">Sem filtros aplicados</div></div>
                    </label>
                    <label class="print-option" onclick="selectPdfOption(this, 'criticos')">
                        <input type="radio" name="pdf" value="criticos">
                        <span class="print-icon">üö®</span>
                        <div><div class="print-label">Apenas cr√≠ticos</div><div class="print-desc">Atrasados, vermelhos ou parados</div></div>
                    </label>
                    <label class="print-option" onclick="selectPdfOption(this, 'specific')">
                        <input type="radio" name="pdf" value="specific">
                        <span class="print-icon">‚úÖ</span>
                        <div>
                            <div class="print-label">Projetos espec√≠ficos</div>
                            <div class="print-desc">Selecione os projetos desejados</div>
                            <div class="projects-select-container" id="pdfProjectsSelectContainer" onclick="event.stopPropagation()">
                                <input type="text" class="project-search" id="pdfProjectSearch" placeholder="üîç Buscar projeto..." oninput="filterPdfProjectCheckboxes()">
                                <span class="select-all-btn" onclick="togglePdfSelectAll()">Selecionar todos</span>
                                <div id="pdfProjectsCheckboxList"></div>
                            </div>
                        </div>
                    </label>
                </div>
                <button class="btn" style="width:100%; background: linear-gradient(135deg, #ef4444, #dc2626);" onclick="executePDF()">üìÑ Gerar PDF</button>
            </div>
        </div>
    </div>
    
    <script>
        let projects = [], filteredProjects = [], printOption = 'current', pdfOption = 'current';
        
        async function loadData() {
            try {
                const saved = localStorage.getItem('infraProjects');
                if (saved) {
                    projects = JSON.parse(saved);
                    filteredProjects = [...projects];
                    showDashboard();
                } else {
                    document.getElementById('loading').innerHTML = '<h3>Cole os dados da planilha</h3><p style="color:#64748b;margin-top:10px;">Use a p√°gina inicial para carregar</p>';
                }
            } catch (e) { console.error('Erro:', e); }
        }
        
        function showDashboard() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('dashboardContent').classList.remove('hidden');
            document.getElementById('currentDate').textContent = new Date().toLocaleString('pt-BR');
            populatePMOFilter();
            populateProjectsCheckboxes();
            updateDashboard();
        }
        
        function populatePMOFilter() {
            const pmos = [...new Set(projects.map(p => p.pmoInterno || p.respInterno).filter(p => p && p !== '-'))].sort();
            document.getElementById('filterPMO').innerHTML = '<option value="">Todos</option>' + pmos.map(p => `<option value="${p}">${p}</option>`).join('');
        }
        
        function populateProjectsCheckboxes() {
            const container = document.getElementById('projectsCheckboxList');
            // Ordenar projetos alfabeticamente mantendo o √≠ndice original
            const sortedProjects = projects.map((p, i) => ({...p, originalIndex: i}))
                .sort((a, b) => a.projeto.localeCompare(b.projeto, 'pt-BR'));
            container.innerHTML = sortedProjects.map(p => `
                <label class="project-checkbox" data-name="${p.projeto.toLowerCase()}">
                    <input type="checkbox" value="${p.originalIndex}" onchange="selectPrintOption(document.querySelector('.print-option:last-child'), 'specific')">
                    ${p.projeto}
                </label>
            `).join('');
        }
        
        function filterProjectCheckboxes() {
            const search = document.getElementById('projectSearch').value.toLowerCase();
            document.querySelectorAll('#projectsCheckboxList .project-checkbox').forEach(label => {
                const name = label.dataset.name || '';
                label.classList.toggle('hidden', search && !name.includes(search));
            });
        }
        
        function toggleSelectAll() {
            const checkboxes = document.querySelectorAll('#projectsCheckboxList input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(c => c.checked);
            checkboxes.forEach(c => c.checked = !allChecked);
            selectPrintOption(document.querySelector('.print-option:last-child'), 'specific');
        }
        
        function normalizeStatus(status) {
            if (!status) return 'N√£o Iniciado';
            const s = status.toLowerCase().trim();
            if (s.includes('conclu') || s.includes('finaliz') || s.includes('pronto')) return 'Conclu√≠do';
            if (s.includes('andamento') || s.includes('progress') || s.includes('execu')) return 'Em Andamento';
            if (s.includes('atras') || s.includes('delay')) return 'Atrasado';
            if (s.includes('aguard') || s.includes('cliente') || s.includes('espera')) return 'Aguardando Cliente';
            if (s.includes('n√£o') || s.includes('nao') || s.includes('iniciad') || s.includes('pend')) return 'N√£o Iniciado';
            return status;
        }
        
        function getStatusClass(status) {
            const map = {'Em Andamento':'andamento','Conclu√≠do':'concluido','Atrasado':'atrasado','Aguardando Cliente':'aguardando','N√£o Iniciado':'nao-iniciado'};
            return map[normalizeStatus(status)] || 'nao-iniciado';
        }
        
        function getSituacaoHtml(sit) {
            if (!sit) return '<span class="situacao cinza"><span class="situacao-dot"></span>N/D</span>';
            const s = sit.toLowerCase();
            if (s.includes('verde') || s === 'green') return '<span class="situacao verde"><span class="situacao-dot"></span>Verde</span>';
            if (s.includes('amarelo') || s === 'yellow') return '<span class="situacao amarelo"><span class="situacao-dot"></span>Amarelo</span>';
            if (s.includes('vermelho') || s === 'red') return '<span class="situacao vermelho"><span class="situacao-dot"></span>Vermelho</span>';
            return '<span class="situacao cinza"><span class="situacao-dot"></span>Cinza</span>';
        }
        
        function getProgressHtml(prog) {
            const p = parseInt(prog) || 0;
            const cls = p >= 70 ? 'high' : p >= 40 ? 'medium' : 'low';
            return `<div class="progress-container"><div class="progress-bar"><div class="progress-fill ${cls}" style="width:${p}%"></div></div><span class="progress-text">${p}%</span></div>`;
        }
        
        function isCritico(p) {
            const status = normalizeStatus(p.status);
            const sit = (p.situacao || p.rag || '').toLowerCase();
            return status === 'Atrasado' || sit.includes('vermelho') || sit === 'red' || (p.diasSemAtual || 0) > 15;
        }
        
        function parseDate(str) {
            if (!str || str === '-') return null;
            const parts = str.split('/');
            if (parts.length === 3) return new Date(parts[2], parts[1] - 1, parts[0]);
            return new Date(str);
        }
        
        function applyFilters() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const status = document.getElementById('filterStatus').value;
            const situacao = document.getElementById('filterSituacao').value;
            const goLive = document.getElementById('filterGoLive').value;
            const parados = document.getElementById('filterParados').value;
            const pmo = document.getElementById('filterPMO').value;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            filteredProjects = projects.filter(p => {
                if (search && !p.projeto.toLowerCase().includes(search)) return false;
                if (status && normalizeStatus(p.status) !== status) return false;
                if (situacao) {
                    const sit = (p.situacao || p.rag || '').toLowerCase();
                    if (situacao === 'vermelho' && !sit.includes('vermelho') && sit !== 'red') return false;
                    if (situacao === 'amarelo' && !sit.includes('amarelo') && sit !== 'yellow') return false;
                    if (situacao === 'verde' && !sit.includes('verde') && sit !== 'green') return false;
                    if (situacao === 'cinza' && (sit.includes('vermelho') || sit.includes('amarelo') || sit.includes('verde') || sit === 'red' || sit === 'yellow' || sit === 'green')) return false;
                }
                if (goLive) {
                    const glDate = parseDate(p.goliveAtual || p.golive);
                    if (!glDate) return false;
                    
                    if (goLive === 'atrasado') {
                        if (glDate >= today) return false;
                        if (normalizeStatus(p.status) === 'Conclu√≠do') return false;
                    } else if (goLive === 'mes') {
                        const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                        if (glDate < today || glDate > endOfMonth) return false;
                    } else {
                        const days = parseInt(goLive);
                        const futureDate = new Date(today);
                        futureDate.setDate(futureDate.getDate() + days);
                        if (glDate < today || glDate > futureDate) return false;
                    }
                }
                if (parados && (p.diasSemAtual || 0) < parseInt(parados)) return false;
                if (pmo && (p.pmoInterno || p.respInterno) !== pmo) return false;
                return true;
            });
            
            updateDashboard();
        }
        
        function filterByStatus(status) {
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
            if (status) {
                event.currentTarget.classList.add('active');
                document.getElementById('filterStatus').value = status;
            } else {
                document.getElementById('filterStatus').value = '';
            }
            applyFilters();
        }
        
        function filterByCritico() {
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
            event.currentTarget.classList.add('active');
            filteredProjects = projects.filter(p => isCritico(p));
            updateDashboard();
        }
        
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('filterStatus').value = '';
            document.getElementById('filterSituacao').value = '';
            document.getElementById('filterGoLive').value = '';
            document.getElementById('filterParados').value = '';
            document.getElementById('filterPMO').value = '';
            document.querySelectorAll('.card').forEach(c => c.classList.remove('active'));
            filteredProjects = [...projects];
            updateDashboard();
        }
        
        function updateDashboard() {
            // CORRIGIDO: Usar filteredProjects para cards e KPIs
            const all = filteredProjects;
            const naoConc = all.filter(p => normalizeStatus(p.status) !== 'Conclu√≠do');
            
            document.getElementById('totalProjects').textContent = all.length;
            document.getElementById('completedCount').textContent = all.filter(p => normalizeStatus(p.status) === 'Conclu√≠do').length;
            document.getElementById('ongoingCount').textContent = all.filter(p => normalizeStatus(p.status) === 'Em Andamento').length;
            document.getElementById('delayedCount').textContent = all.filter(p => normalizeStatus(p.status) === 'Atrasado').length;
            document.getElementById('waitingCount').textContent = all.filter(p => normalizeStatus(p.status) === 'Aguardando Cliente').length;
            document.getElementById('notStartedCount').textContent = all.filter(p => normalizeStatus(p.status) === 'N√£o Iniciado').length;
            document.getElementById('criticoCount').textContent = all.filter(p => isCritico(p)).length;
            document.getElementById('resultsCount').textContent = `${filteredProjects.length} projetos`;
            
            // KPIs - com valida√ß√£o para evitar NaN
            const comData = naoConc.filter(p => {
                const orig = p.goliveOriginal && p.goliveOriginal !== '-' && p.goliveOriginal.includes('/');
                const atual = (p.goliveAtual || p.golive) && (p.goliveAtual || p.golive) !== '-';
                return orig || atual;
            });
            const onTime = comData.filter(p => {
                const orig = parseDate(p.goliveOriginal);
                const atual = parseDate(p.goliveAtual || p.golive);
                return orig && atual && !isNaN(orig.getTime()) && !isNaN(atual.getTime()) && atual <= orig;
            }).length;
            document.getElementById('kpiOntime').textContent = comData.length > 0 ? Math.round((onTime / comData.length) * 100) + '%' : '0%';
            document.getElementById('kpiOntimeSub').textContent = `${onTime} de ${comData.length} com data`;
            
            const deltas = naoConc.map(p => {
                const orig = parseDate(p.goliveOriginal);
                const atual = parseDate(p.goliveAtual || p.golive);
                if (orig && atual && !isNaN(orig.getTime()) && !isNaN(atual.getTime())) {
                    return Math.round((atual - orig) / (1000 * 60 * 60 * 24));
                }
                return null;
            }).filter(d => d !== null && !isNaN(d));
            const avgDelta = deltas.length > 0 ? Math.round(deltas.reduce((a, b) => a + b, 0) / deltas.length) : 0;
            document.getElementById('kpiDelta').textContent = (isNaN(avgDelta) ? 0 : avgDelta) + ' dias';
            document.getElementById('kpiDeltaSub').textContent = avgDelta > 0 ? 'de atraso' : avgDelta < 0 ? 'de antecipa√ß√£o' : 'nos go-lives';
            
            const atualizados = naoConc.filter(p => (p.diasSemAtual || 0) <= 7).length;
            document.getElementById('kpiTaxa').textContent = naoConc.length > 0 ? Math.round((atualizados / naoConc.length) * 100) + '%' : '0%';
            document.getElementById('kpiTaxaSub').textContent = `${atualizados} de ${naoConc.length}`;
            
            const agings = naoConc.map(p => p.diasSemAtual || 0).filter(d => !isNaN(d));
            const avgAging = agings.length > 0 ? Math.round(agings.reduce((a, b) => a + b, 0) / agings.length) : 0;
            document.getElementById('kpiAging').textContent = (isNaN(avgAging) ? 0 : avgAging) + ' dias';
            document.getElementById('kpiAgingSub').textContent = 'sem atualiza√ß√£o';
            
            renderDecisoes();
            renderCharts();
            renderTable();
            updateExecutiveSummary();
            updateAlertBar();
        }
        
        function updateExecutiveSummary() {
            const total = projects.length;
            const criticos = projects.filter(p => isCritico(p)).length;
            const atrasados = projects.filter(p => normalizeStatus(p.status) === 'Atrasado').length;
            const aguardando = projects.filter(p => normalizeStatus(p.status) === 'Aguardando Cliente').length;
            const parados15 = projects.filter(p => (p.diasSemAtual || 0) >= 15 && normalizeStatus(p.status) !== 'Conclu√≠do').length;
            const concluidos = projects.filter(p => normalizeStatus(p.status) === 'Conclu√≠do').length;
            const emAndamento = projects.filter(p => normalizeStatus(p.status) === 'Em Andamento').length;
            
            let text = `<strong>${total} projetos</strong> em carteira: `;
            text += `<span class="highlight-green">${concluidos} conclu√≠dos</span>, `;
            text += `<span class="highlight-blue">${emAndamento} em andamento</span>`;
            
            if (criticos > 0 || atrasados > 0 || parados15 > 0) {
                text += `. <strong>Foco:</strong> `;
                const focos = [];
                if (atrasados > 0) focos.push(`<span class="highlight-red">${atrasados} atrasados</span>`);
                if (aguardando > 0) focos.push(`${aguardando} aguardando cliente`);
                if (parados15 > 0) focos.push(`<span class="highlight-red">${parados15} parados h√° 15+ dias</span>`);
                text += focos.join(', ') + '.';
            } else {
                text += `. <span class="highlight-green">Nenhum projeto cr√≠tico!</span>`;
            }
            
            document.getElementById('summaryText').innerHTML = text;
        }
        
        function updateAlertBar() {
            const criticos = projects.filter(p => isCritico(p)).length;
            const atrasados = projects.filter(p => normalizeStatus(p.status) === 'Atrasado').length;
            const parados15 = projects.filter(p => (p.diasSemAtual || 0) >= 15 && normalizeStatus(p.status) !== 'Conclu√≠do').length;
            
            const alertBar = document.getElementById('alertBar');
            const alertIcon = alertBar.querySelector('.alert-icon');
            const alertText = document.getElementById('alertText');
            
            alertBar.classList.remove('danger', 'warning', 'success', 'hidden');
            
            if (atrasados > 0 || parados15 > 0) {
                alertBar.classList.add('danger');
                alertIcon.textContent = 'üö®';
                let msg = [];
                if (atrasados > 0) msg.push(`${atrasados} projeto${atrasados > 1 ? 's' : ''} atrasado${atrasados > 1 ? 's' : ''}`);
                if (parados15 > 0) msg.push(`${parados15} parado${parados15 > 1 ? 's' : ''} h√° mais de 15 dias`);
                alertText.textContent = `Aten√ß√£o: ${msg.join(' e ')}. A√ß√£o necess√°ria!`;
            } else if (criticos > 0) {
                alertBar.classList.add('warning');
                alertIcon.textContent = '‚ö†Ô∏è';
                alertText.textContent = `${criticos} projeto${criticos > 1 ? 's requerem' : ' requer'} aten√ß√£o. Revisar antes da pr√≥xima reuni√£o.`;
            } else {
                alertBar.classList.add('success');
                alertIcon.textContent = '‚úÖ';
                alertText.textContent = 'Todos os projetos est√£o em dia! Nenhuma a√ß√£o urgente necess√°ria.';
            }
        }
        
        function renderDecisoes() {
            // CORRIGIDO: Usar filteredProjects
            const decisoes = filteredProjects.filter(p => isCritico(p) && normalizeStatus(p.status) !== 'Conclu√≠do').slice(0, 5);
            document.getElementById('decisoesBadge').textContent = decisoes.length + ' itens';
            document.getElementById('decisoesSection').style.display = decisoes.length === 0 ? 'none' : 'block';
            
            document.getElementById('decisoesTable').innerHTML = decisoes.length === 0 ? 
                '<tr><td colspan="5" class="no-decisoes">‚úÖ Nenhuma decis√£o urgente!</td></tr>' :
                decisoes.map(p => {
                    let acao = 'Verificar status';
                    if ((p.diasSemAtual || 0) > 15) acao = 'Cobrar atualiza√ß√£o';
                    if (p.bloqueador && p.bloqueador.toLowerCase().includes('cliente')) acao = 'Escalar p/ ger√™ncia';
                    if (normalizeStatus(p.status) === 'Atrasado') acao = 'Reuni√£o urgente';
                    return `<tr>
                        <td class="projeto">${p.projeto}</td>
                        <td class="bloqueador">${p.bloqueador || '-'}</td>
                        <td>${p.pmoInterno || p.respInterno || '-'}</td>
                        <td><span class="dias">${p.diasSemAtual || 0} dias</span></td>
                        <td><span class="acao">${acao}</span></td>
                    </tr>`;
                }).join('');
        }
        
        function renderCharts() {
            const counts = {
                'Em Andamento': filteredProjects.filter(p => normalizeStatus(p.status) === 'Em Andamento').length,
                'Conclu√≠do': filteredProjects.filter(p => normalizeStatus(p.status) === 'Conclu√≠do').length,
                'Atrasado': filteredProjects.filter(p => normalizeStatus(p.status) === 'Atrasado').length,
                'Aguardando': filteredProjects.filter(p => normalizeStatus(p.status) === 'Aguardando Cliente').length,
                'N√£o Iniciado': filteredProjects.filter(p => normalizeStatus(p.status) === 'N√£o Iniciado').length
            };
            const colors = {'Em Andamento':'#3b82f6','Conclu√≠do':'#10b981','Atrasado':'#ef4444','Aguardando':'#f59e0b','N√£o Iniciado':'#6b7280'};
            const total = Object.values(counts).reduce((a,b) => a+b, 0);
            document.getElementById('pieTotal').textContent = total;
            
            if (total === 0) {
                document.getElementById('pieChart').style.background = '#e5e7eb';
                document.getElementById('pieLegend').innerHTML = '<div style="color:#64748b;">Sem dados</div>';
            } else {
                let cumPct = 0, gradParts = [];
                Object.entries(counts).forEach(([s, c]) => {
                    if (c > 0) {
                        const pct = (c/total)*100;
                        gradParts.push(`${colors[s]} ${cumPct}% ${cumPct+pct}%`);
                        cumPct += pct;
                    }
                });
                document.getElementById('pieChart').style.background = `conic-gradient(${gradParts.join(', ')})`;
                document.getElementById('pieLegend').innerHTML = Object.entries(counts).filter(([_,c]) => c > 0).map(([s,c]) => `<div class="legend-item"><span class="legend-dot" style="background:${colors[s]}"></span><span>${s}: ${c}</span></div>`).join('');
            }
            
            const bloqueadores = {};
            filteredProjects.forEach(p => {
                if (p.bloqueador && p.bloqueador !== '-' && p.bloqueador !== '' && p.bloqueador.length > 2) {
                    const b = p.bloqueador.substring(0, 20);
                    bloqueadores[b] = (bloqueadores[b] || 0) + 1;
                }
            });
            const topBloqueadores = Object.entries(bloqueadores).sort((a,b) => b[1] - a[1]).slice(0, 5);
            const maxBloq = topBloqueadores.length > 0 ? topBloqueadores[0][1] : 1;
            
            document.getElementById('bloqueadoresChart').innerHTML = topBloqueadores.length === 0 ? 
                '<div class="no-bloqueadores">‚úÖ Nenhum bloqueador!</div>' :
                topBloqueadores.map(([b, c]) => `<div class="bloqueador-item"><div class="bloqueador-label" title="${b}">${b}</div><div class="bloqueador-bar"><div class="bloqueador-fill" style="width:${(c/maxBloq)*100}%">${c}</div></div></div>`).join('');
            
            // Pr√≥ximos Go Lives - ordenados por data, apenas n√£o conclu√≠dos
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            const upcoming = filteredProjects.filter(p => {
                const goliveStr = p.goliveAtual || p.golive;
                if (!goliveStr || goliveStr === '-') return false;
                if (normalizeStatus(p.status) === 'Conclu√≠do') return false;
                const glDate = parseDate(goliveStr);
                return glDate && !isNaN(glDate.getTime());
            }).map(p => {
                const goliveStr = p.goliveAtual || p.golive;
                const glDate = parseDate(goliveStr);
                const diffDays = Math.ceil((glDate - hoje) / (1000 * 60 * 60 * 24));
                return { ...p, goliveDate: glDate, diffDays: diffDays, goliveStr: goliveStr };
            }).sort((a, b) => a.goliveDate - b.goliveDate).slice(0, 5);
            
            document.getElementById('timelineChart').innerHTML = upcoming.length === 0 ? 
                '<div class="no-timeline">üìÖ Nenhum Go Live agendado</div>' :
                upcoming.map(p => {
                    let daysClass = 'ok';
                    let daysText = `${p.diffDays}d`;
                    if (p.diffDays < 0) {
                        daysClass = 'atrasado';
                        daysText = `${Math.abs(p.diffDays)}d atr√°s`;
                    } else if (p.diffDays <= 15) {
                        daysClass = 'proximo';
                    }
                    const sitClass = (p.situacao || p.rag || 'cinza').toLowerCase();
                    return `<div class="timeline-item">
                        <div class="timeline-date">${p.goliveStr}</div>
                        <div class="timeline-days ${daysClass}">${daysText}</div>
                        <div class="timeline-bar ${sitClass}">${p.projeto}</div>
                    </div>`;
                }).join('');
        }
        
        function renderTable() {
            document.getElementById('projectsTable').innerHTML = filteredProjects.length === 0 ? 
                '<tr><td colspan="9" class="empty-state">Nenhum projeto encontrado</td></tr>' :
                filteredProjects.map(p => {
                    const orig = p.goliveOriginal || '-', atual = p.goliveAtual || p.golive || '-';
                    const goLiveHtml = (orig !== atual && orig !== '-' && atual !== '-') ?
                        `<span style="background:#fef3c7;color:#92400e;padding:4px 8px;border-radius:6px;font-size:11px;">‚ö†Ô∏è ${atual}</span>` : atual;
                    const dias = p.diasSemAtual || 0;
                    const diasHtml = dias > 15 ? `<span style="background:#fee2e2;color:#991b1b;padding:4px 10px;border-radius:12px;font-weight:600;">${dias}d</span>` :
                                    dias > 7 ? `<span style="background:#fef3c7;color:#92400e;padding:4px 10px;border-radius:12px;font-weight:600;">${dias}d</span>` :
                                    `<span style="color:#64748b;">${dias}d</span>`;
                    return `<tr class="clickable" onclick="openModal('${p.projeto.replace(/'/g, "\\'")}')">
                        <td class="project-name">${p.projeto}</td>
                        <td>${p.localizacao || '-'}</td>
                        <td>${goLiveHtml}</td>
                        <td><span class="status-badge ${getStatusClass(p.status)}">${normalizeStatus(p.status)}</span></td>
                        <td>${getSituacaoHtml(p.situacao || p.rag)}</td>
                        <td>${getProgressHtml(p.progresso)}</td>
                        <td style="font-size:11px;">${p.etapa || '-'}</td>
                        <td>${p.pmoInterno || p.respInterno || '-'}</td>
                        <td>${diasHtml}</td>
                    </tr>`;
                }).join('');
        }
        
        // Fun√ß√£o para parsear atividades do formato STATUS|DATA|DESCRI√á√ÉO
        function parseAtividades(atividadesStr) {
            if (!atividadesStr || atividadesStr === '-') return [];
            return atividadesStr.split(';').map(a => {
                const parts = a.split('|');
                return {
                    status: parts[0] || 'P',
                    data: parts[1] || '',
                    descricao: parts[2] || ''
                };
            }).filter(a => a.descricao);
        }
        
        function openModal(name) {
            const p = projects.find(x => x.projeto === name);
            if (!p) return;
            document.getElementById('modalTitle').textContent = p.projeto;
            document.getElementById('modalSubtitle').textContent = `${normalizeStatus(p.status)} ‚Ä¢ ${p.localizacao || 'Local n√£o definido'}`;
            
            // Parsear atividades
            const atividades = parseAtividades(p.atividades);
            const concluidas = atividades.filter(a => a.status === 'C');
            const pendentes = atividades.filter(a => a.status === 'P');
            
            let atividadesHtml = '';
            if (atividades.length > 0) {
                atividadesHtml = `<div class="info-box" style="grid-column: 1 / -1; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px;">
                    <label style="color: #334155; font-weight: 600; font-size: 14px;">üìã Checklist de Atividades (${concluidas.length}/${atividades.length})</label>
                    <div style="display: flex; gap: 4px; margin: 10px 0;">
                        <div style="flex: ${concluidas.length}; height: 8px; background: #22c55e; border-radius: 4px;"></div>
                        <div style="flex: ${pendentes.length}; height: 8px; background: #e2e8f0; border-radius: 4px;"></div>
                    </div>`;
                
                if (concluidas.length > 0) {
                    atividadesHtml += `<div style="margin-top: 12px;">
                        <div style="font-weight: 600; color: #166534; font-size: 12px; margin-bottom: 8px;">‚úÖ Conclu√≠das (${concluidas.length})</div>
                        <div style="display: grid; gap: 4px; max-height: 200px; overflow-y: auto;">
                            ${concluidas.map(a => `<div style="background: #dcfce7; color: #166534; padding: 6px 10px; border-radius: 6px; font-size: 11px; display: flex; justify-content: space-between;">
                                <span>${a.descricao}</span><strong>${a.data}</strong>
                            </div>`).join('')}
                        </div>
                    </div>`;
                }
                
                if (pendentes.length > 0) {
                    atividadesHtml += `<div style="margin-top: 12px;">
                        <div style="font-weight: 600; color: #92400e; font-size: 12px; margin-bottom: 8px;">‚è≥ Pendentes (${pendentes.length})</div>
                        <div style="display: grid; gap: 4px; max-height: 150px; overflow-y: auto;">
                            ${pendentes.map(a => `<div style="background: #fef3c7; color: #92400e; padding: 6px 10px; border-radius: 6px; font-size: 11px;">
                                ${a.descricao}
                            </div>`).join('')}
                        </div>
                    </div>`;
                }
                
                atividadesHtml += `</div>`;
            }
            
            // Observa√ß√µes/Anota√ß√µes
            let obsHtml = '';
            const obs = p.observacoes || p.anotacoes || p.obs || p.comentarios || '';
            if (obs && obs !== '-' && obs.trim() !== '') {
                obsHtml = `<div class="info-box" style="grid-column: 1 / -1; background: #eff6ff; border: 1px solid #93c5fd; border-radius: 8px; padding: 15px;">
                    <label style="color: #1e40af; font-weight: 600;">üìù Observa√ß√µes</label>
                    <p style="font-size:13px;line-height:1.6;margin-top:8px;color:#1e3a5f;">${obs}</p>
                </div>`;
            }
            
            document.getElementById('modalInfo').innerHTML = `
                <div class="info-box"><label>Etapa Atual</label><span>${p.etapa || '-'}</span></div>
                <div class="info-box"><label>Progresso</label><span>${p.progresso || 0}%</span></div>
                <div class="info-box"><label>Situa√ß√£o</label><span>${getSituacaoHtml(p.situacao || p.rag)}</span></div>
                <div class="info-box"><label>Go Live Original</label><span>${p.goliveOriginal || '-'}</span></div>
                <div class="info-box"><label>Go Live Atual</label><span>${p.goliveAtual || p.golive || '-'}</span></div>
                <div class="info-box"><label>Dias Parado</label><span>${p.diasSemAtual || 0} dias</span></div>
                <div class="info-box"><label>PMO Interno</label><span>${p.pmoInterno || p.respInterno || '-'}</span></div>
                <div class="info-box"><label>Bloqueador</label><span style="${p.bloqueador && p.bloqueador !== '-' ? 'color:#991b1b;' : ''}">${p.bloqueador || '-'}</span></div>
                <div class="info-box"><label>√öltima Atualiza√ß√£o</label><span>${p.ultAtual || '-'}</span></div>
                ${atividadesHtml}
                ${obsHtml}`;
            document.getElementById('modalOverlay').classList.add('active');
        }
        
        function closeModal(e) { if (e && e.target !== e.currentTarget) return; document.getElementById('modalOverlay').classList.remove('active'); }
        function openPrintModal() { document.getElementById('printModalOverlay').classList.add('active'); }
        function closePrintModal(e) { if (e && e.target !== e.currentTarget) return; document.getElementById('printModalOverlay').classList.remove('active'); }
        function selectPrintOption(el, option) { 
            document.querySelectorAll('.print-option').forEach(o => o.classList.remove('selected')); 
            el.classList.add('selected'); 
            printOption = option; 
        }
        
        function executePrint() {
            closePrintModal();
            
            if (printOption === 'all') { 
                filteredProjects = [...projects]; 
                updateDashboard(); 
            } else if (printOption === 'criticos') { 
                filteredProjects = projects.filter(p => isCritico(p)); 
                updateDashboard(); 
            } else if (printOption === 'specific') {
                const checkboxes = document.querySelectorAll('#projectsCheckboxList input[type="checkbox"]:checked');
                if (checkboxes.length > 0) {
                    const indices = Array.from(checkboxes).map(c => parseInt(c.value));
                    filteredProjects = indices.map(i => projects[i]).filter(p => p);
                    updateDashboard();
                }
            }
            setTimeout(() => window.print(), 300);
        }
        
        // === FUN√á√ïES DO MODAL PDF ===
        function openPdfModal() { 
            // Preencher lista de projetos no modal PDF
            document.getElementById('pdfProjectsCheckboxList').innerHTML = projects.map((p, i) => 
                `<label class="project-checkbox"><input type="checkbox" value="${i}"><span>${p.projeto}</span></label>`
            ).join('');
            document.getElementById('pdfModalOverlay').classList.add('active'); 
        }
        function closePdfModal(e) { if (e && e.target !== e.currentTarget) return; document.getElementById('pdfModalOverlay').classList.remove('active'); }
        function selectPdfOption(el, option) { 
            document.querySelectorAll('#pdfModalOverlay .print-option').forEach(o => o.classList.remove('selected')); 
            el.classList.add('selected'); 
            pdfOption = option; 
        }
        function filterPdfProjectCheckboxes() {
            const search = document.getElementById('pdfProjectSearch').value.toLowerCase();
            document.querySelectorAll('#pdfProjectsCheckboxList label').forEach(l => {
                const name = l.querySelector('span').textContent.toLowerCase();
                l.style.display = name.includes(search) ? '' : 'none';
            });
        }
        function togglePdfSelectAll() {
            const checkboxes = document.querySelectorAll('#pdfProjectsCheckboxList input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(c => c.checked);
            checkboxes.forEach(c => c.checked = !allChecked);
        }
        
        function executePDF() {
            closePdfModal();
            
            // Determinar quais projetos exportar baseado na sele√ß√£o
            let projetosParaPDF = [];
            
            if (pdfOption === 'all') { 
                projetosParaPDF = [...projects]; 
            } else if (pdfOption === 'criticos') { 
                projetosParaPDF = projects.filter(p => isCritico(p)); 
            } else if (pdfOption === 'specific') {
                const checkboxes = document.querySelectorAll('#pdfProjectsCheckboxList input[type="checkbox"]:checked');
                if (checkboxes.length > 0) {
                    const indices = Array.from(checkboxes).map(c => parseInt(c.value));
                    projetosParaPDF = indices.map(i => projects[i]).filter(p => p);
                } else {
                    projetosParaPDF = [...filteredProjects]; // Se nenhum selecionado, usa filtro atual
                }
            } else {
                // current - usa filteredProjects (projetos vis√≠veis na tela)
                projetosParaPDF = [...filteredProjects];
            }
            
            if (projetosParaPDF.length === 0) {
                alert('Nenhum projeto selecionado para exportar.');
                return;
            }
            
            const hoje = new Date().toLocaleDateString('pt-BR');
            const hora = new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'});
            
            let html = `
                <div style="font-family: Arial, sans-serif; padding: 20px;">
                    <div style="text-align: center; margin-bottom: 30px; border-bottom: 3px solid #667eea; padding-bottom: 20px;">
                        <h1 style="color: #1a1a2e; margin: 0;">üìä Relat√≥rio de Projetos - Infraestrutura</h1>
                        <p style="color: #666; margin: 10px 0 0 0;">Gerado em: ${hoje} √†s ${hora}</p>
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;">
                        <div style="background: #f0fdf4; padding: 15px 25px; border-radius: 10px; border-left: 4px solid #22c55e;">
                            <div style="font-size: 24px; font-weight: bold; color: #166534;">${projetosParaPDF.length}</div>
                            <div style="color: #166534; font-size: 12px;">Total Projetos</div>
                        </div>
                        <div style="background: #f0fdf4; padding: 15px 25px; border-radius: 10px; border-left: 4px solid #22c55e;">
                            <div style="font-size: 24px; font-weight: bold; color: #166534;">${projetosParaPDF.filter(p => normalizeStatus(p.status) === 'Conclu√≠do').length}</div>
                            <div style="color: #166534; font-size: 12px;">Conclu√≠dos</div>
                        </div>
                        <div style="background: #fef3c7; padding: 15px 25px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                            <div style="font-size: 24px; font-weight: bold; color: #92400e;">${projetosParaPDF.filter(p => normalizeStatus(p.status) === 'Em Andamento').length}</div>
                            <div style="color: #92400e; font-size: 12px;">Em Andamento</div>
                        </div>
                        <div style="background: #fee2e2; padding: 15px 25px; border-radius: 10px; border-left: 4px solid #ef4444;">
                            <div style="font-size: 24px; font-weight: bold; color: #991b1b;">${projetosParaPDF.filter(p => isCritico(p)).length}</div>
                            <div style="color: #991b1b; font-size: 12px;">Cr√≠ticos</div>
                        </div>
                    </div>
            `;
            
            projetosParaPDF.forEach((p, idx) => {
                const statusColor = normalizeStatus(p.status) === 'Conclu√≠do' ? '#166534' : 
                                   normalizeStatus(p.status) === 'Atrasado' ? '#991b1b' : 
                                   normalizeStatus(p.status) === 'Em Andamento' ? '#1e40af' : '#666';
                const statusBg = normalizeStatus(p.status) === 'Conclu√≠do' ? '#f0fdf4' : 
                                normalizeStatus(p.status) === 'Atrasado' ? '#fee2e2' : 
                                normalizeStatus(p.status) === 'Em Andamento' ? '#eff6ff' : '#f9fafb';
                
                // Parsear atividades do checklist
                const atividades = parseAtividades(p.atividades);
                const concluidas = atividades.filter(a => a.status === 'C');
                
                html += `
                    <div style="background: ${statusBg}; border-radius: 12px; padding: 20px; margin-bottom: 20px; border: 1px solid #e5e7eb; page-break-inside: avoid;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h2 style="margin: 0; color: #1a1a2e; font-size: 16px;">${p.projeto}</h2>
                            <span style="background: ${statusColor}; color: white; padding: 4px 12px; border-radius: 20px; font-size: 11px;">${normalizeStatus(p.status)}</span>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; font-size: 12px; margin-bottom: 15px;">
                            <div><strong>Localiza√ß√£o:</strong> ${p.localizacao || '-'}</div>
                            <div><strong>PMO:</strong> ${p.pmoInterno || p.respInterno || '-'}</div>
                            <div><strong>Go Live:</strong> ${p.goliveAtual || p.golive || '-'}</div>
                            <div><strong>Progresso:</strong> ${p.progresso || 0}%</div>
                        </div>
                `;
                
                // Adicionar atividades conclu√≠das do checklist
                if (concluidas.length > 0) {
                    html += `
                        <div style="background: white; border-radius: 8px; padding: 12px; margin-top: 10px;">
                            <div style="font-weight: bold; color: #166534; margin-bottom: 10px; font-size: 12px;">‚úÖ Atividades Conclu√≠das (${concluidas.length}/${atividades.length}):</div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 4px;">
                                ${concluidas.map(a => `<div style="background: #dcfce7; color: #166534; padding: 4px 8px; border-radius: 4px; font-size: 9px; display: flex; justify-content: space-between;">
                                    <span>${a.descricao}</span><strong>${a.data}</strong>
                                </div>`).join('')}
                            </div>
                        </div>
                    `;
                }
                
                // Adicionar observa√ß√µes
                if (p.observacoes && p.observacoes !== '-' && p.observacoes.trim() !== '') {
                    html += `
                        <div style="background: #fffbeb; border-radius: 8px; padding: 12px; margin-top: 10px;">
                            <div style="font-weight: bold; color: #92400e; margin-bottom: 5px; font-size: 12px;">üìù Observa√ß√µes:</div>
                            <div style="font-size: 11px; color: #78350f;">${p.observacoes}</div>
                        </div>
                    `;
                }
                
                html += `</div>`;
            });
            
            html += `</div>`;
            
            const element = document.createElement('div');
            element.innerHTML = html;
            document.body.appendChild(element);
            
            const opt = {
                margin: 10,
                filename: 'Relatorio_Projetos_Infraestrutura_' + hoje.replace(/\//g, '-') + '.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            
            html2pdf().set(opt).from(element).save().then(() => {
                document.body.removeChild(element);
            });
        }
        
        document.addEventListener('keydown', e => { if (e.key === 'Escape') { closeModal(); closePrintModal(); closePdfModal(); } });
        window.addEventListener('load', loadData);
    </script>
</body>
</html>
